[{"id":"a988fbcb.b19b38","type":"ui_template","z":"e2e5a56.78da658","group":"1307a7ee.564f58","name":"Off","order":6,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1470,"y":3740,"wires":[[]]},{"id":"f5a4386f.2438c8","type":"comment","z":"e2e5a56.78da658","name":"Data Mapping","info":"","x":90,"y":40,"wires":[]},{"id":"e3caaa7c.daf088","type":"function","z":"e2e5a56.78da658","name":"Data Processing","func":"/*#################################################################################################################################################################################################\n\tGLOBAL VARIABLES\n#################################################################################################################################################################################################*/\n\t// Message Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar topic\t\t\t= msg.topic;\n\t\tvar payload\t\t\t= msg.payload;\t//\n\t\tvar unitID          = \"gw6A68C63ADAD23A\";\n\t\tmsg.payload         = null;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Topic Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar systemType\t\t= \"\";\t\t\t// GW\n\t\tvar systemID\t\t= \"\";\t\t\t// gw6A68C63ADAF88F\n\t\tvar subID_1\t\t\t= \"\";\t\t\t// 1\n\t\tvar subID_2\t\t\t= \"\";\t\t\t// A\n\t\tvar subID_3\t\t\t= \"\";\t\t\t//\n\t\tvar subID_4\t\t\t= \"\";\t\t\t//\n\t\tvar subID_5\t\t\t= \"\";\t\t\t//\n\t\tvar subID_6\t\t\t= \"\";\t\t\t//\n\t\tvar subID_7\t\t\t= \"\";\t\t\t//\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Index Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar topicLength\t\t= topic.length;\n\t\tvar topicSeperator\t= topic.indexOf(\"/\");\n\t\tvar indexGW_ID\t\t= -1;\n\t\tvar indexGW_Unit\t= -1;\n\t\tvar indexGW_Func\t= -1;\n\t\tvar index_5\t\t\t= -1;\n\t\tvar index_6\t\t\t= -1;\n\t\tvar index_7\t\t\t= -1;\n\t\tvar index_8\t\t\t= -1;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Memory Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar\t_unitID;\n\t\tvar\t_geyserDataSN;\n\t\tvar\t_geyserData;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Time & Date variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar date\t\t\t= new Date();\n\n\t\tvar system_Year\t\t= String( date.getFullYear() );\n\t\tvar system_Month\t= String( date.getMonth() + 1 );\n\t\tvar system_Day\t\t= String( date.getDate() );\n\t\tvar system_Hour\t\t= String( date.getHours() );\n\t\tvar system_Minute\t= String( date.getMinutes() );\n\t\tvar system_Second\t= String( date.getSeconds() );\n\n\t\tsystem_Year\t\t\t= \"00\".substr(system_Year.length)\t\t+ system_Year;\n\t\tsystem_Month\t\t= \"00\".substr(system_Month.length)\t\t+ system_Month;\n\t\tsystem_Day\t\t\t= \"00\".substr(system_Day.length)\t\t+ system_Day;\n\t\tsystem_Hour\t\t\t= \"00\".substr(system_Hour.length)\t\t+ system_Hour;\n\t\tsystem_Minute\t\t= \"00\".substr(system_Minute.length)\t\t+ system_Minute;\n\t\tsystem_Second\t\t= \"00\".substr(system_Second.length)\t\t+ system_Second;\n\n\t\tvar system_time\t\t= system_Year + \"/\" + system_Month + \"/\" + system_Day + \" \" + system_Hour + \":\" + system_Minute;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Output Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\t// Output array\n\t\t//-----------------------------------------------------------------------------------------\n\t\t\tvar output\t\t= [];\n\t\t//-----------------------------------------------------------------------------------------\n\n\t\t// Output array components\n\t\t//-----------------------------------------------------------------------------------------\n\t\t\tvar output_sys_t;\n\t\t\tvar output_unitUpdate_CS\t= null;\n\t\t\tvar output_debug\t        = null;\n\t\t//-----------------------------------------------------------------------------------------\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n/*#################################################################################################################################################################################################\n\tFUNCTIONS\n#################################################################################################################################################################################################*/\n\t// Topic Breakdown\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tsystemType\t= topic;\n\n\t\tif (topicSeperator >= 0)\n\t\t{\n\t\t\tsystemType\t= topic.slice(0, topicSeperator);\n\t\t\tsystemID\t= topic.slice(topicSeperator + 1);\n\n\t\t\tindexGW_ID\t\t= topic.indexOf(\"/\", topicSeperator + 1);\n\t\t\tif (indexGW_ID >= 0)\n\t\t\t{\n\t\t\t\tsystemID\t= topic.slice(topicSeperator + 1, indexGW_ID);\n\t\t\t\tsubID_1\t\t= topic.slice(indexGW_ID + 1);\n\n\t\t\t\tindexGW_Unit\t= topic.indexOf(\"/\", indexGW_ID + 1);\n\t\t\t\tif (indexGW_Unit >= 0)\n\t\t\t\t{\n\t\t\t\t\tsubID_1\t\t= topic.slice(indexGW_ID + 1, indexGW_Unit);\n\t\t\t\t\tsubID_2\t\t= topic.slice(indexGW_Unit + 1);\n\n\t\t\t\t\tindexGW_Func\t= topic.indexOf(\"/\", indexGW_Unit + 1);\n\t\t\t\t\tif (indexGW_Func >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubID_2\t\t= topic.slice(indexGW_Unit + 1, indexGW_Func);\n\t\t\t\t\t\tsubID_3\t\t= topic.slice(indexGW_Func + 1);\n\n\t\t\t\t\t\tindex_5\t\t= topic.indexOf(\"/\", indexGW_Func + 1);\n\t\t\t\t\t\tif (index_5 >= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubID_3\t\t= topic.slice(indexGW_Func + 1, index_5);\n\t\t\t\t\t\t\tsubID_4\t\t= topic.slice(index_5 + 1);\n\n\t\t\t\t\t\t\tindex_6\t\t= topic.indexOf(\"/\", index_5 + 1);\n\t\t\t\t\t\t\tif (index_6 >= 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsubID_4\t\t= topic.slice(index_5 + 1, index_6);\n\t\t\t\t\t\t\t\tsubID_5\t\t= topic.slice(index_6 + 1);\n\n\t\t\t\t\t\t\t\tindex_7\t\t= topic.indexOf(\"/\", index_6 + 1);\n\t\t\t\t\t\t\t\tif (index_7 >= 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tsubID_5\t\t= topic.slice(index_6 + 1, index_7);\n\t\t\t\t\t\t\t\t\tsubID_6\t\t= topic.slice(index_7 + 1);\n\n\t\t\t\t\t\t\t\t\tindex_8\t\t= topic.indexOf(\"/\", index_7 + 1);\n\t\t\t\t\t\t\t\t\tif (index_8 >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsubID_6\t\t= topic.slice(index_7 + 1, index_8);\n\t\t\t\t\t\t\t\t\t\tsubID_7\t\t= topic.slice(index_8 + 1);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Contents Generation\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tif( topicSeperator > -1 )\n\t\t{\n\t\t\tif( systemType === \"GW\" )\n\t\t\t{\n\t\t\t\tif( (indexGW_ID > -1)&&( indexGW_Unit > -1 )&&(systemID === unitID) )\n\t\t\t\t{\n\t\t\t\t    output_debug    = msg;\n\t\t\t\t\t_unitID\t\t\t= systemID;\n\t\t\t\t\t_geyserDataSN\t= \"_geyserTestData_\" + _unitID;\n\n\t\t\t\t\t_geyserData\t\t= global.get(_geyserDataSN)||{\n\t\t\t\t\t\t\t\t\t\t\"SN\":\t_unitID,\n\t\t\t\t\t\t\t\t\t\t\"CS\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\"S\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\"I\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\"t\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Y\":\tsystem_Year,\n\t\t\t\t\t\t\t\t\t\t    \t\t\t\"M\":\tsystem_Month,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"D\":\tsystem_Day,\n\t\t\t\t\t\t\t\t\t\t\t    \t\t\"h\":\tsystem_Hour,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"m\":\tsystem_Minute,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"s\":\tsystem_Second\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\"A\":\tfalse,\n\t\t\t\t\t\t\t\t\t\t\t\"AVG\":\tfalse,\n\t\t\t\t\t\t\t\t\t\t\t\"G1\":{\n\t\t\t\t\t\t\t\t\t\t\t        \"T\":{\n        \t\t\t\t\t\t\t\t\t\t\t\t\"PCB\":\t\t\t0.0,\n        \t\t\t\t\t\t\t\t\t\t\t\t\"G\":\t\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t    },\n        \t\t\t\t\t\t\t\t\t\t\t\"I\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"V\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Pt\":\t{\n\t\t\t\t\t\t\t\t\t\t\t\t            \"Raw\":  {\n    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t                    },\n\t\t\t\t\t\t\t\t\t\t\t\t            \"kWh\":  {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t\t\t\t\t\t        },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"STS\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Th\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Te\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_DR\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_CS\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_PCB\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_Sc\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_An\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_DT\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_AC\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_PV\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"T\":        0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"H\":        0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"SET\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACM\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACO\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVM\": 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"S\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACOT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACCT\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"DRT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"SCB\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\"G2\":{\n\t\t\t\t\t\t\t\t\t\t\t        \"T\":{\n        \t\t\t\t\t\t\t\t\t\t\t\t\"PCB\":\t\t\t0.0,\n        \t\t\t\t\t\t\t\t\t\t\t\t\"G\":\t\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t    },\n        \t\t\t\t\t\t\t\t\t\t\t\"I\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"V\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Pt\":\t{\n\t\t\t\t\t\t\t\t\t\t\t\t            \"Raw\":  {\n    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t                    },\n\t\t\t\t\t\t\t\t\t\t\t\t            \"kWh\":  {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t\t\t\t\t\t        },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"STS\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Th\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Te\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_DR\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_CS\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_PCB\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_Sc\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_An\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_DT\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_AC\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_PV\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"T\":        0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"H\":        0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"SET\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACM\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACO\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVM\": 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"S\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACOT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACCT\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"DRT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"SCB\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\n\t\t\t\t\tif( (subID_1 === \"S\")&&( subID_2 === \"CW\" ) )\n\t\t\t\t\t{\n\t\t\t\t\t\tif( ( _geyserData.CS.S !== payload.S )||( _geyserData.CS.I !== payload.I ) )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_geyserData.CS.S\t=\tpayload.S;\n\t\t\t\t\t\t\t_geyserData.CS.I\t=\tpayload.I;\n\t\t\t\t\t\t\t_geyserData.CS.t\t=\t{\n\t\t\t\t\t\t\t\t\t\t\t    \t\t\"Y\":\tsystem_Year,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"M\":\tsystem_Month,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"D\":\tsystem_Day,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h\":\tsystem_Hour,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"m\":\tsystem_Minute,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"s\":\tsystem_Second\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n                    else if( subID_1 === \"1\" )\n\t\t\t\t\t{\n\t\t\t\t\t\tif( subID_2 === \"A\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"T\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"G\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.T.G\t= payload.T.G;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PCB\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.T.PCB\t\t= payload.T.PCB;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.I.AC\t\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.I.PV\t\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"a\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.Raw.I2AC\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.kWh.AC\t= (payload.I.AC)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.Raw.I2PV\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.kWh.PV\t= (payload.I.PV)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"STS\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if( \"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_Th        = payload.A.Tr_Th;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_Te        = payload.A.Tr_Te;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_DR        = payload.A.Tr_DR;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_CS        = payload.A.Tr_CS;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_PCB       = payload.A.Tr_PCB;\n\t\t\t\t\t\t        _geyserData.G1.STS.A_Sc         = payload.A.A_Sc;\n\t\t\t\t\t\t        _geyserData.G1.STS.A_An         = payload.A.A_An;\n\t\t\t\t\t\t        _geyserData.G1.STS.A_DT         = payload.A.A_DT;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if( \"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"AC\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.STS.O_AC     = payload.O.AC;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PV\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.STS.O_PV     = payload.O.PV;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"T\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G1.STS.T            = payload.T;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"H\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G1.STS.H            = payload.H;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (subID_2 === \"SET\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if(\"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.O.ACM    = payload.O.ACM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACO\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.O.ACO    = payload.O.ACO;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.O.PVM    = payload.O.PVM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"S\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.ACT        = payload.S.ACT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACOT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.ACOT        = payload.S.ACOT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.PVT        = payload.S.PVT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACCT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.ACCT       = payload.S.ACCT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"DRT\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.A.DRT        = payload.A.DRT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"SCB\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.A.SCB        = payload.A.SCB;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\t\t\t\t\t}   // end if unit 1\n                    else if( subID_1 === \"2\" )\n\t\t\t\t\t{\n\t\t\t\t\t\tif( subID_2 === \"A\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"T\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"G\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.T.G\t\t\t= payload.T.G;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PCB\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.T.PCB\t\t= payload.T.PCB;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.I.AC\t\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.I.PV\t\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"a\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.Raw.I2AC\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.kWh.AC\t= (payload.I.AC)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.Raw.I2PV\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.kWh.PV\t= (payload.I.PV)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"STS\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if( \"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_Th        = payload.A.Tr_Th;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_Te        = payload.A.Tr_Te;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_DR        = payload.A.Tr_DR;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_CS        = payload.A.Tr_CS;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_PCB       = payload.A.Tr_PCB;\n\t\t\t\t\t\t        _geyserData.G2.STS.A_Sc         = payload.A.A_Sc;\n\t\t\t\t\t\t        _geyserData.G2.STS.A_An         = payload.A.A_An;\n\t\t\t\t\t\t        _geyserData.G2.STS.A_DT         = payload.A.A_DT;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if( \"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"AC\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.STS.O_AC     = payload.O.AC;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PV\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.STS.O_PV     = payload.O.PV;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"T\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G2.STS.T            = payload.T;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"H\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G2.STS.H            = payload.H;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (subID_2 === \"SET\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if(\"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.O.ACM    = payload.O.ACM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACO\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.O.ACO    = payload.O.ACO;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.O.PVM    = payload.O.PVM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"S\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.ACT        = payload.S.ACT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACOT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.ACOT        = payload.S.ACOT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.PVT        = payload.S.PVT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACCT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.ACCT       = payload.S.ACCT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"DRT\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.A.DRT        = payload.A.DRT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"SCB\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.A.SCB        = payload.A.SCB;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}   // end if unit 2\n\n                    // Reset Variables to 0 if Comms is lost\n    \t\t\t    if(_geyserData.CS.S === 0)\n    \t\t\t    {\n    \t\t\t\t\t_geyserData.G1.T.G\t\t= 0;\n    \t\t\t\t\t_geyserData.G1.T.PCB\t= 0;\n    \t\t\t\t\t_geyserData.G1.I.AC\t    = 0;\n    \t\t\t\t\t_geyserData.G1.I.PV\t    = 0;\n    \t\t\t\t\t_geyserData.G2.T.G\t\t= 0;\n    \t\t\t\t\t_geyserData.G2.T.PCB\t= 0;\n    \t\t\t\t\t_geyserData.G2.I.AC\t    = 0;\n    \t\t\t\t\t_geyserData.G2.I.PV\t    = 0;\n    \t\t\t    }\n    \n    \t\t\t\tglobal.set(_geyserDataSN, _geyserData);\n    \t\t\t\tflow.set(\"unit\", unitID)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\nmsg.payload = _geyserData; // _geyserData\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":80,"wires":[["891a8eaa.69d61"]]},{"id":"32f0784a.0ad228","type":"mqtt in","z":"e2e5a56.78da658","name":"","topic":"GW/gw6A68C63ADAD23A/#","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":140,"y":80,"wires":[["5b78d27b.87a63c"]]},{"id":"ef13e07c.63a1d","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":490,"y":80,"wires":[["e3caaa7c.daf088"]]},{"id":"891a8eaa.69d61","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":810,"y":80,"wires":[]},{"id":"5b78d27b.87a63c","type":"deduplicate","z":"e2e5a56.78da658","name":"","expiry":5,"x":350,"y":80,"wires":[["ef13e07c.63a1d"],[]]},{"id":"7a862552.4d9b1c","type":"function","z":"e2e5a56.78da658","name":"Map","func":"var unit = flow.get(\"unit\");\nvar desc = \"Centurion\"\nvar PVT, ACT, ACOT;\nvar OverTemp, UnderTemp, DryBurn, Contactor, PCBTemp, Scale, Anode, DripTray, ACOn, PVOn;\nvar ACM, ACO, PVM;\nvar Temperature, kWhAC, kWhPV, Eff, ACCost, PVCost, carbon;\nvar alarms;\nvar R_kWh = parseFloat(global.get(\"R_kW\"));\n\nvar status = flow.get(\"status\");\n    OverTemp = status.OverTemp || 0;\n    UnderTemp = status.UnderTemp || 0;\n    DryBurn = status.DryBurn || 0;\n    Contactor = status.Contactor || 0;\n    PCBTemp = status.PCBTemp || 0;\n    Scale = status.Scale || 0;\n    Anode = status.Anode || 0;\n    DripTray = status.DripTray || 0;\n    ACOn = status.ACOn || 0;\n    PVOn = status.PVOn || 0;\n\nACM     =   flow.get(\"ACOn\") || 0;\nPVM     =   flow.get(\"PVOn\") || 0;\nACO     =   flow.get(\"ACOverride\") || 0;\nACT     =   flow.get(\"ac_setpoint\") || 0; \nACOT    =   flow.get(\"override_sp\") || 0; \nPVT     =   flow.get(\"pv_setpoint\") || 0; \n\nTemperature = parseFloat(flow.get(\"temperature\"));\nkWhAC = parseFloat(flow.get(\"kWhAC\"));\nkWhPV = parseFloat(flow.get(\"kWhPV\"));\nEff = parseFloat((kWhPV / (kWhAC+kWhPV)*100).toFixed(2));\nvar cost = kWhAC * 2.07;\nACCost = parseFloat(cost.toFixed(2));\ncost = kWhPV * 2.07;\nPVCost = parseFloat(cost.toFixed(2));\nvar carbon1 = (kWhPV * 0.7)/1000;\ncarbon = parseFloat(carbon1.toFixed(2));\n\nif(OverTemp==1 || UnderTemp==1 || DryBurn==1 || Contactor==1 || PCBTemp==1 || Scale==1 || Anode==1 || DripTray==1)\n{\n    if(OverTemp==1){alarms=\"Over Temperature\"}\n    if(UnderTemp==1){alarms=\"Low Temperature\"}\n    if(DryBurn==1){alarms=\"Dry Burn Alarm\"}\n    if(Contactor==1){alarms=\"Contactor Fault\"}\n    if(PCBTemp==1){alarms=\"PCB Temperature Hi\"}\n    if(Scale==1){alarms=\"Scale Build-up\"}\n    if(Anode==1){alarms=\"Anode Depletion Alarm\"}\n    if(DripTray==1){alarms=\"Driptray Water Alarm\"}\n}\nelse\n{\n    alarms = \"None\";\n}\nvar gwState = flow.get(\"state\");\nvar _data = {};\n_data = {\n    \"unit\": unit,\n    \"desc\": desc,\n    \"ACOn\": ACM,\n    \"ACOverride\": ACO,\n    \"PVOn\": PVM,\n    \"PVSetpoint\": PVT,\n    \"ACSetpoint\": ACT,\n    \"OverrideSP\": ACOT,\n    \"Temperature\": Temperature,\n    \"kWhAC\": kWhAC,\n    \"kWhPV\": kWhPV,\n    \"ACCost\": ACCost,\n    \"PVCost\": PVCost,\n    \"carbon\": carbon,\n    \"Eff\": Eff,\n    \"Alarms\": alarms,\n    \"gwState\": gwState,\n    \"R_kWh\":R_kWh\n};\nglobal.set(unit+\"_DashData\", _data);\nvar output\t= [\n\t\t\t\t{\"topic\":unit+\"_DashData\",\"payload\":_data}\n\t\t\t];\nflow.set(\"unit\", unit);\nreturn output;","outputs":1,"noerr":0,"x":270,"y":120,"wires":[["58ef8ef2.c9e2e"]]},{"id":"58ef8ef2.c9e2e","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":470,"y":120,"wires":[]},{"id":"62a4d282.382b2c","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"60","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":110,"y":120,"wires":[["7a862552.4d9b1c"]]},{"id":"ff1e898a.ac72f8","type":"mqtt in","z":"e2e5a56.78da658","name":"Status","topic":"GW/gw6A68C63ADAD23A/1/STS","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":70,"y":320,"wires":[["1f71711.22d3a8f"]]},{"id":"ac2a1e63.73ecf","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":370,"y":320,"wires":[["25cf28ee.d15e38"]]},{"id":"25cf28ee.d15e38","type":"function","z":"e2e5a56.78da658","name":"Status","func":"var unit = flow.get(\"unit\");\nvar Tr_Th = msg.payload.A.Tr_Th;\nvar Tr_Te = msg.payload.A.Tr_Te;\nvar Tr_DR = msg.payload.A.Tr_DR;\nvar Tr_CS = msg.payload.A.Tr_CS;\nvar Tr_PCB = msg.payload.A.Tr_PCB;\nvar A_Sc = msg.payload.A.A_Sc;\nvar A_An = msg.payload.A.A_An;\nvar A_DT = msg.payload.A.A_DT;\n\nvar O_AC = msg.payload.O.AC;\nvar O_PV = msg.payload.O.PV;\n\nvar S_T = msg.payload.T;\nvar S_H = msg.payload.H;\n\nvar ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toISOString();\ne = d.getTime();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = a[3];\nvar m = a[4];\nvar s = a[5];\nvar y = a[0];\nvar month = a[1];\nvar day = a[2];\n\nvar logDate = (y+\"-\"+month+\"-\"+day);\nvar logTime = (h+\":\"+m+\":\"+s);\n\n\nvar insertSelect = \"INSERT INTO [dbo].[statusData]([GW_Unit],[entryDate],[entryTime],[A_Tr_Th],[A_Tr_Te],[A_Tr_DR],[A_Tr_CS],[A_Tr_PCB],[A_A_Sc],[A_A_An],[A_A_DT],[O_AC],[O_PV],[T],[H])\";\nvar values = \"VALUES ('G1_\"+unit+\"','\"+logDate+\"','\"+logTime+\"',\"+Tr_Th+\",\"+Tr_Te+\",\"+Tr_DR+\",\"+Tr_CS+\",\";\nvar values2 = Tr_PCB+\",\"+A_Sc+\",\"+A_An+\",\"+A_DT+\",\"+O_AC+\",\"+O_PV+\",\"+S_T+\",\"+S_H+\")\";\n\nmsg.payload = insertSelect + \" \" + values + values2;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Time: \"+logTime});\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":320,"wires":[["dfbeb9.b9043148"]]},{"id":"1f71711.22d3a8f","type":"delay","z":"e2e5a56.78da658","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":220,"y":320,"wires":[["ac2a1e63.73ecf"]]},{"id":"94ca6817.08a498","type":"ui_template","z":"e2e5a56.78da658","group":"2a63097e.6e4f16","name":"Dial","order":4,"width":"4","height":"4","format":"<div id=\"thermostat\"></div>\n\n<style>\n@import url(http://fonts.googleapis.com/css?family=Open+Sans:300);\n#thermostat {\n  margin: 0 auto;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n.dial {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.dial.away .dial__ico__leaf {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--target {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--target--half {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--away {\n  opacity: 1;\n}\n.dial .dial__shape {\n  -webkit-transition: fill 0.5s;\n  transition: fill 0.5s;\n}\n.dial__ico__leaf {\n  fill: #13EB13;\n  opacity: 0;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n  pointer-events: none;\n}\n.dial.has-leaf .dial__ico__leaf {\n  display: block;\n  opacity: 1;\n  pointer-events: initial;\n}\n.dial__editableIndicator {\n  fill: white;\n  fill-rule: evenodd;\n  opacity: 0;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n}\n.dial--edit .dial__editableIndicator {\n  opacity: 1;\n}\n.dial--state--off .dial__shape {\n  fill: #3d3c3c;\n}\n.dial--state--heating .dial__shape {\n  fill: #E36304;\n}\n.dial--state--cooling .dial__shape {\n  fill: #3c9517;\n}\n.dial__ticks path {\n  fill: rgba(255, 255, 255, 0.3);\n}\n.dial__ticks path.active {\n  fill: rgba(255, 255, 255, 0.8);\n}\n.dial text {\n  fill: white;\n  text-anchor: middle;\n  font-family: Helvetica, sans-serif;\n  alignment-baseline: central;\n}\n.dial__lbl--target {\n  font-size: 120px;\n  font-weight: bold;\n}\n.dial__lbl--target--half {\n  font-size: 40px;\n  font-weight: bold;\n  opacity: 0;\n  -webkit-transition: opacity 0.1s;\n  transition: opacity 0.1s;\n}\n.dial__lbl--target--half.shown {\n  opacity: 1;\n  -webkit-transition: opacity 0s;\n  transition: opacity 0s;\n}\n.dial__lbl--ambient {\n  font-size: 22px;\n  font-weight: bold;\n}\n.dial__lbl--away {\n  font-size: 72px;\n  font-weight: bold;\n  opacity: 0;\n  pointer-events: none;\n}\n#controls {\n  font-family: Open Sans;\n  background-color: rgba(255, 255, 255, 0.25);\n  padding: 20px;\n  border-radius: 5px;\n  position: absolute;\n  left: 50%;\n  -webkit-transform: translatex(-50%);\n          transform: translatex(-50%);\n  margin-top: 20px;\n}\n#controls label {\n  text-align: left;\n  display: block;\n}\n#controls label span {\n  display: inline-block;\n  width: 200px;\n  text-align: right;\n  font-size: 0.8em;\n  text-transform: uppercase;\n}\n#controls p {\n  margin: 0;\n  margin-bottom: 1em;\n  padding-bottom: 1em;\n  border-bottom: 2px solid #ccc;\n}\n</style>\n<script>\n    var thermostatDial = (function() {\n\t\n\t/*\n\t * Utility functions\n\t */\n\t\n\t// Create an element with proper SVG namespace, optionally setting its attributes and appending it to another element\n\tfunction createSVGElement(tag,attributes,appendTo) {\n\t\tvar element = document.createElementNS('http://www.w3.org/2000/svg',tag);\n\t\tattr(element,attributes);\n\t\tif (appendTo) {\n\t\t\tappendTo.appendChild(element);\n\t\t}\n\t\treturn element;\n\t}\n\t\n\t// Set attributes for an element\n\tfunction attr(element,attrs) {\n\t\tfor (var i in attrs) {\n\t\t\telement.setAttribute(i,attrs[i]);\n\t\t}\n\t}\n\t\n\t// Rotate a cartesian point about given origin by X degrees\n\tfunction rotatePoint(point, angle, origin) {\n\t\tvar radians = angle * Math.PI/180;\n\t\tvar x = point[0]-origin[0];\n\t\tvar y = point[1]-origin[1];\n\t\tvar x1 = x*Math.cos(radians) - y*Math.sin(radians) + origin[0];\n\t\tvar y1 = x*Math.sin(radians) + y*Math.cos(radians) + origin[1];\n\t\treturn [x1,y1];\n\t}\n\t\n\t// Rotate an array of cartesian points about a given origin by X degrees\n\tfunction rotatePoints(points, angle, origin) {\n\t\treturn points.map(function(point) {\n\t\t\treturn rotatePoint(point, angle, origin);\n\t\t});\n\t}\n\t\n\t// Given an array of points, return an SVG path string representing the shape they define\n\tfunction pointsToPath(points) {\n\t\treturn points.map(function(point, iPoint) {\n\t\t\treturn (iPoint>0?'L':'M') + point[0] + ' ' + point[1];\n\t\t}).join(' ')+'Z';\n\t}\n\t\n\tfunction circleToPath(cx, cy, r) {\n\t\treturn [\n\t\t\t\"M\",cx,\",\",cy,\n\t\t\t\"m\",0-r,\",\",0,\n\t\t\t\"a\",r,\",\",r,0,1,\",\",0,r*2,\",\",0,\n\t\t\t\"a\",r,\",\",r,0,1,\",\",0,0-r*2,\",\",0,\n\t\t\t\"z\"\n\t\t].join(' ').replace(/\\s,\\s/g,\",\");\n\t}\n\t\n\tfunction donutPath(cx,cy,rOuter,rInner) {\n\t\treturn circleToPath(cx,cy,rOuter) + \" \" + circleToPath(cx,cy,rInner);\n\t}\n\t\n\t// Restrict a number to a min + max range\n\tfunction restrictToRange(val,min,max) {\n\t\tif (val < min) return min;\n\t\tif (val > max) return max;\n\t\treturn val;\n\t}\n\t\n\t// Round a number to the nearest 0.5\n\tfunction roundHalf(num) {\n\t\treturn Math.round(num*2)/2;\n\t}\n\t\n\tfunction setClass(el, className, state) {\n\t\tel.classList[state ? 'add' : 'remove'](className);\n\t}\n\t\n\t/*\n\t * The \"MEAT\"\n\t */\n\n\treturn function(targetElement, options) {\n\t\tvar self = this;\n\t\t\n\t\t/*\n\t\t * Options\n\t\t */\n\t\toptions = options || {};\n\t\toptions = {\n\t\t\tdiameter: options.diameter || 400,\n\t\t\tminValue: options.minValue || 00, // Minimum value for target temperature\n\t\t\tmaxValue: options.maxValue || 85, // Maximum value for target temperature\n\t\t\tnumTicks: options.numTicks || 200, // Number of tick lines to display around the dial\n\t\t\tonSetTargetTemperature: options.onSetTargetTemperature || function() {}, // Function called when new target temperature set by the dial\n\t\t};\n\t\t\n\t\t/*\n\t\t * Properties - calculated from options in many cases\n\t\t */\n\t\tvar properties = {\n\t\t\ttickDegrees: 300, //  Degrees of the dial that should be covered in tick lines\n\t\t\trangeValue: options.maxValue - options.minValue,\n\t\t\tradius: options.diameter/2,\n\t\t\tticksOuterRadius: options.diameter / 30,\n\t\t\tticksInnerRadius: options.diameter / 8,\n\t\t\thvac_states: ['off', 'heating', 'cooling'],\n\t\t\tdragLockAxisDistance: 15,\n\t\t}\n\t\tproperties.lblAmbientPosition = [properties.radius, properties.ticksOuterRadius-(properties.ticksOuterRadius-properties.ticksInnerRadius)/2]\n\t\tproperties.offsetDegrees = 180-(360-properties.tickDegrees)/2;\n\t\t\n\t\t/*\n\t\t * Object state\n\t\t */\n\t\tvar state = {\n\t\t\ttarget_temperature: options.minValue,\n\t\t\tambient_temperature: options.minValue,\n\t\t\thvac_state: properties.hvac_states[0],\n\t\t\thas_leaf: false,\n\t\t\taway: false\n\t\t};\n\t\t\n\t\t/*\n\t\t * Property getter / setters\n\t\t */\n\t\tObject.defineProperty(this,'target_temperature',{\n\t\t\tget: function() {\n\t\t\t\treturn state.target_temperature;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.target_temperature = restrictTargetTemperature(+val);\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'ambient_temperature',{\n\t\t\tget: function() {\n\t\t\t\treturn state.ambient_temperature;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.ambient_temperature = roundHalf(+val);\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'hvac_state',{\n\t\t\tget: function() {\n\t\t\t\treturn state.hvac_state;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tif (properties.hvac_states.indexOf(val)>=0) {\n\t\t\t\t\tstate.hvac_state = val;\n\t\t\t\t\trender();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'has_leaf',{\n\t\t\tget: function() {\n\t\t\t\treturn state.has_leaf;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.has_leaf = !!val;\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'away',{\n\t\t\tget: function() {\n\t\t\t\treturn state.away;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.away = !!val;\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\t\n\t\t/*\n\t\t * SVG\n\t\t */\n\t\tvar svg = createSVGElement('svg',{\n\t\t\twidth: '100%', //options.diameter+'px',\n\t\t\theight: '100%', //options.diameter+'px',\n\t\t\tviewBox: '0 0 '+options.diameter+' '+options.diameter,\n\t\t\tclass: 'dial'\n\t\t},targetElement);\n\t\t// CIRCULAR DIAL\n\t\tvar circle = createSVGElement('circle',{\n\t\t\tcx: properties.radius,\n\t\t\tcy: properties.radius,\n\t\t\tr: properties.radius,\n\t\t\tclass: 'dial__shape'\n\t\t},svg);\n\t\t// EDITABLE INDICATOR\n\t\tvar editCircle = createSVGElement('path',{\n\t\t\td: donutPath(properties.radius,properties.radius,properties.radius-4,properties.radius-8),\n\t\t\tclass: 'dial__editableIndicator',\n\t\t},svg);\n\t\t\n\t\t/*\n\t\t * Ticks\n\t\t */\n\t\tvar ticks = createSVGElement('g',{\n\t\t\tclass: 'dial__ticks'\t\n\t\t},svg);\n\t\tvar tickPoints = [\n\t\t\t[properties.radius-1, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1, properties.ticksInnerRadius],\n\t\t\t[properties.radius-1, properties.ticksInnerRadius]\n\t\t];\n\t\tvar tickPointsLarge = [\n\t\t\t[properties.radius-1.5, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1.5, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1.5, properties.ticksInnerRadius+20],\n\t\t\t[properties.radius-1.5, properties.ticksInnerRadius+20]\n\t\t];\n\t\tvar theta = properties.tickDegrees/options.numTicks;\n\t\tvar tickArray = [];\n\t\tfor (var iTick=0; iTick<options.numTicks; iTick++) {\n\t\t\ttickArray.push(createSVGElement('path',{d:pointsToPath(tickPoints)},ticks));\n\t\t};\n\t\t\n\t\t/*\n\t\t * Labels\n\t\t */\n\t\tvar lblTarget = createSVGElement('text',{\n\t\t\tx: properties.radius,\n\t\t\ty: properties.radius,\n\t\t\tclass: 'dial__lbl dial__lbl--target'\n\t\t},svg);\n\t\tvar lblTarget_text = document.createTextNode('');\n\t\tlblTarget.appendChild(lblTarget_text);\n\t\t//\n\t\tvar lblTargetHalf = createSVGElement('text',{\n\t\t\tx: properties.radius + properties.radius/2.5,\n\t\t\ty: properties.radius - properties.radius/8,\n\t\t\tclass: 'dial__lbl dial__lbl--target--half'\n\t\t},svg);\n\t\tvar lblTargetHalf_text = document.createTextNode('5');\n\t\tlblTargetHalf.appendChild(lblTargetHalf_text);\n\t\t//\n\t\tvar lblAmbient = createSVGElement('text',{\n\t\t\tclass: 'dial__lbl dial__lbl--ambient'\n\t\t},svg);\n\t\tvar lblAmbient_text = document.createTextNode('');\n\t\tlblAmbient.appendChild(lblAmbient_text);\n\t\t//\n\t\tvar lblAway = createSVGElement('text',{\n\t\t\tx: properties.radius,\n\t\t\ty: properties.radius,\n\t\t\tclass: 'dial__lbl dial__lbl--away'\n\t\t},svg);\n\t\tvar lblAway_text = document.createTextNode('AWAY');\n\t\tlblAway.appendChild(lblAway_text);\n\t\t//\n\t\tvar icoLeaf = createSVGElement('path',{\n\t\t\tclass: 'dial__ico__leaf'\n\t\t},svg);\n\t\t\n\t\t/*\n\t\t * LEAF\n\t\t */\n\t\tvar leafScale = properties.radius/5/100;\n\t\tvar leafDef = [\"M\", 3, 84, \"c\", 24, 17, 51, 18, 73, -6, \"C\", 100, 52, 100, 22, 100, 4, \"c\", -13, 15, -37, 9, -70, 19, \"C\", 4, 32, 0, 63, 0, 76, \"c\", 6, -7, 18, -17, 33, -23, 24, -9, 34, -9, 48, -20, -9, 10, -20, 16, -43, 24, \"C\", 22, 63, 8, 78, 3, 84, \"z\"].map(function(x) {\n\t\t\treturn isNaN(x) ? x : x*leafScale;\n\t\t}).join(' ');\n\t\tvar translate = [properties.radius-(leafScale*100*0.5),properties.radius*1.5]\n\t\tvar icoLeaf = createSVGElement('path',{\n\t\t\tclass: 'dial__ico__leaf',\n\t\t\td: leafDef,\n\t\t\ttransform: 'translate('+translate[0]+','+translate[1]+')'\n\t\t},svg);\n\t\t\t\n\t\t/*\n\t\t * RENDER\n\t\t */\n\t\tfunction render() {\n\t\t\trenderAway();\n\t\t\trenderHvacState();\n\t\t\trenderTicks();\n\t\t\trenderTargetTemperature();\n\t\t\trenderAmbientTemperature();\n\t\t\trenderLeaf();\n\t\t}\n\t\trender();\n\n\t\t/*\n\t\t * RENDER - ticks\n\t\t */\n\t\tfunction renderTicks() {\n\t\t\tvar vMin, vMax;\n\t\t\tif (self.away) {\n\t\t\t\tvMin = self.ambient_temperature;\n\t\t\t\tvMax = vMin;\n\t\t\t} else {\n\t\t\t\tvMin = Math.min(self.ambient_temperature, self.target_temperature);\n\t\t\t\tvMax = Math.max(self.ambient_temperature, self.target_temperature);\n\t\t\t}\n\t\t\tvar min = restrictToRange(Math.round((vMin-options.minValue)/properties.rangeValue * options.numTicks),0,options.numTicks-1);\n\t\t\tvar max = restrictToRange(Math.round((vMax-options.minValue)/properties.rangeValue * options.numTicks),0,options.numTicks-1);\n\t\t\t//\n\t\t\ttickArray.forEach(function(tick,iTick) {\n\t\t\t\tvar isLarge = iTick==min || iTick==max;\n\t\t\t\tvar isActive = iTick >= min && iTick <= max;\n\t\t\t\tattr(tick,{\n\t\t\t\t\td: pointsToPath(rotatePoints(isLarge ? tickPointsLarge: tickPoints,iTick*theta-properties.offsetDegrees,[properties.radius, properties.radius])),\n\t\t\t\t\tclass: isActive ? 'active' : ''\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\n\t\t/*\n\t\t * RENDER - ambient temperature\n\t\t */\n\t\tfunction renderAmbientTemperature() {\n\t\t\tlblAmbient_text.nodeValue = Math.floor(self.ambient_temperature);\n\t\t\tif (self.ambient_temperature%1!=0) {\n\t\t\t\tlblAmbient_text.nodeValue += 'âµ';\n\t\t\t}\n\t\t\tvar peggedValue = restrictToRange(self.ambient_temperature, options.minValue, options.maxValue);\n\t\t\tdegs = properties.tickDegrees * (peggedValue-options.minValue)/properties.rangeValue - properties.offsetDegrees;\n\t\t\tif (peggedValue > self.target_temperature) {\n\t\t\t\tdegs += 8;\n\t\t\t} else {\n\t\t\t\tdegs -= 8;\n\t\t\t}\n\t\t\tvar pos = rotatePoint(properties.lblAmbientPosition,degs,[properties.radius, properties.radius]);\n\t\t\tattr(lblAmbient,{\n\t\t\t\tx: pos[0],\n\t\t\t\ty: pos[1]\n\t\t\t});\n\t\t}\n\n\t\t/*\n\t\t * RENDER - target temperature\n\t\t */\n\t\tfunction renderTargetTemperature() {\n\t\t\tlblTarget_text.nodeValue = Math.floor(self.target_temperature);\n\t\t\tsetClass(lblTargetHalf,'shown',self.target_temperature%1!=0);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - leaf\n\t\t */\n\t\tfunction renderLeaf() {\n\t\t\tsetClass(svg,'has-leaf',self.has_leaf);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - HVAC state\n\t\t */\n\t\tfunction renderHvacState() {\n\t\t\tArray.prototype.slice.call(svg.classList).forEach(function(c) {\n\t\t\t\tif (c.match(/^dial--state--/)) {\n\t\t\t\t\tsvg.classList.remove(c);\n\t\t\t\t};\n\t\t\t});\n\t\t\tsvg.classList.add('dial--state--'+self.hvac_state);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - away\n\t\t */\n\t\tfunction renderAway() {\n\t\t\tsvg.classList[self.away ? 'add' : 'remove']('away');\n\t\t}\n\t\t\n\t\t/*\n\t\t * Drag to control\n\t\t */\n\t\tvar _drag = {\n\t\t\tinProgress: false,\n\t\t\tstartPoint: null,\n\t\t\tstartTemperature: 0,\n\t\t\tlockAxis: undefined\n\t\t};\n\t\t\n\t\tfunction eventPosition(ev) {\n\t\t\tif (ev.targetTouches && ev.targetTouches.length) {\n\t\t\t\treturn  [ev.targetTouches[0].clientX, ev.targetTouches[0].clientY];\n\t\t\t} else {\n\t\t\t\treturn [ev.x, ev.y];\n\t\t\t};\n\t\t}\n\t\t\n\t\tvar startDelay;\n\t\tfunction dragStart(ev) {\n\t\t\tstartDelay = setTimeout(function() {\n\t\t\t\tsetClass(svg, 'dial--edit', true);\n\t\t\t\t_drag.inProgress = true;\n\t\t\t\t_drag.startPoint = eventPosition(ev);\n\t\t\t\t_drag.startTemperature = self.ambient_temperature || options.minValue;\n\t\t\t\t_drag.lockAxis = undefined;\n\t\t\t},1000);\n\t\t};\n\t\t\n\t\tfunction dragEnd (ev) {\n\t\t\tclearTimeout(startDelay);\n\t\t\tsetClass(svg, 'dial--edit', false);\n\t\t\tif (!_drag.inProgress) return;\n\t\t\t_drag.inProgress = false;\n\t\t\tif (self.ambient_temperature != _drag.startTemperature) {\n\t\t\t\tif (typeof options.onSetTargetTemperature == 'function') {\n\t\t\t\t\toptions.onSetTargetTemperature(self.ambient_temperature);\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t\t\n\t\tfunction dragMove(ev) {\n\t\t\tev.preventDefault();\n\t\t\tif (!_drag.inProgress) return;\n\t\t\tvar evPos =  eventPosition(ev);\n\t\t\tvar dy = _drag.startPoint[1]-evPos[1];\n\t\t\tvar dx = evPos[0] - _drag.startPoint[0];\n\t\t\tvar dxy;\n\t\t\tif (_drag.lockAxis == 'x') {\n\t\t\t\tdxy  = dx;\n\t\t\t} else if (_drag.lockAxis == 'y') {\n\t\t\t\tdxy = dy;\n\t\t\t} else if (Math.abs(dy) > properties.dragLockAxisDistance) {\n\t\t\t\t_drag.lockAxis = 'y';\n\t\t\t\tdxy = dy;\n\t\t\t} else if (Math.abs(dx) > properties.dragLockAxisDistance) {\n\t\t\t\t_drag.lockAxis = 'x';\n\t\t\t\tdxy = dx;\n\t\t\t} else {\n\t\t\t\tdxy = (Math.abs(dy) > Math.abs(dx)) ? dy : dx;\n\t\t\t};\n\t\t\tvar dValue = (dxy*getSizeRatio())/(options.diameter)*properties.rangeValue;\n\t\t\tself.ambient_temperature = roundHalf(_drag.startTemperature+dValue);\n\t\t}\n\t\t\n\t\tsvg.addEventListener('mousedown',dragStart);\n\t\tsvg.addEventListener('touchstart',dragStart);\n\t\t\n\t\tsvg.addEventListener('mouseup',dragEnd);\n\t\tsvg.addEventListener('mouseleave',dragEnd);\n\t\tsvg.addEventListener('touchend',dragEnd);\n\t\t\n\t\tsvg.addEventListener('mousemove',dragMove);\n\t\tsvg.addEventListener('touchmove',dragMove);\n\t\t//\n\t\t\n\t\t/*\n\t\t * Helper functions\n\t\t */\n\t\tfunction restrictTargetTemperature(t) {\n\t\t\treturn restrictToRange(roundHalf(t),options.minValue,options.maxValue);\n\t\t}\n\t\t\n\t\tfunction angle(point) {\n\t\t\tvar dx = point[0] - properties.radius;\n\t\t\tvar dy = point[1] - properties.radius;\n\t\t\tvar theta = Math.atan(dx/dy) / (Math.PI/180);\n\t\t\tif (point[0]>=properties.radius && point[1] < properties.radius) {\n\t\t\t\ttheta = 90-theta - 90;\n\t\t\t} else if (point[0]>=properties.radius && point[1] >= properties.radius) {\n\t\t\t\ttheta = 90-theta + 90;\n\t\t\t} else if (point[0]<properties.radius && point[1] >= properties.radius) {\n\t\t\t\ttheta = 90-theta + 90;\n\t\t\t} else if (point[0]<properties.radius && point[1] < properties.radius) {\n\t\t\t\ttheta = 90-theta+270;\n\t\t\t}\n\t\t\treturn theta;\n\t\t};\n\t\t\n\t\tfunction getSizeRatio() {\n\t\t\treturn options.diameter / targetElement.clientWidth;\n\t\t}\n\t\t\n\t};\n})();\n\n/* ==== */\n(function(scope) {\n    \n    var nest = new thermostatDial(document.getElementById('thermostat'),{\n    \tonSetTargetTemperature: function(v) {\n    \t\tscope.send({topic: \"target_temperature\", payload: v});\n    \t}\n    });\n\n\n    scope.$watch('msg', function(data) {\n        //console.log(data.topic+\"  \"+data.payload);\n            nest.ambient_temperature = data.payload.temperature;\n            nest.target_temperature = data.payload.setpoint;\n            nest.hvac_state = data.payload.state;\n            nest.has_leaf = data.payload.leaf;\n            nest.away = data.payload.away;\n    });\n})(scope);\n\n</script>","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":530,"y":480,"wires":[[]]},{"id":"76df650.8eae69c","type":"ui_template","z":"e2e5a56.78da658","group":"2a63097e.6e4f16","name":"Title","order":1,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: #273746;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EAECEE;\"\n            ng-style=\"{background: #EAECEE}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":530,"y":420,"wires":[[]]},{"id":"7fd02cca.f79c24","type":"ui_template","z":"e2e5a56.78da658","group":"2a63097e.6e4f16","name":"Alarms","order":6,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: left;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EEEEEE;\"\n            ng-style=\"{background: msg.payload == '1' ? '#E65100' : '#EEEEEE'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":540,"y":520,"wires":[[]]},{"id":"fa72111a.3d17","type":"comment","z":"e2e5a56.78da658","name":"Dashboard 1","info":"","x":90,"y":380,"wires":[]},{"id":"a5478042.26b77","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"10","crontab":"","once":true,"onceDelay":"0.3","topic":"","payload":"","payloadType":"date","x":110,"y":420,"wires":[["fead0fac.b7d61"]]},{"id":"d82dcf0e.58b5f","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nvar temperature;    // 0-100\nvar setpoint;       // 0-100\nvar gwState;        // \"heating\", \"cooling\"\nvar leaf;\nvar away = flow.get(\"enabled1\") || 0;\nvar _output = {};\n\n\nif(payload.G1.STS.O_PV===1){gwState = \"cooling\";}\nif(payload.G1.STS.O_AC===1){gwState = \"heating\";}\nif(payload.G1.STS.O_PV===0 && payload.G1.STS.O_AC===0){gwState = \"off\";}\n\ntemperature = parseInt(payload.G1.T.G);\n\nif (gwState == \"heating\")\n{\n    setpoint = parseInt(payload.G1.SET.S.ACT);\n}\nelse if(gwState == \"cooling\")\n{\n    setpoint = parseInt(payload.G1.SET.S.PVT);\n}\n\nleaf = 0;\n//away = 0;   // holiday mode\n\nvar output\t= [];\n\nvar _output = {\n        \"payload\": {\n\t\t\t\t    \"temperature\":setpoint,\n\t\t\t\t    \"setpoint\":temperature,\n\t\t\t\t    \"state\":gwState,\n\t\t\t\t    \"leaf\":leaf,\n\t\t\t\t    \"away\":away\n        }\n};\noutput = [\n\t\t\t_output\n\t\t];\n\nreturn output;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":480,"wires":[["94ca6817.08a498"]]},{"id":"bec93587.87bf58","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload=1\nmsg.text = \"Geyser 1\";\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":420,"wires":[["76df650.8eae69c"]]},{"id":"fead0fac.b7d61","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = flow.get(\"unit\");\nmsg.unit = 1;\nmsg.desc = \"GeyserWorx\"\nmsg.data = global.get(\"_geyserTestData_\"+msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":420,"wires":[["bec93587.87bf58","d82dcf0e.58b5f","c2af79bb.42ae88","f727e2ef.56e8e","29d34438.30491c","f2e7482b.c2b2c8","ea077ddc.e08e6"]]},{"id":"c2af79bb.42ae88","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nvar alarms;\n\nif(payload.G1.STS.Tr_Th==1 || payload.G1.STS.Tr_Te==1 || payload.G1.STS.Tr_DR==1 || payload.G1.STS.A_Sc==1 || payload.G1.STS.A_An==1 || payload.G1.STS.A_DT==1)\n{\n    if(payload.G1.STS.Tr_Th==1){alarms=\"Over Temperature\"}\n    if(payload.G1.STS.Tr_Te==1){alarms=\"Low Temperature\"}\n    if(payload.G1.STS.Tr_DR==1){alarms=\"Dry Burn Alarm\"}\n//    if(payload.G1.STS.Tr_CS==1){alarms=\"Contactor Fault\"}\n    if(payload.G1.STS.A_Sc==1){alarms=\"Scale Build-up\"}\n    if(payload.G1.STS.A_An==1){alarms=\"Anode Depletion Alarm\"}\n    if(payload.G1.STS.A_DT==1){alarms=\"Driptray Water Alarm\"}\n}\nelse\n{\n    alarms = \"None\";\n}\n\nmsg.text = \"Alarms: <b>\"+alarms+\"</b>\";\nif(alarms != \"None\")\n{\n    msg.payload = \"1\";\n}\nelse\n{\n    msg.payload = \"0\";\n}\nflow.set(\"status\", alarms);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":520,"wires":[["7fd02cca.f79c24"]]},{"id":"f727e2ef.56e8e","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nif(payload.G1.STS.O_AC===0)\n{\n    msg.topic = \"AC:Off\"\n    msg.text = msg.topic;\n}\nelse\n{\n    msg.topic = \"AC:On\"\n    msg.text = msg.topic;\n}\nmsg.payload     = payload.G1.STS.O_AC;\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":440,"wires":[["f0c4f917.c5b988"]]},{"id":"29d34438.30491c","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nif(payload.G1.SET.O.ACO===0)\n{\n    msg.topic = \"Boost\"\n    msg.text = msg.topic;\n}\nelse\n{\n    msg.topic = \"Boost\"\n    msg.text = msg.topic;\n}\nmsg.payload     = payload.G1.SET.O.ACO;\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":460,"wires":[["5db6b564.cd089c"]]},{"id":"368dd8fb.bc1b88","type":"mqtt out","z":"e2e5a56.78da658","name":"Reset Alarms","topic":"GWR/gw6A68C63ADAD23A/1/STS","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":710,"y":560,"wires":[]},{"id":"93c81578.f50508","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"A\":{\n    \t\t\t\t    \"Tr_DR\": \"\",\n    \t\t\t\t    \"A_Sc\": \"\",\n    \t\t\t\t    \"A_An\": \"\",\n    \t\t\t\t    \"A_DT\": \"\"\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":390,"y":560,"wires":[["368dd8fb.bc1b88"]]},{"id":"e8d7ee9b.3c0b4","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"2a63097e.6e4f16","order":7,"width":"0","height":"0","passthru":false,"label":"Reset","tooltip":"","color":"","bgcolor":"grey","icon":"","payload":"","payloadType":"str","topic":"","x":250,"y":560,"wires":[["93c81578.f50508"]]},{"id":"f0c4f917.c5b988","type":"ui_template","z":"e2e5a56.78da658","group":"2a63097e.6e4f16","name":"AC","order":2,"width":"2","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'DeepSkyBlue' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":530,"y":440,"wires":[[]]},{"id":"5db6b564.cd089c","type":"ui_template","z":"e2e5a56.78da658","group":"2a63097e.6e4f16","name":"Boost","order":3,"width":"2","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'DeepSkyBlue' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":530,"y":460,"wires":[[]]},{"id":"f2e7482b.c2b2c8","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nvar press = parseInt(payload.G1.I.AC);\nmsg.payload = press.toFixed(1);\nmsg.topic = \"Pressure G1\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":500,"wires":[[]]},{"id":"a1212e28.94918","type":"comment","z":"e2e5a56.78da658","name":"Settings 1","info":"","x":80,"y":640,"wires":[]},{"id":"80bad47c.7ffed8","type":"function","z":"e2e5a56.78da658","name":"ACM","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACM\");\nif(n===true)\n{\n    msg.payload = msg.payload.O.ACM;\n    msg.text = \"AC Control\"    ;\n    node.status({text:msg.payload});\n    msg.topic = \"AC\";\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":510,"y":680,"wires":[["4a15f69.b94f708","66eed9e7.902818"]]},{"id":"c69c9bce.484648","type":"function","z":"e2e5a56.78da658","name":"ACO","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACO\");\nif(n===true)\n{\n    msg.payload = msg.payload.O.ACO;\n    msg.text = \"Boost\"\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":510,"y":720,"wires":[["1ad45f99.6ede7","a2b3f2e6.4136e"]]},{"id":"db5d14d5.56e5e8","type":"function","z":"e2e5a56.78da658","name":"ACT","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACT\");\nif(n===true)\n{\n    msg.payload = msg.payload.S.ACT;\n    node.status({text:msg.payload});\n    msg.topic = \"setpoint\";\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":510,"y":760,"wires":[["1305b8ee.33f157"]]},{"id":"62ce4d9e.3523e4","type":"function","z":"e2e5a56.78da658","name":"ACOT","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACOT\");\nif(n===true)\n{\n    msg.payload = msg.payload.S.ACOT;\n    node.status({text:msg.payload});\n    msg.topic = \"setpoint\";\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":510,"y":800,"wires":[["f260874.60cad78"]]},{"id":"4a15f69.b94f708","type":"ui_template","z":"e2e5a56.78da658","group":"e29d4c40.387d8","name":"Status","order":2,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'Orange' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":630,"y":680,"wires":[[]]},{"id":"1ad45f99.6ede7","type":"ui_template","z":"e2e5a56.78da658","group":"e29d4c40.387d8","name":"Status","order":3,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'Orange' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":630,"y":720,"wires":[[]]},{"id":"523b1a95.5302e4","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":370,"y":680,"wires":[["80bad47c.7ffed8","c69c9bce.484648","db5d14d5.56e5e8","62ce4d9e.3523e4","f0a8eeea.a1fe8","12f9b2e6.fca13d","e8f23611.23ef88"]]},{"id":"a78dbfee.6f286","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw6A68C63ADAD23A/1/SET","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1090,"y":680,"wires":[]},{"id":"c22b4e6f.78f87","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"S\":{\n    \t\t\t\t    \"ACT\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nreturn output;","outputs":1,"noerr":0,"x":920,"y":760,"wires":[["a78dbfee.6f286"]]},{"id":"1305b8ee.33f157","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"AC Setpoint","tooltip":"","group":"e29d4c40.387d8","order":8,"width":"0","height":"0","passthru":false,"mode":"number","delay":"0","topic":"","x":770,"y":760,"wires":[["c22b4e6f.78f87"]]},{"id":"5d374718.d67ac8","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"S\":{\n    \t\t\t\t    \"ACOT\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\n\nreturn output;","outputs":1,"noerr":0,"x":920,"y":800,"wires":[["a78dbfee.6f286"]]},{"id":"f260874.60cad78","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Boost Setpoint","tooltip":"","group":"e29d4c40.387d8","order":9,"width":"0","height":"0","passthru":false,"mode":"number","delay":"0","topic":"","x":760,"y":800,"wires":[["5d374718.d67ac8"]]},{"id":"66eed9e7.902818","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"AC Control","tooltip":"","group":"e29d4c40.387d8","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":770,"y":680,"wires":[["127acae4.2f08d5"]]},{"id":"a2b3f2e6.4136e","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"AC Override","tooltip":"","group":"e29d4c40.387d8","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":770,"y":720,"wires":[["20262be7.4a5ad4"]]},{"id":"127acae4.2f08d5","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"O\":{\n    \t\t\t\t    \"ACM\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":920,"y":680,"wires":[["a78dbfee.6f286"]]},{"id":"20262be7.4a5ad4","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"O\":{\n    \t\t\t\t    \"ACO\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nreturn output;","outputs":1,"noerr":0,"x":920,"y":720,"wires":[["a78dbfee.6f286"]]},{"id":"da590b4b.b57e48","type":"ui_template","z":"e2e5a56.78da658","group":"e29d4c40.387d8","name":"Title","order":1,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: #273746;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EAECEE;\"\n            ng-style=\"{background: #EAECEE}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":910,"y":640,"wires":[[]]},{"id":"f0a8eeea.a1fe8","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload=1\nmsg.text = \"Geyser 1\";\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":640,"wires":[["da590b4b.b57e48"]]},{"id":"12f9b2e6.fca13d","type":"function","z":"e2e5a56.78da658","name":"ACCT","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACCT\");\nif(n===true)\n{\n    msg.payload = msg.payload.S.ACCT;\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":510,"y":840,"wires":[["a82213bb.2dcfa"]]},{"id":"a82213bb.2dcfa","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Comfort Setpoint","tooltip":"","group":"e29d4c40.387d8","order":11,"width":"0","height":"0","passthru":false,"mode":"number","delay":"0","topic":"","x":750,"y":840,"wires":[["3ba48d03.c33da2"]]},{"id":"3ba48d03.c33da2","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload;\nvar unit = flow.get(\"unit\");\nvar output\t= [];\nif(msg.payload > 70)    // limit to 70\n{\n    payload = 70;\n}\nelse\n{\n    payload = msg.payload;\n}\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"S\":{\n    \t\t\t\t    \"ACCT\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nreturn output;","outputs":1,"noerr":0,"x":920,"y":840,"wires":[["a78dbfee.6f286"]]},{"id":"9db6ce59.08c5a","type":"mqtt in","z":"e2e5a56.78da658","name":"Set 1","topic":"GW/gw6A68C63ADAD23A/1/SET","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":70,"y":680,"wires":[["dea6a1f2.bec1e"]]},{"id":"bceb8a7f.f810f8","type":"comment","z":"e2e5a56.78da658","name":"Geyser Charts","info":"","x":90,"y":900,"wires":[]},{"id":"cf5968da.9c3718","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"SQL","query":"","outField":"payload","x":570,"y":980,"wires":[["c1ad126f.41281"]]},{"id":"b74a538a.39c73","type":"ui_date_picker","z":"e2e5a56.78da658","name":"","label":"Date","group":"d1c22f75.8ed66","order":1,"width":"6","height":"1","passthru":true,"topic":"","x":250,"y":980,"wires":[["24495b66.227784"]]},{"id":"41665073.a947b","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"d1c22f75.8ed66","order":2,"width":"2","height":"1","passthru":false,"label":"Refresh","tooltip":"","color":"","bgcolor":"grey","icon":"fa-refresh","payload":"","payloadType":"date","topic":"","x":100,"y":980,"wires":[["b74a538a.39c73","24495b66.227784"]]},{"id":"c1ad126f.41281","type":"function","z":"e2e5a56.78da658","name":"","func":"/*#################################################################################################################################################################################################\n\tGLOBAL VARIABLES\n#################################################################################################################################################################################################*/\n\t// Memory Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar\tTemperature = [];\n\t\tvar\tI_AC = [];\n\t\tvar\tI_PV = [];\n\t\tvar\tT_PCB = [];\n\t\tvar labelsDate = [];\n        var days = msg.payload.length;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Output Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar _PowerData\t= [];   // Output array\n        var Output;\n\t\t//-----------------------------------------------------------------------------------------\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n    // Contents Generation\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    // Daily Data\n    for (var i = 0; i < days; i++)\n    {\n        var hour = msg.payload[i].entrytime.toISOString();\n        var hourS = hour.search(\"T\")+1;\n        var hourE = hour.search(\"Z\")-4;\n        var len = hour.length;\n        var res = hour.substring(hourS, hourE);\n        labelsDate[i] = res;\n        Temperature[i] = msg.payload[i].T_G;\n        I_AC[i] = ((msg.payload[i].I_AC/10)*((1000-23)+23))/1000;\n    }\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Output Generation\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\t// Generate Output Array\n\t\t//-----------------------------------------------------------------------------------------\n        _PowerData\t= {\n                \"labels\":labelsDate,\n                \"series\":[\"Temperature\"],\n//                \"series\":[\"Temperature\", \"Water Pressure\"],\n                \"data\":[Temperature]\n//                \"data\":[Temperature, I_AC]\n            };\n        \n        Output = {\n            \"payload\": [_PowerData]\n        }\n            \n\t\t//-----------------------------------------------------------------------------------------\n\n\t\t// Publish Output\n\t\t//-----------------------------------------------------------------------------------------\n\t\t\treturn Output;\n\t\t//-----------------------------------------------------------------------------------------\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":980,"wires":[["49d78f92.ef442","86583c4e.ab92"]]},{"id":"49d78f92.ef442","type":"ui_chart","z":"e2e5a56.78da658","name":"","group":"d1c22f75.8ed66","order":3,"width":"10","height":"5","label":"Geyser 1 - Temperature","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"70","removeOlder":1,"removeOlderPoints":"10000","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#ff6b24","#008000","#ff80c0","#ff4646","#00d200","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":930,"y":980,"wires":[[]]},{"id":"78337be1.1b10e4","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1020,"wires":[["24495b66.227784"]]},{"id":"eed90bbe.8cf538","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"","crontab":"01 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":940,"wires":[["b74a538a.39c73"]]},{"id":"24495b66.227784","type":"function","z":"e2e5a56.78da658","name":"Get Date","func":"var tagname = flow.get(\"unit\");\nvar now     = new Date(msg.payload);\nvar year    = now.getFullYear();\nvar month   = now.getMonth()+1; \nvar day     = now.getDate();\nvar hour    = now.getHours();\nvar minute  = now.getMinutes();\nvar second  = now.getSeconds(); \n\nif(month.toString().length == 1)  { var month = '0'+month;}\nif(day.toString().length == 1)    { var day = '0'+day;}   \nif(hour.toString().length == 1)   { var hour = '0'+hour;}\nif(minute.toString().length == 1) { var minute = '0'+minute;}\nif(second.toString().length == 1) { var second = '0'+second;}\n\nmsg.timestamp = year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second;\nmsg.date = year+'-'+month+'-'+day;\n\nmsg.payload = \"SELECT TOP (100) PERCENT GW_Unit, entrydate, entrytime, T_G, I_AC FROM dbo.analogData WHERE (GW_Unit = N'G1_\"+tagname+\"') AND (entrydate = '\"+msg.date+\"') ORDER BY entrytime\";\nnode.status({text:tagname});\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":980,"wires":[["cf5968da.9c3718"]]},{"id":"437442c2.ca9e5c","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"300","crontab":"","once":true,"onceDelay":"0.3","topic":"","payload":"","payloadType":"date","x":610,"y":200,"wires":[["836ef833.ada658","27856d32.2ac8f2"]]},{"id":"c686a11b.aa69d","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"","query":"","outField":"payload","x":960,"y":200,"wires":[[]]},{"id":"9a05c040.54bc9","type":"comment","z":"e2e5a56.78da658","name":"Log Data to SQL","info":"","x":600,"y":160,"wires":[]},{"id":"dfbeb9.b9043148","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"","query":"","outField":"payload","x":650,"y":320,"wires":[[]]},{"id":"a1fa6e76.9ec0c","type":"comment","z":"e2e5a56.78da658","name":"Timers","info":"","x":70,"y":1220,"wires":[]},{"id":"c7013ccc.82783","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":350,"y":1260,"wires":[["852acc48.bf658","4f4e37f5.73e988","d1aa5441.55c578","2e44dc84.03e304","7856070f.f98a58","ee2bb570.846018"]]},{"id":"44dea720.8eea88","type":"deduplicate","z":"e2e5a56.78da658","name":"","registryclass":"","noderole":"standalone","expiry":5,"x":210,"y":1260,"wires":[["c7013ccc.82783"],[]]},{"id":"910dee07.cfe4a","type":"ui_template","z":"e2e5a56.78da658","group":"df33db3c.b48308","name":"Timers","order":2,"width":"6","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'DeepSkyBlue' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":670,"y":1260,"wires":[[]]},{"id":"30053aef.a71746","type":"ui_template","z":"e2e5a56.78da658","group":"df33db3c.b48308","name":"Title","order":1,"width":"6","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: #273746;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EAECEE;\"\n            ng-style=\"{background: #EAECEE}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":670,"y":1220,"wires":[[]]},{"id":"852acc48.bf658","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload=1\nmsg.text = \"Timers 1\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1220,"wires":[["30053aef.a71746"]]},{"id":"4f4e37f5.73e988","type":"function","z":"e2e5a56.78da658","name":"Timers Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/C\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":520,"y":1260,"wires":[["910dee07.cfe4a"]]},{"id":"d1aa5441.55c578","type":"function","z":"e2e5a56.78da658","name":"Timer 1 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/1\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 1 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 1 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":520,"y":1300,"wires":[["d7cb38fa.ae9b78"]]},{"id":"2e44dc84.03e304","type":"function","z":"e2e5a56.78da658","name":"Timer 2 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/2\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 2 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 2 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":520,"y":1340,"wires":[["5b8db7ca.d6ea58"]]},{"id":"7856070f.f98a58","type":"function","z":"e2e5a56.78da658","name":"Timer 3 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/3\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 3 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 3 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":520,"y":1380,"wires":[["8b453ef.70996c"]]},{"id":"ee2bb570.846018","type":"function","z":"e2e5a56.78da658","name":"Timer 4 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/4\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 4 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 4 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":520,"y":1420,"wires":[["6dc54e3a.5d0c9"]]},{"id":"d7cb38fa.ae9b78","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 1","tooltip":"","group":"df33db3c.b48308","order":3,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":680,"y":1300,"wires":[["695fec6c.2fa544"]]},{"id":"695fec6c.2fa544","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":830,"y":1300,"wires":[["692c985b.820038"]]},{"id":"5b8db7ca.d6ea58","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 2","tooltip":"","group":"df33db3c.b48308","order":4,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":680,"y":1340,"wires":[["a4053d2e.0afaa"]]},{"id":"a4053d2e.0afaa","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":830,"y":1340,"wires":[["c6c5348e.70ef28"]]},{"id":"8b453ef.70996c","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 3","tooltip":"","group":"df33db3c.b48308","order":5,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":680,"y":1380,"wires":[["79944daa.d15614"]]},{"id":"79944daa.d15614","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":830,"y":1380,"wires":[["723055bc.412cfc"]]},{"id":"6dc54e3a.5d0c9","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 4","tooltip":"","group":"df33db3c.b48308","order":6,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":680,"y":1420,"wires":[["c911d5ba.b8a658"]]},{"id":"c911d5ba.b8a658","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":830,"y":1420,"wires":[["7949919c.000c"]]},{"id":"b0ab160.b1e64e8","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw6A68C63ADAD23A/1/Time/1","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1110,"y":1300,"wires":[]},{"id":"226dcdc1.cb2282","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw6A68C63ADAD23A/1/Time/2","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1110,"y":1340,"wires":[]},{"id":"3fb5682e.644aa8","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw6A68C63ADAD23A/1/Time/3","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1110,"y":1380,"wires":[]},{"id":"d7f68d94.8456a","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw6A68C63ADAD23A/1/Time/4","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1110,"y":1420,"wires":[]},{"id":"ff2156a3.884998","type":"mqtt in","z":"e2e5a56.78da658","name":"Time 1","topic":"GW/gw6A68C63ADAD23A/1/Time/#","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":70,"y":1260,"wires":[["44dea720.8eea88"]]},{"id":"64069815.7382f8","type":"mqtt out","z":"e2e5a56.78da658","name":"","topic":"","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":410,"y":200,"wires":[]},{"id":"ed546eec.fa873","type":"inject","z":"e2e5a56.78da658","name":"Connection","repeat":"86400","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":130,"y":200,"wires":[["b7272c2c.86a2"]]},{"id":"9bb34c26.28494","type":"comment","z":"e2e5a56.78da658","name":"Request Data from Unit","info":"","x":120,"y":160,"wires":[]},{"id":"851b4a48.5f87c8","type":"inject","z":"e2e5a56.78da658","name":"Update","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"GWA/gw6A68C63ADADB34/U","payload":"","payloadType":"str","x":120,"y":240,"wires":[["23531975.2be666","826a817b.299f2"]]},{"id":"23531975.2be666","type":"function","z":"e2e5a56.78da658","name":"Tot","func":"msg.topic = \"GWA/\"+flow.get(\"unit\")+\"/1/A\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":280,"wires":[["64069815.7382f8"]]},{"id":"826a817b.299f2","type":"function","z":"e2e5a56.78da658","name":"Update","func":"msg.topic = \"GWA/\"+flow.get(\"unit\")+\"/U\"\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":240,"wires":[["64069815.7382f8"]]},{"id":"b7272c2c.86a2","type":"function","z":"e2e5a56.78da658","name":"Sts","func":"msg.topic = \"GWA/\"+flow.get(\"unit\")+\"/S/CW\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":200,"wires":[["64069815.7382f8"]]},{"id":"8e770576.e6ee48","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"3600","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":610,"y":280,"wires":[["a58b773a.10fa58"]]},{"id":"a58b773a.10fa58","type":"function","z":"e2e5a56.78da658","name":"Efficiencies","func":"var tagname = flow.get(\"unit\");\nmsg.timestamp= new Date().toISOString()\nvar now     = new Date(); \nvar yesterday = now.setDate(now.getDate() - 2);\nmyepoch     = now.getTime();\nvar year    = now.getFullYear();\nvar month   = now.getMonth()+1; \nvar day     = now.getDate();\nvar hour    = now.getHours();\nvar minute  = now.getMinutes();\nvar second  = now.getSeconds(); \nvar logDate = year+\"-\"+month+\"-\"+day;\nvar logTime = hour+\":\"+minute+\":\"+second;\n\nvar sql = \"\";\nvar outputs = [];\n\nsql = \"SELECT MAX(Pt_kWh_AC) AS AC, MAX(Pt_kWh_PV) AS PV FROM dbo.unitPowerData WHERE (GW_Unit = N'G1_\"+tagname+\"')\";\n\noutputs.push({payload:sql});        \n\n// Update the status with current timestamp\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+ logTime});    \n\nreturn [ outputs ];\n","outputs":1,"noerr":0,"x":790,"y":280,"wires":[["a7b79f18.f0396"]]},{"id":"a7b79f18.f0396","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"Efficiencies","query":"","outField":"payload","x":950,"y":280,"wires":[["9bd4a534.34c398"]]},{"id":"9bd4a534.34c398","type":"function","z":"e2e5a56.78da658","name":"","func":"var TotalPV=msg.payload[0].PV;\nvar TotalAC=msg.payload[0].AC;\nvar _PowerData\t= [];   // Output array\nvar Output;\n\n_PowerData\t= {\n        \"AC\":TotalAC,\n        \"PV\":TotalPV\n    };\n\nOutput = {\n    \"payload\": [_PowerData]\n}\n\nvar costAC = TotalAC * parseFloat(global.get(\"R_kW\"));\nvar costPV = TotalPV * parseFloat(global.get(\"R_kW\"));\nvar EffPV = (TotalPV / (TotalAC+TotalPV)*100);\nvar carbon = (parseFloat(TotalPV) * 0.7)/1000;\n\nflow.set(\"G1ACkW\", TotalAC.toFixed(0));\nflow.set(\"G1PVkW\", TotalPV.toFixed(0));\nflow.set(\"G1ACCost\",costAC.toFixed(2));\nflow.set(\"G1PVCost\",costPV.toFixed(2));\nflow.set(\"G1PVUsage\",EffPV.toFixed(0));\nflow.set(\"G1Carbon\",carbon.toFixed(2))\n\nreturn Output;\n","outputs":1,"noerr":0,"x":1090,"y":280,"wires":[[]]},{"id":"e8f23611.23ef88","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":520,"y":640,"wires":[]},{"id":"692c985b.820038","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":950,"y":1300,"wires":[["b0ab160.b1e64e8"]]},{"id":"c6c5348e.70ef28","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":950,"y":1340,"wires":[["226dcdc1.cb2282"]]},{"id":"723055bc.412cfc","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":950,"y":1380,"wires":[["3fb5682e.644aa8"]]},{"id":"7949919c.000c","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":950,"y":1420,"wires":[["d7f68d94.8456a"]]},{"id":"836ef833.ada658","type":"function","z":"e2e5a56.78da658","name":"G1 - Analog","func":"var unit = flow.get(\"unit\");\nmsg.payload = global.get(\"_geyserTestData_\"+unit);\nvar dateValue = msg.payload.CS.t.Y + msg.payload.CS.t.M + msg.payload.CS.t.D;\nvar timeValue = msg.payload.CS.t.h +\":\"+ msg.payload.CS.t.m +\":\"+ msg.payload.CS.t.s;\n\nvar connectionServer = msg.payload.CS.S;\nvar connectionWifi = msg.payload.CS.I;\n\nvar G1temperaturePCB = msg.payload.G1.T.PCB;\nvar G1temperatureGeyser = msg.payload.G1.T.G;\n\nvar G1currentAC = msg.payload.G1.I.AC;\nvar G1currentPV = msg.payload.G1.I.PV;\n\nvar ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toLocaleTimeString();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = dt.substr(0, 2);\nvar m = a[4];\nvar s = a[5];\nvar y = a[0];\nvar month = a[1];\nvar day = a[2];\n\nvar logDate = (y+\"-\"+month+\"-\"+day);\nvar logTime = (h+\":\"+m+\":\"+s);\n\nvar insertSelect = \"INSERT INTO [dbo].[analogData]([GW_Unit],[entrydate],[entrytime],[CS_S],[CS_I],[CS_Date],[CS_Time],[T_PCB],[T_G],[I_AC],[I_PV],[V_AC],[V_PV],[T_PCB_AVG],[T_G_AVG],[I_AC_AVG],[I_PV_AVG],[V_AC_AVG],[V_PV_AVG],[R_IRR],[R_IRR_AVG],[T2_G],[T2_G_AVG])\";\nvar values = \"VALUES('G1_\"+unit+\"','\"+logDate+\"','\"+logTime+\"',\"+connectionServer+\",\"+connectionWifi+\",'\"+dateValue+\"','\"+timeValue+\"',\";\nvar G1values = G1temperaturePCB+\",\"+G1temperatureGeyser+\",\"+G1currentAC+\",\"+G1currentPV+\",0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0)\";\n\nvar outputs = [];\nvar sql;\nsql = insertSelect + \" \" + values + G1values;\nmsg.payload=sql;\n\nnode.status({fill:\"green\",shape:\"ring\",text:\"Time: \"+logTime});\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":200,"wires":[["c686a11b.aa69d"]]},{"id":"a0bb1110.169fd","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1080,"wires":[["71110381.604f4c"]]},{"id":"71110381.604f4c","type":"mqtt out","z":"e2e5a56.78da658","name":"GET Time","topic":"GWA/gw6A68C63ADAD23A/S/Time/G","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":560,"y":1080,"wires":[]},{"id":"a63ad6ef.7b1e78","type":"function","z":"e2e5a56.78da658","name":"","func":"//{\"Y\":2019,\"M\":3,\"D\":11,\"h\":8,\"m\":1}\nvar tagname = flow.get(\"unit\");\nmsg.timestamp= new Date().toISOString();\nvar now     = new Date(); \nvar year    = now.getFullYear();\nvar month   = now.getMonth()+1; \nvar day     = now.getDate();\nvar hour    = now.getHours();\nvar minute  = now.getMinutes();\nvar second  = now.getSeconds(); \nvar logDate = year+\"-\"+month+\"-\"+day;\nvar logTime = hour+\":\"+minute+\":\"+second;\n\nvar output\t= [];\nvar time = {\n    \"payload\": {\n\t    \"Y\": year,\n\t    \"M\": month,\n\t    \"D\": day,\n\t    \"h\": hour,\n\t    \"m\": minute\n    }\n};\n\noutput\t=\t[\n\t\t\t\ttime\n\t\t\t];\nnode.status({text:output});\n\nreturn output;","outputs":1,"noerr":0,"x":370,"y":1120,"wires":[["6f67b25d.6a669c"]]},{"id":"e6d54c64.17101","type":"mqtt in","z":"e2e5a56.78da658","name":"Time","topic":"GW/gw6A68C63ADAD23A/S/Time/G","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":90,"y":1160,"wires":[["7e75f44a.965a8c"]]},{"id":"bdaafdfa.cce37","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":410,"y":1160,"wires":[["c3969a0.bfca468"]]},{"id":"7e75f44a.965a8c","type":"deduplicate","z":"e2e5a56.78da658","name":"","registryclass":"","noderole":"standalone","expiry":5,"x":250,"y":1160,"wires":[["bdaafdfa.cce37"],[]]},{"id":"c3969a0.bfca468","type":"function","z":"e2e5a56.78da658","name":"","func":"var year = msg.payload.Y;\nvar month = msg.payload.M;\nvar day = msg.payload.D;\nvar hour = msg.payload.h;\nvar min = msg.payload.m;\n\nmsg.payload = year+\"/\"+month+\"/\"+day+\" \"+hour+\":\"+min;\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":1160,"wires":[["38e99236.3f70ae"]]},{"id":"4d321c7f.b03ef4","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"df33db3c.b48308","order":8,"width":0,"height":0,"passthru":false,"label":"Set Current Time","tooltip":"","color":"","bgcolor":"grey","icon":"","payload":"","payloadType":"str","topic":"","x":130,"y":1120,"wires":[["a63ad6ef.7b1e78"]]},{"id":"6f67b25d.6a669c","type":"mqtt out","z":"e2e5a56.78da658","name":"SET Time","topic":"GWR/gw6A68C63ADAD23A/S/Time/G","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":560,"y":1120,"wires":[]},{"id":"38e99236.3f70ae","type":"ui_text","z":"e2e5a56.78da658","group":"df33db3c.b48308","order":7,"width":0,"height":0,"name":"","label":"Time","format":"{{msg.payload}}","layout":"row-spread","x":710,"y":1160,"wires":[]},{"id":"69a6091f.6a7c28","type":"function","z":"e2e5a56.78da658","name":"Timers Enabled","func":"// {\"C\":1,\"S\":{\"h\":4,\"m\":15},\"E\":{\"h\":6,\"m\":45},\"W\":{\"Mo\":1,\"Tu\":1,\"We\":1,\"Th\":1,\"Fr\":1,\"Sa\":0,\"Su\":0}}\nvar payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/C\");\nvar start   = payload.includes(\"S\");\nvar end     = payload.includes(\"E\");\nvar day     = payload.includes(\"W\");\nvar start_h = flow.get(\"start1_h\")||0;\nvar start_m = flow.get(\"start1_m\")||0;\nvar end_h   = flow.get(\"end1_h\")||0;\nvar end_m   = flow.get(\"end_m\")||0;\n\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else if(start === true)\n    {\n        flow.set(\"start1_h\", msg.payload.S)\n    }\n    else if(end === true)\n    {\n        \n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":300,"y":1380,"wires":[[]]},{"id":"dea6a1f2.bec1e","type":"deduplicate","z":"e2e5a56.78da658","name":"","registryclass":"","noderole":"standalone","expiry":5,"x":230,"y":680,"wires":[["523b1a95.5302e4"],[]]},{"id":"dac494db.ae0a68","type":"ui_template","z":"e2e5a56.78da658","group":"4114e5fc.68ae5c","name":"Status","order":13,"width":"3","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\n                \"{background: msg.payload == '1' ? 'green' : 'red'}\"\n            ng-bind-html=\n                \"msg.topic\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":530,"y":580,"wires":[[]]},{"id":"ea077ddc.e08e6","type":"function","z":"e2e5a56.78da658","name":"Online","func":"var unit = flow.get(\"unit\");\nvar payload = global.get(\"_geyserTestData_\"+unit)||0;\nvar date = payload.CS.t.Y + \"/\" + payload.CS.t.M + \"/\" + payload.CS.t.D;\nvar time = payload.CS.t.h + \":\" + payload.CS.t.m + \":\" + payload.CS.t.s;\nmsg.payload = payload.CS.S;\nmsg.topic = unit + \" \" + date + \" \" + time;\nnode.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":580,"wires":[["dac494db.ae0a68"]]},{"id":"27856d32.2ac8f2","type":"function","z":"e2e5a56.78da658","name":"G1 - Power","func":"var unit = flow.get(\"unit\");\nvar payload = global.get(\"_geyserTestData_\"+unit);\n\nvar Raw_AC = payload.G1.Pt.Raw.I2AC;\nvar Raw_PV = payload.G1.Pt.Raw.I2PV;\nvar kWh_AC = payload.G1.Pt.kWh.AC;\nvar kWh_PV = payload.G1.Pt.kWh.PV;\n\nvar ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toLocaleTimeString();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = dt.substr(0, 2);\nvar m = a[4];\nvar s = a[5];\nvar y = a[0];\nvar month = a[1];\nvar day = a[2];\n\nvar logDate = (y+\"-\"+month+\"-\"+day);\nvar logTime = (h+\":\"+m+\":\"+s);\n\nvar insertSelect = \"INSERT INTO [dbo].[unitPowerData]([GW_Unit],[entryDate],[entryTime],[Pt_Raw_AC],[Pt_Raw_PV],[Pt_kWh_AC],[Pt_kWh_PV])\";\nvar values       = \"VALUES ('G1_\"+unit+\"','\"+logDate+\"','\"+logTime+\"',\"+Raw_AC+\",\"+Raw_PV+\",\"+kWh_AC+\",\"+kWh_PV+\")\";\n\nmsg.payload = insertSelect + \" \" + values;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Time: \"+logTime});\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":240,"wires":[["c686a11b.aa69d"]]},{"id":"86583c4e.ab92","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":940,"wires":[]},{"id":"4a4c10af.e4a5b","type":"comment","z":"e2e5a56.78da658","name":"Data Mapping","info":"","x":110,"y":2140,"wires":[]},{"id":"f08e4b7a.619938","type":"function","z":"e2e5a56.78da658","name":"Data Processing","func":"/*#################################################################################################################################################################################################\n\tGLOBAL VARIABLES\n#################################################################################################################################################################################################*/\n\t// Message Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar topic\t\t\t= msg.topic;\n\t\tvar payload\t\t\t= msg.payload;\t//\n\t\tvar unitID          = \"gw86840D8E970C2B\";\n\t\tmsg.payload         = null;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Topic Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar systemType\t\t= \"\";\t\t\t// GW\n\t\tvar systemID\t\t= \"\";\t\t\t// gw6A68C63ADAF88F\n\t\tvar subID_1\t\t\t= \"\";\t\t\t// 1\n\t\tvar subID_2\t\t\t= \"\";\t\t\t// A\n\t\tvar subID_3\t\t\t= \"\";\t\t\t//\n\t\tvar subID_4\t\t\t= \"\";\t\t\t//\n\t\tvar subID_5\t\t\t= \"\";\t\t\t//\n\t\tvar subID_6\t\t\t= \"\";\t\t\t//\n\t\tvar subID_7\t\t\t= \"\";\t\t\t//\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Index Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar topicLength\t\t= topic.length;\n\t\tvar topicSeperator\t= topic.indexOf(\"/\");\n\t\tvar indexGW_ID\t\t= -1;\n\t\tvar indexGW_Unit\t= -1;\n\t\tvar indexGW_Func\t= -1;\n\t\tvar index_5\t\t\t= -1;\n\t\tvar index_6\t\t\t= -1;\n\t\tvar index_7\t\t\t= -1;\n\t\tvar index_8\t\t\t= -1;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Memory Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar\t_unitID;\n\t\tvar\t_geyserDataSN;\n\t\tvar\t_geyserData;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Time & Date variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar date\t\t\t= new Date();\n\n\t\tvar system_Year\t\t= String( date.getFullYear() );\n\t\tvar system_Month\t= String( date.getMonth() + 1 );\n\t\tvar system_Day\t\t= String( date.getDate() );\n\t\tvar system_Hour\t\t= String( date.getHours() );\n\t\tvar system_Minute\t= String( date.getMinutes() );\n\t\tvar system_Second\t= String( date.getSeconds() );\n\n\t\tsystem_Year\t\t\t= \"00\".substr(system_Year.length)\t\t+ system_Year;\n\t\tsystem_Month\t\t= \"00\".substr(system_Month.length)\t\t+ system_Month;\n\t\tsystem_Day\t\t\t= \"00\".substr(system_Day.length)\t\t+ system_Day;\n\t\tsystem_Hour\t\t\t= \"00\".substr(system_Hour.length)\t\t+ system_Hour;\n\t\tsystem_Minute\t\t= \"00\".substr(system_Minute.length)\t\t+ system_Minute;\n\t\tsystem_Second\t\t= \"00\".substr(system_Second.length)\t\t+ system_Second;\n\n\t\tvar system_time\t\t= system_Year + \"/\" + system_Month + \"/\" + system_Day + \" \" + system_Hour + \":\" + system_Minute;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Output Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\t// Output array\n\t\t//-----------------------------------------------------------------------------------------\n\t\t\tvar output\t\t= [];\n\t\t//-----------------------------------------------------------------------------------------\n\n\t\t// Output array components\n\t\t//-----------------------------------------------------------------------------------------\n\t\t\tvar output_sys_t;\n\t\t\tvar output_unitUpdate_CS\t= null;\n\t\t\tvar output_debug\t        = null;\n\t\t//-----------------------------------------------------------------------------------------\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\n/*#################################################################################################################################################################################################\n\tFUNCTIONS\n#################################################################################################################################################################################################*/\n\t// Topic Breakdown\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tsystemType\t= topic;\n\n\t\tif (topicSeperator >= 0)\n\t\t{\n\t\t\tsystemType\t= topic.slice(0, topicSeperator);\n\t\t\tsystemID\t= topic.slice(topicSeperator + 1);\n\n\t\t\tindexGW_ID\t\t= topic.indexOf(\"/\", topicSeperator + 1);\n\t\t\tif (indexGW_ID >= 0)\n\t\t\t{\n\t\t\t\tsystemID\t= topic.slice(topicSeperator + 1, indexGW_ID);\n\t\t\t\tsubID_1\t\t= topic.slice(indexGW_ID + 1);\n\n\t\t\t\tindexGW_Unit\t= topic.indexOf(\"/\", indexGW_ID + 1);\n\t\t\t\tif (indexGW_Unit >= 0)\n\t\t\t\t{\n\t\t\t\t\tsubID_1\t\t= topic.slice(indexGW_ID + 1, indexGW_Unit);\n\t\t\t\t\tsubID_2\t\t= topic.slice(indexGW_Unit + 1);\n\n\t\t\t\t\tindexGW_Func\t= topic.indexOf(\"/\", indexGW_Unit + 1);\n\t\t\t\t\tif (indexGW_Func >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubID_2\t\t= topic.slice(indexGW_Unit + 1, indexGW_Func);\n\t\t\t\t\t\tsubID_3\t\t= topic.slice(indexGW_Func + 1);\n\n\t\t\t\t\t\tindex_5\t\t= topic.indexOf(\"/\", indexGW_Func + 1);\n\t\t\t\t\t\tif (index_5 >= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsubID_3\t\t= topic.slice(indexGW_Func + 1, index_5);\n\t\t\t\t\t\t\tsubID_4\t\t= topic.slice(index_5 + 1);\n\n\t\t\t\t\t\t\tindex_6\t\t= topic.indexOf(\"/\", index_5 + 1);\n\t\t\t\t\t\t\tif (index_6 >= 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsubID_4\t\t= topic.slice(index_5 + 1, index_6);\n\t\t\t\t\t\t\t\tsubID_5\t\t= topic.slice(index_6 + 1);\n\n\t\t\t\t\t\t\t\tindex_7\t\t= topic.indexOf(\"/\", index_6 + 1);\n\t\t\t\t\t\t\t\tif (index_7 >= 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tsubID_5\t\t= topic.slice(index_6 + 1, index_7);\n\t\t\t\t\t\t\t\t\tsubID_6\t\t= topic.slice(index_7 + 1);\n\n\t\t\t\t\t\t\t\t\tindex_8\t\t= topic.indexOf(\"/\", index_7 + 1);\n\t\t\t\t\t\t\t\t\tif (index_8 >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsubID_6\t\t= topic.slice(index_7 + 1, index_8);\n\t\t\t\t\t\t\t\t\t\tsubID_7\t\t= topic.slice(index_8 + 1);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Contents Generation\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tif( topicSeperator > -1 )\n\t\t{\n\t\t\tif( systemType === \"GW\" )\n\t\t\t{\n\t\t\t\tif( (indexGW_ID > -1)&&( indexGW_Unit > -1 )&&(systemID === unitID) )\n\t\t\t\t{\n\t\t\t\t    output_debug    = msg;\n\t\t\t\t\t_unitID\t\t\t= systemID;\n\t\t\t\t\t_geyserDataSN\t= \"_geyserTestData_\" + _unitID;\n\n\t\t\t\t\t_geyserData\t\t= global.get(_geyserDataSN)||{\n\t\t\t\t\t\t\t\t\t\t\"SN\":\t_unitID,\n\t\t\t\t\t\t\t\t\t\t\"CS\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\"S\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\"I\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\"t\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Y\":\tsystem_Year,\n\t\t\t\t\t\t\t\t\t\t    \t\t\t\"M\":\tsystem_Month,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"D\":\tsystem_Day,\n\t\t\t\t\t\t\t\t\t\t\t    \t\t\"h\":\tsystem_Hour,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"m\":\tsystem_Minute,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"s\":\tsystem_Second\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\"A\":\tfalse,\n\t\t\t\t\t\t\t\t\t\t\t\"AVG\":\tfalse,\n\t\t\t\t\t\t\t\t\t\t\t\"G1\":{\n\t\t\t\t\t\t\t\t\t\t\t        \"T\":{\n        \t\t\t\t\t\t\t\t\t\t\t\t\"PCB\":\t\t\t0.0,\n        \t\t\t\t\t\t\t\t\t\t\t\t\"G\":\t\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t    },\n        \t\t\t\t\t\t\t\t\t\t\t\"I\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"V\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Pt\":\t{\n\t\t\t\t\t\t\t\t\t\t\t\t            \"Raw\":  {\n    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t                    },\n\t\t\t\t\t\t\t\t\t\t\t\t            \"kWh\":  {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t\t\t\t\t\t        },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"STS\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Th\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Te\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_DR\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_CS\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_PCB\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_Sc\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_An\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_DT\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_AC\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_PV\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"T\":        0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"H\":        0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"SET\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACM\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACO\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVM\": 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"S\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACOT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACCT\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"DRT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"SCB\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\"G2\":{\n\t\t\t\t\t\t\t\t\t\t\t        \"T\":{\n        \t\t\t\t\t\t\t\t\t\t\t\t\"PCB\":\t\t\t0.0,\n        \t\t\t\t\t\t\t\t\t\t\t\t\"G\":\t\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t    },\n        \t\t\t\t\t\t\t\t\t\t\t\"I\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"V\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Pt\":\t{\n\t\t\t\t\t\t\t\t\t\t\t\t            \"Raw\":  {\n    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"I2PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t                    },\n\t\t\t\t\t\t\t\t\t\t\t\t            \"kWh\":  {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"AC\":\t0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"PV\":\t0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t\t\t\t\t\t        },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"STS\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Th\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_Te\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_DR\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_CS\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Tr_PCB\":\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_Sc\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_An\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A_DT\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_AC\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O_PV\":\t    0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"T\":        0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"H\":        0\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"SET\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"O\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACM\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACO\": 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVM\": 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"S\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACOT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"PVT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"ACCT\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"A\":{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"DRT\": 0.0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    \"SCB\": 0.0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\n\t\t\t\t\tif( (subID_1 === \"S\")&&( subID_2 === \"CW\" ) )\n\t\t\t\t\t{\n\t\t\t\t\t\tif( ( _geyserData.CS.S !== payload.S )||( _geyserData.CS.I !== payload.I ) )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_geyserData.CS.S\t=\tpayload.S;\n\t\t\t\t\t\t\t_geyserData.CS.I\t=\tpayload.I;\n\t\t\t\t\t\t\t_geyserData.CS.t\t=\t{\n\t\t\t\t\t\t\t\t\t\t\t    \t\t\"Y\":\tsystem_Year,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"M\":\tsystem_Month,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"D\":\tsystem_Day,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"h\":\tsystem_Hour,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"m\":\tsystem_Minute,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"s\":\tsystem_Second\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n                    else if( subID_1 === \"1\" )\n\t\t\t\t\t{\n\t\t\t\t\t\tif( subID_2 === \"A\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"T\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"G\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.T.G\t= payload.T.G;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PCB\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.T.PCB\t\t= payload.T.PCB;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.I.AC\t\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.I.PV\t\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"a\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.Raw.I2AC\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.kWh.AC\t= (payload.I.AC)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.Raw.I2PV\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.G1.Pt.kWh.PV\t= (payload.I.PV)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"STS\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if( \"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_Th        = payload.A.Tr_Th;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_Te        = payload.A.Tr_Te;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_DR        = payload.A.Tr_DR;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_CS        = payload.A.Tr_CS;\n\t\t\t\t\t\t        _geyserData.G1.STS.Tr_PCB       = payload.A.Tr_PCB;\n\t\t\t\t\t\t        _geyserData.G1.STS.A_Sc         = payload.A.A_Sc;\n\t\t\t\t\t\t        _geyserData.G1.STS.A_An         = payload.A.A_An;\n\t\t\t\t\t\t        _geyserData.G1.STS.A_DT         = payload.A.A_DT;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if( \"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"AC\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.STS.O_AC     = payload.O.AC;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PV\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.STS.O_PV     = payload.O.PV;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"T\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G1.STS.T            = payload.T;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"H\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G1.STS.H            = payload.H;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (subID_2 === \"SET\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if(\"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.O.ACM    = payload.O.ACM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACO\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.O.ACO    = payload.O.ACO;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.O.PVM    = payload.O.PVM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"S\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.ACT        = payload.S.ACT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACOT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.ACOT        = payload.S.ACOT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.PVT        = payload.S.PVT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACCT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.S.ACCT       = payload.S.ACCT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"DRT\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.A.DRT        = payload.A.DRT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"SCB\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G1.SET.A.SCB        = payload.A.SCB;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\t\t\t\t\t}   // end if unit 1\n                    else if( subID_1 === \"2\" )\n\t\t\t\t\t{\n\t\t\t\t\t\tif( subID_2 === \"A\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"T\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"G\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.T.G\t\t\t= payload.T.G;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PCB\" in payload.T  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.T.PCB\t\t= payload.T.PCB;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.I.AC\t\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.I.PV\t\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.A\t\t= true;\n\t\t\t\t\t\t\t\t\t_geyserData.AVG\t\t= true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"a\" )\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif( \"I\" in payload )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif( \"AC\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.Raw.I2AC\t= payload.I.AC;\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.kWh.AC\t= (payload.I.AC)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif( \"PV\" in payload.I  )\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.Raw.I2PV\t= payload.I.PV;\n\t\t\t\t\t\t\t\t\t_geyserData.G2.Pt.kWh.PV\t= (payload.I.PV)*(230*230/3000)/1000;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if( subID_2 === \"STS\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if( \"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_Th        = payload.A.Tr_Th;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_Te        = payload.A.Tr_Te;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_DR        = payload.A.Tr_DR;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_CS        = payload.A.Tr_CS;\n\t\t\t\t\t\t        _geyserData.G2.STS.Tr_PCB       = payload.A.Tr_PCB;\n\t\t\t\t\t\t        _geyserData.G2.STS.A_Sc         = payload.A.A_Sc;\n\t\t\t\t\t\t        _geyserData.G2.STS.A_An         = payload.A.A_An;\n\t\t\t\t\t\t        _geyserData.G2.STS.A_DT         = payload.A.A_DT;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if( \"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"AC\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.STS.O_AC     = payload.O.AC;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PV\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.STS.O_PV     = payload.O.PV;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"T\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G2.STS.T            = payload.T;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"H\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        _geyserData.G2.STS.H            = payload.H;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (subID_2 === \"SET\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    if(\"O\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.O.ACM    = payload.O.ACM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACO\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.O.ACO    = payload.O.ACO;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVM\" in payload.O)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.O.PVM    = payload.O.PVM;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"S\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"ACT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.ACT        = payload.S.ACT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACOT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.ACOT        = payload.S.ACOT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"PVT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.PVT        = payload.S.PVT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"ACCT\" in payload.S)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.S.ACCT       = payload.S.ACCT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    if(\"A\" in payload)\n\t\t\t\t\t\t    {\n\t\t\t\t\t\t        if(\"DRT\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.A.DRT        = payload.A.DRT;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        if(\"SCB\" in payload.A)\n\t\t\t\t\t\t        {\n\t\t\t\t\t\t            _geyserData.G2.SET.A.SCB        = payload.A.SCB;\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}   // end if unit 2\n\n                    // Reset Variables to 0 if Comms is lost\n    \t\t\t    if(_geyserData.CS.S === 0)\n    \t\t\t    {\n    \t\t\t\t\t_geyserData.G1.T.G\t\t= 0;\n    \t\t\t\t\t_geyserData.G1.T.PCB\t= 0;\n    \t\t\t\t\t_geyserData.G1.I.AC\t    = 0;\n    \t\t\t\t\t_geyserData.G1.I.PV\t    = 0;\n    \t\t\t\t\t_geyserData.G2.T.G\t\t= 0;\n    \t\t\t\t\t_geyserData.G2.T.PCB\t= 0;\n    \t\t\t\t\t_geyserData.G2.I.AC\t    = 0;\n    \t\t\t\t\t_geyserData.G2.I.PV\t    = 0;\n    \t\t\t    }\n    \n    \t\t\t\tglobal.set(_geyserDataSN, _geyserData);\n    \t\t\t\tflow.set(\"unit2\", unitID)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\nmsg.payload = _geyserData; // _geyserData\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":2180,"wires":[["ff591b2e.a0d4a8"]]},{"id":"d33506d4.1acba8","type":"mqtt in","z":"e2e5a56.78da658","name":"","topic":"GW/gw86840D8E970C2B/#","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":160,"y":2180,"wires":[["6b6a145e.b2ba7c"]]},{"id":"bb3c3f31.538aa","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":510,"y":2180,"wires":[["f08e4b7a.619938"]]},{"id":"ff591b2e.a0d4a8","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":830,"y":2180,"wires":[]},{"id":"6b6a145e.b2ba7c","type":"deduplicate","z":"e2e5a56.78da658","name":"","expiry":5,"x":370,"y":2180,"wires":[["bb3c3f31.538aa"],[]]},{"id":"45815fa4.1eb44","type":"function","z":"e2e5a56.78da658","name":"Map","func":"var unit = flow.get(\"unit2\");\nvar desc = \"Geyser 2\"\nvar PVT, ACT, ACOT;\nvar OverTemp, UnderTemp, DryBurn, Contactor, PCBTemp, Scale, Anode, DripTray, ACOn, PVOn;\nvar ACM, ACO, PVM;\nvar Temperature, kWhAC, kWhPV, Eff, ACCost, PVCost, carbon;\nvar alarms;\nvar R_kWh = parseFloat(global.get(\"R_kW\"));\n\nvar status = flow.get(\"status2\");\n    OverTemp = status.OverTemp || 0;\n    UnderTemp = status.UnderTemp || 0;\n    DryBurn = status.DryBurn || 0;\n    Contactor = status.Contactor || 0;\n    PCBTemp = status.PCBTemp || 0;\n    Scale = status.Scale || 0;\n    Anode = status.Anode || 0;\n    DripTray = status.DripTray || 0;\n    ACOn = status.ACOn || 0;\n    PVOn = status.PVOn || 0;\n\nACM     =   flow.get(\"ACOn\") || 0;\nPVM     =   flow.get(\"PVOn\") || 0;\nACO     =   flow.get(\"ACOverride\") || 0;\nACT     =   flow.get(\"ac_setpoint\") || 0; \nACOT    =   flow.get(\"override_sp\") || 0; \nPVT     =   flow.get(\"pv_setpoint\") || 0; \n\nTemperature = parseFloat(flow.get(\"temperature2\"));\nkWhAC = parseFloat(flow.get(\"kWhAC2\"));\nkWhPV = parseFloat(flow.get(\"kWhPV2\"));\nEff = parseFloat((kWhPV / (kWhAC+kWhPV)*100).toFixed(2));\nvar cost = kWhAC * 2.07;\nACCost = parseFloat(cost.toFixed(2));\ncost = kWhPV * 2.07;\nPVCost = parseFloat(cost.toFixed(2));\nvar carbon1 = (kWhPV * 0.7)/1000;\ncarbon = parseFloat(carbon1.toFixed(2));\n\nif(OverTemp==1 || UnderTemp==1 || DryBurn==1 || Contactor==1 || PCBTemp==1 || Scale==1 || Anode==1 || DripTray==1)\n{\n    if(OverTemp==1){alarms=\"Over Temperature\"}\n    if(UnderTemp==1){alarms=\"Low Temperature\"}\n    if(DryBurn==1){alarms=\"Dry Burn Alarm\"}\n    if(Contactor==1){alarms=\"Contactor Fault\"}\n    if(PCBTemp==1){alarms=\"PCB Temperature Hi\"}\n    if(Scale==1){alarms=\"Scale Build-up\"}\n    if(Anode==1){alarms=\"Anode Depletion Alarm\"}\n    if(DripTray==1){alarms=\"Driptray Water Alarm\"}\n}\nelse\n{\n    alarms = \"None\";\n}\nvar gwState = flow.get(\"state2\");\nvar _data = {};\n_data = {\n    \"unit\": unit,\n    \"desc\": desc,\n    \"ACOn\": ACM,\n    \"ACOverride\": ACO,\n    \"PVOn\": PVM,\n    \"PVSetpoint\": PVT,\n    \"ACSetpoint\": ACT,\n    \"OverrideSP\": ACOT,\n    \"Temperature\": Temperature,\n    \"kWhAC\": kWhAC,\n    \"kWhPV\": kWhPV,\n    \"ACCost\": ACCost,\n    \"PVCost\": PVCost,\n    \"carbon\": carbon,\n    \"Eff\": Eff,\n    \"Alarms\": alarms,\n    \"gwState\": gwState,\n    \"R_kWh\":R_kWh\n};\nglobal.set(unit+\"_DashData\", _data);\nvar output\t= [\n\t\t\t\t{\"topic\":unit+\"_DashData\",\"payload\":_data}\n\t\t\t];\nflow.set(\"unit2\", unit);\nreturn output;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2220,"wires":[["e0a5999c.bce468"]]},{"id":"e0a5999c.bce468","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":490,"y":2220,"wires":[]},{"id":"2fb79d15.f65b62","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"60","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":130,"y":2220,"wires":[["45815fa4.1eb44"]]},{"id":"b5c61ef5.f335d","type":"mqtt in","z":"e2e5a56.78da658","name":"Status","topic":"GW/gw86840D8E970C2B/1/STS","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":90,"y":2420,"wires":[["a07163bb.0f47c"]]},{"id":"939c0414.47f9b8","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":390,"y":2420,"wires":[["eeba8591.d25e68"]]},{"id":"eeba8591.d25e68","type":"function","z":"e2e5a56.78da658","name":"Status","func":"var unit = flow.get(\"unit2\");\nvar Tr_Th = msg.payload.A.Tr_Th;\nvar Tr_Te = msg.payload.A.Tr_Te;\nvar Tr_DR = msg.payload.A.Tr_DR;\nvar Tr_CS = msg.payload.A.Tr_CS;\nvar Tr_PCB = msg.payload.A.Tr_PCB;\nvar A_Sc = msg.payload.A.A_Sc;\nvar A_An = msg.payload.A.A_An;\nvar A_DT = msg.payload.A.A_DT;\n\nvar O_AC = msg.payload.O.AC;\nvar O_PV = msg.payload.O.PV;\n\nvar S_T = msg.payload.T;\nvar S_H = msg.payload.H;\n\nvar ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toISOString();\ne = d.getTime();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = a[3];\nvar m = a[4];\nvar s = a[5];\nvar y = a[0];\nvar month = a[1];\nvar day = a[2];\n\nvar logDate = (y+\"-\"+month+\"-\"+day);\nvar logTime = (h+\":\"+m+\":\"+s);\n\n\nvar insertSelect = \"INSERT INTO [dbo].[statusData]([GW_Unit],[entryDate],[entryTime],[A_Tr_Th],[A_Tr_Te],[A_Tr_DR],[A_Tr_CS],[A_Tr_PCB],[A_A_Sc],[A_A_An],[A_A_DT],[O_AC],[O_PV],[T],[H])\";\nvar values = \"VALUES ('G1_\"+unit+\"','\"+logDate+\"','\"+logTime+\"',\"+Tr_Th+\",\"+Tr_Te+\",\"+Tr_DR+\",\"+Tr_CS+\",\";\nvar values2 = Tr_PCB+\",\"+A_Sc+\",\"+A_An+\",\"+A_DT+\",\"+O_AC+\",\"+O_PV+\",\"+S_T+\",\"+S_H+\")\";\n\nmsg.payload = insertSelect + \" \" + values + values2;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Time: \"+logTime});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":2420,"wires":[["61499137.6805c"]]},{"id":"a07163bb.0f47c","type":"delay","z":"e2e5a56.78da658","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":240,"y":2420,"wires":[["939c0414.47f9b8"]]},{"id":"c6d1e632.d3c668","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"300","crontab":"","once":true,"onceDelay":"0.3","topic":"","payload":"","payloadType":"date","x":630,"y":2300,"wires":[["dbe41e8.3f380e","b7ce594b.2d6838"]]},{"id":"c600a5f9.122298","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"","query":"","outField":"payload","x":980,"y":2300,"wires":[[]]},{"id":"3c2dee7a.bd2de2","type":"comment","z":"e2e5a56.78da658","name":"Log Data to SQL","info":"","x":620,"y":2260,"wires":[]},{"id":"61499137.6805c","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"","query":"","outField":"payload","x":670,"y":2420,"wires":[[]]},{"id":"378cd0d6.99759","type":"mqtt out","z":"e2e5a56.78da658","name":"","topic":"","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":430,"y":2300,"wires":[]},{"id":"db09751b.bd35a8","type":"inject","z":"e2e5a56.78da658","name":"Connection","repeat":"86400","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":150,"y":2300,"wires":[["5cdaf0d.92dc31"]]},{"id":"7ffc4d27.7340e4","type":"comment","z":"e2e5a56.78da658","name":"Request Data from Unit","info":"","x":140,"y":2260,"wires":[]},{"id":"db0eb500.1cae88","type":"inject","z":"e2e5a56.78da658","name":"Update","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"GWA/gw6A68C63ADADB34/U","payload":"","payloadType":"str","x":140,"y":2340,"wires":[["efbbd896.a32a28","6c3a62b1.b1ef0c"]]},{"id":"efbbd896.a32a28","type":"function","z":"e2e5a56.78da658","name":"Tot","func":"msg.topic = \"GWA/\"+flow.get(\"unit2\")+\"/1/A\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2380,"wires":[["378cd0d6.99759"]]},{"id":"6c3a62b1.b1ef0c","type":"function","z":"e2e5a56.78da658","name":"Update","func":"msg.topic = \"GWA/\"+flow.get(\"unit2\")+\"/U\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":2340,"wires":[["378cd0d6.99759"]]},{"id":"5cdaf0d.92dc31","type":"function","z":"e2e5a56.78da658","name":"Sts","func":"msg.topic = \"GWA/\"+flow.get(\"unit2\")+\"/S/CW\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2300,"wires":[["378cd0d6.99759"]]},{"id":"ff771d2d.0251b","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"3600","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":630,"y":2380,"wires":[["a0ec4cb5.0c1b9"]]},{"id":"a0ec4cb5.0c1b9","type":"function","z":"e2e5a56.78da658","name":"Efficiencies","func":"var tagname = flow.get(\"unit2\");\nmsg.timestamp= new Date().toISOString()\nvar now     = new Date(); \nvar yesterday = now.setDate(now.getDate() - 2);\nmyepoch     = now.getTime();\nvar year    = now.getFullYear();\nvar month   = now.getMonth()+1; \nvar day     = now.getDate();\nvar hour    = now.getHours();\nvar minute  = now.getMinutes();\nvar second  = now.getSeconds(); \nvar logDate = year+\"-\"+month+\"-\"+day;\nvar logTime = hour+\":\"+minute+\":\"+second;\n\nvar sql = \"\";\nvar outputs = [];\n\nsql = \"SELECT MAX(Pt_kWh_AC) AS AC, MAX(Pt_kWh_PV) AS PV FROM dbo.unitPowerData WHERE (GW_Unit = N'G1_\"+tagname+\"')\";\n\noutputs.push({payload:sql});        \n\n// Update the status with current timestamp\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Last update: \"+ logTime});    \n\nreturn [ outputs ];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":2380,"wires":[["e11acf7d.22473"]]},{"id":"e11acf7d.22473","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"Efficiencies","query":"","outField":"payload","x":970,"y":2380,"wires":[["1f028abe.c950d5"]]},{"id":"1f028abe.c950d5","type":"function","z":"e2e5a56.78da658","name":"","func":"var TotalPV=msg.payload[0].PV;\nvar TotalAC=msg.payload[0].AC;\nvar _PowerData\t= [];   // Output array\nvar Output;\n\n_PowerData\t= {\n        \"AC\":TotalAC,\n        \"PV\":TotalPV\n    };\n\nOutput = {\n    \"payload\": [_PowerData]\n}\n\nvar costAC = TotalAC * parseFloat(global.get(\"R_kW\"));\nvar costPV = TotalPV * parseFloat(global.get(\"R_kW\"));\nvar EffPV = (TotalPV / (TotalAC+TotalPV)*100);\nvar carbon = (parseFloat(TotalPV) * 0.7)/1000;\n\nflow.set(\"G2ACkW\", TotalAC.toFixed(0));\nflow.set(\"G2PVkW\", TotalPV.toFixed(0));\nflow.set(\"G2ACCost\",costAC.toFixed(2));\nflow.set(\"G2PVCost\",costPV.toFixed(2));\nflow.set(\"G2PVUsage\",EffPV.toFixed(0));\nflow.set(\"G2Carbon\",carbon.toFixed(2))\n\nreturn Output;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":2380,"wires":[[]]},{"id":"dbe41e8.3f380e","type":"function","z":"e2e5a56.78da658","name":"G1 - Analog","func":"var unit = flow.get(\"unit2\");\nmsg.payload = global.get(\"_geyserTestData_\"+unit);\nvar dateValue = msg.payload.CS.t.Y + msg.payload.CS.t.M + msg.payload.CS.t.D;\nvar timeValue = msg.payload.CS.t.h +\":\"+ msg.payload.CS.t.m +\":\"+ msg.payload.CS.t.s;\n\nvar connectionServer = msg.payload.CS.S;\nvar connectionWifi = msg.payload.CS.I;\n\nvar G1temperaturePCB = msg.payload.G1.T.PCB;\nvar G1temperatureGeyser = msg.payload.G1.T.G;\n\nvar G1currentAC = msg.payload.G1.I.AC;\nvar G1currentPV = msg.payload.G1.I.PV;\n\nvar ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toLocaleTimeString();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = dt.substr(0, 2);\nvar m = a[4];\nvar s = a[5];\nvar y = a[0];\nvar month = a[1];\nvar day = a[2];\n\nvar logDate = (y+\"-\"+month+\"-\"+day);\nvar logTime = (h+\":\"+m+\":\"+s);\n\nvar insertSelect = \"INSERT INTO [dbo].[analogData]([GW_Unit],[entrydate],[entrytime],[CS_S],[CS_I],[CS_Date],[CS_Time],[T_PCB],[T_G],[I_AC],[I_PV],[V_AC],[V_PV],[T_PCB_AVG],[T_G_AVG],[I_AC_AVG],[I_PV_AVG],[V_AC_AVG],[V_PV_AVG],[R_IRR],[R_IRR_AVG],[T2_G],[T2_G_AVG])\";\nvar values = \"VALUES('G1_\"+unit+\"','\"+logDate+\"','\"+logTime+\"',\"+connectionServer+\",\"+connectionWifi+\",'\"+dateValue+\"','\"+timeValue+\"',\";\nvar G1values = G1temperaturePCB+\",\"+G1temperatureGeyser+\",\"+G1currentAC+\",\"+G1currentPV+\",0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0)\";\n\nvar outputs = [];\nvar sql;\nsql = insertSelect + \" \" + values + G1values;\nmsg.payload=sql;\n\nnode.status({fill:\"green\",shape:\"ring\",text:\"Time: \"+logTime});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":2300,"wires":[["c600a5f9.122298"]]},{"id":"b7ce594b.2d6838","type":"function","z":"e2e5a56.78da658","name":"G1 - Power","func":"var unit = flow.get(\"unit2\");\nvar payload = global.get(\"_geyserTestData_\"+unit);\n\nvar Raw_AC = payload.G1.Pt.Raw.I2AC;\nvar Raw_PV = payload.G1.Pt.Raw.I2PV;\nvar kWh_AC = payload.G1.Pt.kWh.AC;\nvar kWh_PV = payload.G1.Pt.kWh.PV;\n\nvar ts = msg.timestamp || Date.now();\nvar d = new Date(ts);\ndt = d.toLocaleTimeString();\n\nvar a = d.toJSON().split(/\\D+/);\nvar h = dt.substr(0, 2);\nvar m = a[4];\nvar s = a[5];\nvar y = a[0];\nvar month = a[1];\nvar day = a[2];\n\nvar logDate = (y+\"-\"+month+\"-\"+day);\nvar logTime = (h+\":\"+m+\":\"+s);\n\nvar insertSelect = \"INSERT INTO [dbo].[unitPowerData]([GW_Unit],[entryDate],[entryTime],[Pt_Raw_AC],[Pt_Raw_PV],[Pt_kWh_AC],[Pt_kWh_PV])\";\nvar values       = \"VALUES ('G1_\"+unit+\"','\"+logDate+\"','\"+logTime+\"',\"+Raw_AC+\",\"+Raw_PV+\",\"+kWh_AC+\",\"+kWh_PV+\")\";\n\nmsg.payload = insertSelect + \" \" + values;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Time: \"+logTime});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":2340,"wires":[["c600a5f9.122298"]]},{"id":"d18d2efd.2b589","type":"comment","z":"e2e5a56.78da658","name":"Geyser Charts","info":"","x":110,"y":3000,"wires":[]},{"id":"1bef45f0.c6e76a","type":"MSSQL-UCGv2","z":"e2e5a56.78da658","mssqlCN":"feb71708.d69ec8","name":"SQL","query":"","outField":"payload","x":590,"y":3080,"wires":[["d39ca48a.4be4f8"]]},{"id":"c6ae7619.d241f8","type":"ui_date_picker","z":"e2e5a56.78da658","name":"","label":"Date","group":"9a5b4611.5b4408","order":1,"width":"6","height":"1","passthru":true,"topic":"","x":270,"y":3080,"wires":[["baa24f14.6d8e9"]]},{"id":"503d591b.a7cb98","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"9a5b4611.5b4408","order":2,"width":"2","height":"1","passthru":false,"label":"Refresh","tooltip":"","color":"","bgcolor":"grey","icon":"fa-refresh","payload":"","payloadType":"date","topic":"","x":120,"y":3080,"wires":[["c6ae7619.d241f8","baa24f14.6d8e9"]]},{"id":"d39ca48a.4be4f8","type":"function","z":"e2e5a56.78da658","name":"","func":"/*#################################################################################################################################################################################################\n\tGLOBAL VARIABLES\n#################################################################################################################################################################################################*/\n\t// Memory Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar\tTemperature = [];\n\t\tvar\tI_AC = [];\n\t\tvar\tI_PV = [];\n\t\tvar\tT_PCB = [];\n\t\tvar labelsDate = [];\n        var days = msg.payload.length;\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Output Variables\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\tvar _PowerData\t= [];   // Output array\n        var Output;\n\t\t//-----------------------------------------------------------------------------------------\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n    // Contents Generation\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    // Daily Data\n    for (var i = 0; i < days; i++)\n    {\n        var hour = msg.payload[i].entrytime.toISOString();\n        var hourS = hour.search(\"T\")+1;\n        var hourE = hour.search(\"Z\")-4;\n        var len = hour.length;\n        var res = hour.substring(hourS, hourE);\n        labelsDate[i] = res;\n        Temperature[i] = msg.payload[i].T_G;\n        I_AC[i] = ((msg.payload[i].I_AC/10)*((1000-23)+23))/1000;\n    }\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t// Output Generation\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\t// Generate Output Array\n\t\t//-----------------------------------------------------------------------------------------\n        _PowerData\t= {\n                \"labels\":labelsDate,\n                \"series\":[\"Temperature\"],\n//                \"series\":[\"Temperature\", \"Water Pressure\"],\n                \"data\":[Temperature]\n//                \"data\":[Temperature, I_AC]\n            };\n        \n        Output = {\n            \"payload\": [_PowerData]\n        }\n            \n\t\t//-----------------------------------------------------------------------------------------\n\n\t\t// Publish Output\n\t\t//-----------------------------------------------------------------------------------------\n\t\t\treturn Output;\n\t\t//-----------------------------------------------------------------------------------------\n\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":3080,"wires":[["3e1ef17c.407b1e","63a184b7.29df8c"]]},{"id":"3e1ef17c.407b1e","type":"ui_chart","z":"e2e5a56.78da658","name":"","group":"9a5b4611.5b4408","order":3,"width":"10","height":"5","label":"Geyser 2 - Temperature","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"70","removeOlder":1,"removeOlderPoints":"10000","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#ff6b24","#008000","#ff80c0","#ff4646","#00d200","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":950,"y":3080,"wires":[[]]},{"id":"76987f36.be1f9","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":3120,"wires":[["baa24f14.6d8e9"]]},{"id":"462e301e.0b05e","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"","crontab":"01 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":3040,"wires":[["c6ae7619.d241f8"]]},{"id":"baa24f14.6d8e9","type":"function","z":"e2e5a56.78da658","name":"Get Date","func":"var tagname = flow.get(\"unit2\");\nvar now     = new Date(msg.payload);\nvar year    = now.getFullYear();\nvar month   = now.getMonth()+1; \nvar day     = now.getDate();\nvar hour    = now.getHours();\nvar minute  = now.getMinutes();\nvar second  = now.getSeconds(); \n\nif(month.toString().length == 1)  { var month = '0'+month;}\nif(day.toString().length == 1)    { var day = '0'+day;}   \nif(hour.toString().length == 1)   { var hour = '0'+hour;}\nif(minute.toString().length == 1) { var minute = '0'+minute;}\nif(second.toString().length == 1) { var second = '0'+second;}\n\nmsg.timestamp = year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second;\nmsg.date = year+'-'+month+'-'+day;\n\nmsg.payload = \"SELECT TOP (100) PERCENT GW_Unit, entrydate, entrytime, T_G, I_AC FROM dbo.analogData WHERE (GW_Unit = N'G1_\"+tagname+\"') AND (entrydate = '\"+msg.date+\"') ORDER BY entrytime\";\nnode.status({text:tagname});\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":3080,"wires":[["1bef45f0.c6e76a"]]},{"id":"ba80128c.5da7c","type":"comment","z":"e2e5a56.78da658","name":"Timers","info":"","x":90,"y":3320,"wires":[]},{"id":"c0f6fd81.e8494","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":370,"y":3360,"wires":[["5d7b1fb6.d81b8","a72098f6.3a1718","ed3be82e.d2e8e8","5ed29a2a.34cce4","bbaf1c10.d0c0c","496a4558.e5f99c"]]},{"id":"b4d07687.ac3bd8","type":"deduplicate","z":"e2e5a56.78da658","name":"","registryclass":"","noderole":"standalone","expiry":5,"x":230,"y":3360,"wires":[["c0f6fd81.e8494"],[]]},{"id":"6cae596.837fea8","type":"ui_template","z":"e2e5a56.78da658","group":"9e37422.d97c7c","name":"Timers","order":2,"width":"6","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'DeepSkyBlue' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":690,"y":3360,"wires":[[]]},{"id":"80ab7265.e2c58","type":"ui_template","z":"e2e5a56.78da658","group":"9e37422.d97c7c","name":"Title","order":1,"width":"6","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: #273746;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EAECEE;\"\n            ng-style=\"{background: #EAECEE}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":690,"y":3320,"wires":[[]]},{"id":"5d7b1fb6.d81b8","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload=1\nmsg.text = \"Timers 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3320,"wires":[["80ab7265.e2c58"]]},{"id":"a72098f6.3a1718","type":"function","z":"e2e5a56.78da658","name":"Timers Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/C\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":3360,"wires":[["6cae596.837fea8"]]},{"id":"ed3be82e.d2e8e8","type":"function","z":"e2e5a56.78da658","name":"Timer 1 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/1\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 1 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 1 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":540,"y":3400,"wires":[["b4ace08d.1ed48"]]},{"id":"5ed29a2a.34cce4","type":"function","z":"e2e5a56.78da658","name":"Timer 2 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/2\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 2 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 2 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":540,"y":3440,"wires":[["cd172de9.07ab"]]},{"id":"bbaf1c10.d0c0c","type":"function","z":"e2e5a56.78da658","name":"Timer 3 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/3\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 3 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 3 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":540,"y":3480,"wires":[["c3b98ea2.5522e"]]},{"id":"496a4558.e5f99c","type":"function","z":"e2e5a56.78da658","name":"Timer 4 Enabled","func":"var payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/4\");\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 4 Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timer 4 Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":540,"y":3520,"wires":[["ec45392a.163d58"]]},{"id":"b4ace08d.1ed48","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 1","tooltip":"","group":"9e37422.d97c7c","order":3,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":700,"y":3400,"wires":[["8dd1b0e0.a1064"]]},{"id":"8dd1b0e0.a1064","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":850,"y":3400,"wires":[["56dde83f.de95b8"]]},{"id":"cd172de9.07ab","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 2","tooltip":"","group":"9e37422.d97c7c","order":4,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":700,"y":3440,"wires":[["5fa2843f.68d03c"]]},{"id":"5fa2843f.68d03c","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":850,"y":3440,"wires":[["332a6ede.26e5a2"]]},{"id":"c3b98ea2.5522e","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 3","tooltip":"","group":"9e37422.d97c7c","order":5,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":700,"y":3480,"wires":[["bafdca4e.122008"]]},{"id":"bafdca4e.122008","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":850,"y":3480,"wires":[["c0b18d4a.cbc12"]]},{"id":"ec45392a.163d58","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Timer 4","tooltip":"","group":"9e37422.d97c7c","order":6,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":700,"y":3520,"wires":[["9970ad.42b7df5"]]},{"id":"9970ad.42b7df5","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"C\": payload\n    \t\t\t\t}\n};\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":850,"y":3520,"wires":[["fddd001c.8f57e"]]},{"id":"eff98206.5b825","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw86840D8E970C2B/1/Time/1","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1130,"y":3400,"wires":[]},{"id":"c824684e.c1b668","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw86840D8E970C2B/1/Time/2","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1130,"y":3440,"wires":[]},{"id":"af47c111.85294","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw86840D8E970C2B/1/Time/3","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1130,"y":3480,"wires":[]},{"id":"55984666.a220f8","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw86840D8E970C2B/1/Time/4","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1130,"y":3520,"wires":[]},{"id":"421dd572.42411c","type":"mqtt in","z":"e2e5a56.78da658","name":"Time 1","topic":"GW/gw86840D8E970C2B/1/Time/#","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":90,"y":3360,"wires":[["b4d07687.ac3bd8"]]},{"id":"56dde83f.de95b8","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":970,"y":3400,"wires":[["eff98206.5b825"]]},{"id":"332a6ede.26e5a2","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":970,"y":3440,"wires":[["c824684e.c1b668"]]},{"id":"c0b18d4a.cbc12","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":970,"y":3480,"wires":[["af47c111.85294"]]},{"id":"fddd001c.8f57e","type":"rbe","z":"e2e5a56.78da658","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":970,"y":3520,"wires":[["55984666.a220f8"]]},{"id":"a062673a.7d8758","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":3180,"wires":[["aad15fef.315b1"]]},{"id":"aad15fef.315b1","type":"mqtt out","z":"e2e5a56.78da658","name":"GET Time","topic":"GWA/gw86840D8E970C2B/S/Time/G","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":580,"y":3180,"wires":[]},{"id":"b7aa1d7a.7a979","type":"function","z":"e2e5a56.78da658","name":"","func":"//{\"Y\":2019,\"M\":3,\"D\":11,\"h\":8,\"m\":1}\nvar tagname = flow.get(\"unit2\");\nmsg.timestamp= new Date().toISOString();\nvar now     = new Date(); \nvar year    = now.getFullYear();\nvar month   = now.getMonth()+1; \nvar day     = now.getDate();\nvar hour    = now.getHours();\nvar minute  = now.getMinutes();\nvar second  = now.getSeconds(); \nvar logDate = year+\"-\"+month+\"-\"+day;\nvar logTime = hour+\":\"+minute+\":\"+second;\n\nvar output\t= [];\nvar time = {\n    \"payload\": {\n\t    \"Y\": year,\n\t    \"M\": month,\n\t    \"D\": day,\n\t    \"h\": hour,\n\t    \"m\": minute\n    }\n};\n\noutput\t=\t[\n\t\t\t\ttime\n\t\t\t];\nnode.status({text:output});\n\nreturn output;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":3220,"wires":[["8039d395.650e6"]]},{"id":"2dc0f862.49a7c8","type":"mqtt in","z":"e2e5a56.78da658","name":"Time","topic":"GW/gw86840D8E970C2B/S/Time/G","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":110,"y":3260,"wires":[["f009b846.54fcc8"]]},{"id":"feebaac9.031a28","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":430,"y":3260,"wires":[["f66a13f1.19a25"]]},{"id":"f009b846.54fcc8","type":"deduplicate","z":"e2e5a56.78da658","name":"","registryclass":"","noderole":"standalone","expiry":5,"x":270,"y":3260,"wires":[["feebaac9.031a28"],[]]},{"id":"f66a13f1.19a25","type":"function","z":"e2e5a56.78da658","name":"","func":"var year = msg.payload.Y;\nvar month = msg.payload.M;\nvar day = msg.payload.D;\nvar hour = msg.payload.h;\nvar min = msg.payload.m;\n\nmsg.payload = year+\"/\"+month+\"/\"+day+\" \"+hour+\":\"+min;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3260,"wires":[["c7d0861.be8c478"]]},{"id":"bc214174.c9b25","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"9e37422.d97c7c","order":8,"width":0,"height":0,"passthru":false,"label":"Set Current Time","tooltip":"","color":"","bgcolor":"grey","icon":"","payload":"","payloadType":"str","topic":"","x":150,"y":3220,"wires":[["b7aa1d7a.7a979"]]},{"id":"8039d395.650e6","type":"mqtt out","z":"e2e5a56.78da658","name":"SET Time","topic":"GWR/gw86840D8E970C2B/S/Time/G","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":580,"y":3220,"wires":[]},{"id":"c7d0861.be8c478","type":"ui_text","z":"e2e5a56.78da658","group":"9e37422.d97c7c","order":7,"width":0,"height":0,"name":"","label":"Time","format":"{{msg.payload}}","layout":"row-spread","x":730,"y":3260,"wires":[]},{"id":"149aa932.a7cf17","type":"function","z":"e2e5a56.78da658","name":"Timers Enabled","func":"// {\"C\":1,\"S\":{\"h\":4,\"m\":15},\"E\":{\"h\":6,\"m\":45},\"W\":{\"Mo\":1,\"Tu\":1,\"We\":1,\"Th\":1,\"Fr\":1,\"Sa\":0,\"Su\":0}}\nvar payload = JSON.stringify(msg.payload);\nvar topic   = JSON.stringify(msg.topic);\nvar n       = payload.includes(\"C\");\nvar timers  = topic.includes(\"Time/C\");\nvar start   = payload.includes(\"S\");\nvar end     = payload.includes(\"E\");\nvar day     = payload.includes(\"W\");\nvar start_h = flow.get(\"start1_h\")||0;\nvar start_m = flow.get(\"start1_m\")||0;\nvar end_h   = flow.get(\"end1_h\")||0;\nvar end_m   = flow.get(\"end_m\")||0;\n\n\nif(timers===true)\n{\n    if(n === true)\n    {\n        if(msg.payload.C == 1)\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Enabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n        else\n        {\n            msg.payload = msg.payload.C;\n            msg.text = \"Timers Disabled\";\n            node.status({text:msg.payload});\n            msg.topic = msg.topic;\n            return msg;\n        }\n    }\n    else if(start === true)\n    {\n        flow.set(\"start1_h\", msg.payload.S)\n    }\n    else if(end === true)\n    {\n        \n    }\n    else\n    {\n        return null;\n    }\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":320,"y":3480,"wires":[[]]},{"id":"63a184b7.29df8c","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":890,"y":3040,"wires":[]},{"id":"5c6e3423.76206c","type":"ui_template","z":"e2e5a56.78da658","group":"18f2a4b1.a31edb","name":"Title","order":1,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: #273746;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EAECEE;\"\n            ng-style=\"{background: #EAECEE}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":550,"y":2540,"wires":[[]]},{"id":"5e69fb09.1e0364","type":"comment","z":"e2e5a56.78da658","name":"Dashboard 2","info":"","x":110,"y":2500,"wires":[]},{"id":"878c4f0b.8f761","type":"inject","z":"e2e5a56.78da658","name":"","repeat":"10","crontab":"","once":true,"onceDelay":"0.3","topic":"","payload":"","payloadType":"date","x":110,"y":2540,"wires":[["af6be94e.aaf5e8"]]},{"id":"8fca92ac.ceca6","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload=1\nmsg.text = \"Geyser 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":2540,"wires":[["5c6e3423.76206c"]]},{"id":"af6be94e.aaf5e8","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = flow.get(\"unit2\");\nmsg.unit = 1;\nmsg.desc = \"GeyserWorx 2\"\nmsg.data = global.get(\"_geyserTestData_\"+msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":2540,"wires":[["8fca92ac.ceca6","51a418cf.8b3de8","c000dae8.166c78","1f52ca80.c7f0f6","5fad39df.c8d8a8","68ea8ed.1d2867","be9e73c6.e6746"]]},{"id":"1f52ca80.c7f0f6","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nif(payload.G1.STS.O_AC===0)\n{\n    msg.topic = \"AC:Off\"\n    msg.text = msg.topic;\n}\nelse\n{\n    msg.topic = \"AC:On\"\n    msg.text = msg.topic;\n}\nmsg.payload     = payload.G1.STS.O_AC;\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2560,"wires":[["a97e65d3.59edc8"]]},{"id":"5fad39df.c8d8a8","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nif(payload.G1.SET.O.ACO===0)\n{\n    msg.topic = \"Boost\"\n    msg.text = msg.topic;\n}\nelse\n{\n    msg.topic = \"Boost\"\n    msg.text = msg.topic;\n}\nmsg.payload     = payload.G1.SET.O.ACO;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2580,"wires":[["87f34ce2.b8e4"]]},{"id":"a97e65d3.59edc8","type":"ui_template","z":"e2e5a56.78da658","group":"18f2a4b1.a31edb","name":"AC","order":2,"width":"2","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'DeepSkyBlue' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":550,"y":2560,"wires":[[]]},{"id":"87f34ce2.b8e4","type":"ui_template","z":"e2e5a56.78da658","group":"18f2a4b1.a31edb","name":"Boost","order":3,"width":"2","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'DeepSkyBlue' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":550,"y":2580,"wires":[[]]},{"id":"d485dff4.3d3d6","type":"ui_template","z":"e2e5a56.78da658","group":"18f2a4b1.a31edb","name":"Dial","order":4,"width":"4","height":"4","format":"<div id=\"thermostat2\"></div>\n\n<style>\n@import url(http://fonts.googleapis.com/css?family=Open+Sans:300);\n#thermostat2 {\n  margin: 0 auto;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n.dial {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.dial.away .dial__ico__leaf {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--target {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--target--half {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--away {\n  opacity: 1;\n}\n.dial .dial__shape {\n  -webkit-transition: fill 0.5s;\n  transition: fill 0.5s;\n}\n.dial__ico__leaf {\n  fill: #13EB13;\n  opacity: 0;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n  pointer-events: none;\n}\n.dial.has-leaf .dial__ico__leaf {\n  display: block;\n  opacity: 1;\n  pointer-events: initial;\n}\n.dial__editableIndicator {\n  fill: white;\n  fill-rule: evenodd;\n  opacity: 0;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n}\n.dial--edit .dial__editableIndicator {\n  opacity: 1;\n}\n.dial--state--off .dial__shape {\n  fill: #3d3c3c;\n}\n.dial--state--heating .dial__shape {\n  fill: #E36304;\n}\n.dial--state--cooling .dial__shape {\n  fill: #3c9517;\n}\n.dial__ticks path {\n  fill: rgba(255, 255, 255, 0.3);\n}\n.dial__ticks path.active {\n  fill: rgba(255, 255, 255, 0.8);\n}\n.dial text {\n  fill: white;\n  text-anchor: middle;\n  font-family: Helvetica, sans-serif;\n  alignment-baseline: central;\n}\n.dial__lbl--target {\n  font-size: 120px;\n  font-weight: bold;\n}\n.dial__lbl--target--half {\n  font-size: 40px;\n  font-weight: bold;\n  opacity: 0;\n  -webkit-transition: opacity 0.1s;\n  transition: opacity 0.1s;\n}\n.dial__lbl--target--half.shown {\n  opacity: 1;\n  -webkit-transition: opacity 0s;\n  transition: opacity 0s;\n}\n.dial__lbl--ambient {\n  font-size: 22px;\n  font-weight: bold;\n}\n.dial__lbl--away {\n  font-size: 72px;\n  font-weight: bold;\n  opacity: 0;\n  pointer-events: none;\n}\n#controls {\n  font-family: Open Sans;\n  background-color: rgba(255, 255, 255, 0.25);\n  padding: 20px;\n  border-radius: 5px;\n  position: absolute;\n  left: 50%;\n  -webkit-transform: translatex(-50%);\n          transform: translatex(-50%);\n  margin-top: 20px;\n}\n#controls label {\n  text-align: left;\n  display: block;\n}\n#controls label span {\n  display: inline-block;\n  width: 200px;\n  text-align: right;\n  font-size: 0.8em;\n  text-transform: uppercase;\n}\n#controls p {\n  margin: 0;\n  margin-bottom: 1em;\n  padding-bottom: 1em;\n  border-bottom: 2px solid #ccc;\n}\n</style>\n<script>\n    var thermostatDial = (function() {\n\t\n\t/*\n\t * Utility functions\n\t */\n\t\n\t// Create an element with proper SVG namespace, optionally setting its attributes and appending it to another element\n\tfunction createSVGElement(tag,attributes,appendTo) {\n\t\tvar element = document.createElementNS('http://www.w3.org/2000/svg',tag);\n\t\tattr(element,attributes);\n\t\tif (appendTo) {\n\t\t\tappendTo.appendChild(element);\n\t\t}\n\t\treturn element;\n\t}\n\t\n\t// Set attributes for an element\n\tfunction attr(element,attrs) {\n\t\tfor (var i in attrs) {\n\t\t\telement.setAttribute(i,attrs[i]);\n\t\t}\n\t}\n\t\n\t// Rotate a cartesian point about given origin by X degrees\n\tfunction rotatePoint(point, angle, origin) {\n\t\tvar radians = angle * Math.PI/180;\n\t\tvar x = point[0]-origin[0];\n\t\tvar y = point[1]-origin[1];\n\t\tvar x1 = x*Math.cos(radians) - y*Math.sin(radians) + origin[0];\n\t\tvar y1 = x*Math.sin(radians) + y*Math.cos(radians) + origin[1];\n\t\treturn [x1,y1];\n\t}\n\t\n\t// Rotate an array of cartesian points about a given origin by X degrees\n\tfunction rotatePoints(points, angle, origin) {\n\t\treturn points.map(function(point) {\n\t\t\treturn rotatePoint(point, angle, origin);\n\t\t});\n\t}\n\t\n\t// Given an array of points, return an SVG path string representing the shape they define\n\tfunction pointsToPath(points) {\n\t\treturn points.map(function(point, iPoint) {\n\t\t\treturn (iPoint>0?'L':'M') + point[0] + ' ' + point[1];\n\t\t}).join(' ')+'Z';\n\t}\n\t\n\tfunction circleToPath(cx, cy, r) {\n\t\treturn [\n\t\t\t\"M\",cx,\",\",cy,\n\t\t\t\"m\",0-r,\",\",0,\n\t\t\t\"a\",r,\",\",r,0,1,\",\",0,r*2,\",\",0,\n\t\t\t\"a\",r,\",\",r,0,1,\",\",0,0-r*2,\",\",0,\n\t\t\t\"z\"\n\t\t].join(' ').replace(/\\s,\\s/g,\",\");\n\t}\n\t\n\tfunction donutPath(cx,cy,rOuter,rInner) {\n\t\treturn circleToPath(cx,cy,rOuter) + \" \" + circleToPath(cx,cy,rInner);\n\t}\n\t\n\t// Restrict a number to a min + max range\n\tfunction restrictToRange(val,min,max) {\n\t\tif (val < min) return min;\n\t\tif (val > max) return max;\n\t\treturn val;\n\t}\n\t\n\t// Round a number to the nearest 0.5\n\tfunction roundHalf(num) {\n\t\treturn Math.round(num*2)/2;\n\t}\n\t\n\tfunction setClass(el, className, state) {\n\t\tel.classList[state ? 'add' : 'remove'](className);\n\t}\n\t\n\t/*\n\t * The \"MEAT\"\n\t */\n\n\treturn function(targetElement, options) {\n\t\tvar self = this;\n\t\t\n\t\t/*\n\t\t * Options\n\t\t */\n\t\toptions = options || {};\n\t\toptions = {\n\t\t\tdiameter: options.diameter || 400,\n\t\t\tminValue: options.minValue || 00, // Minimum value for target temperature\n\t\t\tmaxValue: options.maxValue || 85, // Maximum value for target temperature\n\t\t\tnumTicks: options.numTicks || 200, // Number of tick lines to display around the dial\n\t\t\tonSetTargetTemperature: options.onSetTargetTemperature || function() {}, // Function called when new target temperature set by the dial\n\t\t};\n\t\t\n\t\t/*\n\t\t * Properties - calculated from options in many cases\n\t\t */\n\t\tvar properties = {\n\t\t\ttickDegrees: 300, //  Degrees of the dial that should be covered in tick lines\n\t\t\trangeValue: options.maxValue - options.minValue,\n\t\t\tradius: options.diameter/2,\n\t\t\tticksOuterRadius: options.diameter / 30,\n\t\t\tticksInnerRadius: options.diameter / 8,\n\t\t\thvac_states: ['off', 'heating', 'cooling'],\n\t\t\tdragLockAxisDistance: 15,\n\t\t}\n\t\tproperties.lblAmbientPosition = [properties.radius, properties.ticksOuterRadius-(properties.ticksOuterRadius-properties.ticksInnerRadius)/2]\n\t\tproperties.offsetDegrees = 180-(360-properties.tickDegrees)/2;\n\t\t\n\t\t/*\n\t\t * Object state\n\t\t */\n\t\tvar state = {\n\t\t\ttarget_temperature: options.minValue,\n\t\t\tambient_temperature: options.minValue,\n\t\t\thvac_state: properties.hvac_states[0],\n\t\t\thas_leaf: false,\n\t\t\taway: false\n\t\t};\n\t\t\n\t\t/*\n\t\t * Property getter / setters\n\t\t */\n\t\tObject.defineProperty(this,'target_temperature',{\n\t\t\tget: function() {\n\t\t\t\treturn state.target_temperature;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.target_temperature = restrictTargetTemperature(+val);\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'ambient_temperature',{\n\t\t\tget: function() {\n\t\t\t\treturn state.ambient_temperature;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.ambient_temperature = roundHalf(+val);\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'hvac_state',{\n\t\t\tget: function() {\n\t\t\t\treturn state.hvac_state;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tif (properties.hvac_states.indexOf(val)>=0) {\n\t\t\t\t\tstate.hvac_state = val;\n\t\t\t\t\trender();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'has_leaf',{\n\t\t\tget: function() {\n\t\t\t\treturn state.has_leaf;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.has_leaf = !!val;\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'away',{\n\t\t\tget: function() {\n\t\t\t\treturn state.away;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.away = !!val;\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\t\n\t\t/*\n\t\t * SVG\n\t\t */\n\t\tvar svg = createSVGElement('svg',{\n\t\t\twidth: '100%', //options.diameter+'px',\n\t\t\theight: '100%', //options.diameter+'px',\n\t\t\tviewBox: '0 0 '+options.diameter+' '+options.diameter,\n\t\t\tclass: 'dial'\n\t\t},targetElement);\n\t\t// CIRCULAR DIAL\n\t\tvar circle = createSVGElement('circle',{\n\t\t\tcx: properties.radius,\n\t\t\tcy: properties.radius,\n\t\t\tr: properties.radius,\n\t\t\tclass: 'dial__shape'\n\t\t},svg);\n\t\t// EDITABLE INDICATOR\n\t\tvar editCircle = createSVGElement('path',{\n\t\t\td: donutPath(properties.radius,properties.radius,properties.radius-4,properties.radius-8),\n\t\t\tclass: 'dial__editableIndicator',\n\t\t},svg);\n\t\t\n\t\t/*\n\t\t * Ticks\n\t\t */\n\t\tvar ticks = createSVGElement('g',{\n\t\t\tclass: 'dial__ticks'\t\n\t\t},svg);\n\t\tvar tickPoints = [\n\t\t\t[properties.radius-1, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1, properties.ticksInnerRadius],\n\t\t\t[properties.radius-1, properties.ticksInnerRadius]\n\t\t];\n\t\tvar tickPointsLarge = [\n\t\t\t[properties.radius-1.5, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1.5, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1.5, properties.ticksInnerRadius+20],\n\t\t\t[properties.radius-1.5, properties.ticksInnerRadius+20]\n\t\t];\n\t\tvar theta = properties.tickDegrees/options.numTicks;\n\t\tvar tickArray = [];\n\t\tfor (var iTick=0; iTick<options.numTicks; iTick++) {\n\t\t\ttickArray.push(createSVGElement('path',{d:pointsToPath(tickPoints)},ticks));\n\t\t};\n\t\t\n\t\t/*\n\t\t * Labels\n\t\t */\n\t\tvar lblTarget = createSVGElement('text',{\n\t\t\tx: properties.radius,\n\t\t\ty: properties.radius,\n\t\t\tclass: 'dial__lbl dial__lbl--target'\n\t\t},svg);\n\t\tvar lblTarget_text = document.createTextNode('');\n\t\tlblTarget.appendChild(lblTarget_text);\n\t\t//\n\t\tvar lblTargetHalf = createSVGElement('text',{\n\t\t\tx: properties.radius + properties.radius/2.5,\n\t\t\ty: properties.radius - properties.radius/8,\n\t\t\tclass: 'dial__lbl dial__lbl--target--half'\n\t\t},svg);\n\t\tvar lblTargetHalf_text = document.createTextNode('5');\n\t\tlblTargetHalf.appendChild(lblTargetHalf_text);\n\t\t//\n\t\tvar lblAmbient = createSVGElement('text',{\n\t\t\tclass: 'dial__lbl dial__lbl--ambient'\n\t\t},svg);\n\t\tvar lblAmbient_text = document.createTextNode('');\n\t\tlblAmbient.appendChild(lblAmbient_text);\n\t\t//\n\t\tvar lblAway = createSVGElement('text',{\n\t\t\tx: properties.radius,\n\t\t\ty: properties.radius,\n\t\t\tclass: 'dial__lbl dial__lbl--away'\n\t\t},svg);\n\t\tvar lblAway_text = document.createTextNode('AWAY');\n\t\tlblAway.appendChild(lblAway_text);\n\t\t//\n\t\tvar icoLeaf = createSVGElement('path',{\n\t\t\tclass: 'dial__ico__leaf'\n\t\t},svg);\n\t\t\n\t\t/*\n\t\t * LEAF\n\t\t */\n\t\tvar leafScale = properties.radius/5/100;\n\t\tvar leafDef = [\"M\", 3, 84, \"c\", 24, 17, 51, 18, 73, -6, \"C\", 100, 52, 100, 22, 100, 4, \"c\", -13, 15, -37, 9, -70, 19, \"C\", 4, 32, 0, 63, 0, 76, \"c\", 6, -7, 18, -17, 33, -23, 24, -9, 34, -9, 48, -20, -9, 10, -20, 16, -43, 24, \"C\", 22, 63, 8, 78, 3, 84, \"z\"].map(function(x) {\n\t\t\treturn isNaN(x) ? x : x*leafScale;\n\t\t}).join(' ');\n\t\tvar translate = [properties.radius-(leafScale*100*0.5),properties.radius*1.5]\n\t\tvar icoLeaf = createSVGElement('path',{\n\t\t\tclass: 'dial__ico__leaf',\n\t\t\td: leafDef,\n\t\t\ttransform: 'translate('+translate[0]+','+translate[1]+')'\n\t\t},svg);\n\t\t\t\n\t\t/*\n\t\t * RENDER\n\t\t */\n\t\tfunction render() {\n\t\t\trenderAway();\n\t\t\trenderHvacState();\n\t\t\trenderTicks();\n\t\t\trenderTargetTemperature();\n\t\t\trenderAmbientTemperature();\n\t\t\trenderLeaf();\n\t\t}\n\t\trender();\n\n\t\t/*\n\t\t * RENDER - ticks\n\t\t */\n\t\tfunction renderTicks() {\n\t\t\tvar vMin, vMax;\n\t\t\tif (self.away) {\n\t\t\t\tvMin = self.ambient_temperature;\n\t\t\t\tvMax = vMin;\n\t\t\t} else {\n\t\t\t\tvMin = Math.min(self.ambient_temperature, self.target_temperature);\n\t\t\t\tvMax = Math.max(self.ambient_temperature, self.target_temperature);\n\t\t\t}\n\t\t\tvar min = restrictToRange(Math.round((vMin-options.minValue)/properties.rangeValue * options.numTicks),0,options.numTicks-1);\n\t\t\tvar max = restrictToRange(Math.round((vMax-options.minValue)/properties.rangeValue * options.numTicks),0,options.numTicks-1);\n\t\t\t//\n\t\t\ttickArray.forEach(function(tick,iTick) {\n\t\t\t\tvar isLarge = iTick==min || iTick==max;\n\t\t\t\tvar isActive = iTick >= min && iTick <= max;\n\t\t\t\tattr(tick,{\n\t\t\t\t\td: pointsToPath(rotatePoints(isLarge ? tickPointsLarge: tickPoints,iTick*theta-properties.offsetDegrees,[properties.radius, properties.radius])),\n\t\t\t\t\tclass: isActive ? 'active' : ''\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\n\t\t/*\n\t\t * RENDER - ambient temperature\n\t\t */\n\t\tfunction renderAmbientTemperature() {\n\t\t\tlblAmbient_text.nodeValue = Math.floor(self.ambient_temperature);\n\t\t\tif (self.ambient_temperature%1!=0) {\n\t\t\t\tlblAmbient_text.nodeValue += 'âµ';\n\t\t\t}\n\t\t\tvar peggedValue = restrictToRange(self.ambient_temperature, options.minValue, options.maxValue);\n\t\t\tdegs = properties.tickDegrees * (peggedValue-options.minValue)/properties.rangeValue - properties.offsetDegrees;\n\t\t\tif (peggedValue > self.target_temperature) {\n\t\t\t\tdegs += 8;\n\t\t\t} else {\n\t\t\t\tdegs -= 8;\n\t\t\t}\n\t\t\tvar pos = rotatePoint(properties.lblAmbientPosition,degs,[properties.radius, properties.radius]);\n\t\t\tattr(lblAmbient,{\n\t\t\t\tx: pos[0],\n\t\t\t\ty: pos[1]\n\t\t\t});\n\t\t}\n\n\t\t/*\n\t\t * RENDER - target temperature\n\t\t */\n\t\tfunction renderTargetTemperature() {\n\t\t\tlblTarget_text.nodeValue = Math.floor(self.target_temperature);\n\t\t\tsetClass(lblTargetHalf,'shown',self.target_temperature%1!=0);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - leaf\n\t\t */\n\t\tfunction renderLeaf() {\n\t\t\tsetClass(svg,'has-leaf',self.has_leaf);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - HVAC state\n\t\t */\n\t\tfunction renderHvacState() {\n\t\t\tArray.prototype.slice.call(svg.classList).forEach(function(c) {\n\t\t\t\tif (c.match(/^dial--state--/)) {\n\t\t\t\t\tsvg.classList.remove(c);\n\t\t\t\t};\n\t\t\t});\n\t\t\tsvg.classList.add('dial--state--'+self.hvac_state);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - away\n\t\t */\n\t\tfunction renderAway() {\n\t\t\tsvg.classList[self.away ? 'add' : 'remove']('away');\n\t\t}\n\t\t\n\t\t/*\n\t\t * Drag to control\n\t\t */\n\t\tvar _drag = {\n\t\t\tinProgress: false,\n\t\t\tstartPoint: null,\n\t\t\tstartTemperature: 0,\n\t\t\tlockAxis: undefined\n\t\t};\n\t\t\n\t\tfunction eventPosition(ev) {\n\t\t\tif (ev.targetTouches && ev.targetTouches.length) {\n\t\t\t\treturn  [ev.targetTouches[0].clientX, ev.targetTouches[0].clientY];\n\t\t\t} else {\n\t\t\t\treturn [ev.x, ev.y];\n\t\t\t};\n\t\t}\n\t\t\n\t\tvar startDelay;\n\t\tfunction dragStart(ev) {\n\t\t\tstartDelay = setTimeout(function() {\n\t\t\t\tsetClass(svg, 'dial--edit', true);\n\t\t\t\t_drag.inProgress = true;\n\t\t\t\t_drag.startPoint = eventPosition(ev);\n\t\t\t\t_drag.startTemperature = self.ambient_temperature || options.minValue;\n\t\t\t\t_drag.lockAxis = undefined;\n\t\t\t},1000);\n\t\t};\n\t\t\n\t\tfunction dragEnd (ev) {\n\t\t\tclearTimeout(startDelay);\n\t\t\tsetClass(svg, 'dial--edit', false);\n\t\t\tif (!_drag.inProgress) return;\n\t\t\t_drag.inProgress = false;\n\t\t\tif (self.ambient_temperature != _drag.startTemperature) {\n\t\t\t\tif (typeof options.onSetTargetTemperature == 'function') {\n\t\t\t\t\toptions.onSetTargetTemperature(self.ambient_temperature);\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t\t\n\t\tfunction dragMove(ev) {\n\t\t\tev.preventDefault();\n\t\t\tif (!_drag.inProgress) return;\n\t\t\tvar evPos =  eventPosition(ev);\n\t\t\tvar dy = _drag.startPoint[1]-evPos[1];\n\t\t\tvar dx = evPos[0] - _drag.startPoint[0];\n\t\t\tvar dxy;\n\t\t\tif (_drag.lockAxis == 'x') {\n\t\t\t\tdxy  = dx;\n\t\t\t} else if (_drag.lockAxis == 'y') {\n\t\t\t\tdxy = dy;\n\t\t\t} else if (Math.abs(dy) > properties.dragLockAxisDistance) {\n\t\t\t\t_drag.lockAxis = 'y';\n\t\t\t\tdxy = dy;\n\t\t\t} else if (Math.abs(dx) > properties.dragLockAxisDistance) {\n\t\t\t\t_drag.lockAxis = 'x';\n\t\t\t\tdxy = dx;\n\t\t\t} else {\n\t\t\t\tdxy = (Math.abs(dy) > Math.abs(dx)) ? dy : dx;\n\t\t\t};\n\t\t\tvar dValue = (dxy*getSizeRatio())/(options.diameter)*properties.rangeValue;\n\t\t\tself.ambient_temperature = roundHalf(_drag.startTemperature+dValue);\n\t\t}\n\t\t\n\t\tsvg.addEventListener('mousedown',dragStart);\n\t\tsvg.addEventListener('touchstart',dragStart);\n\t\t\n\t\tsvg.addEventListener('mouseup',dragEnd);\n\t\tsvg.addEventListener('mouseleave',dragEnd);\n\t\tsvg.addEventListener('touchend',dragEnd);\n\t\t\n\t\tsvg.addEventListener('mousemove',dragMove);\n\t\tsvg.addEventListener('touchmove',dragMove);\n\t\t//\n\t\t\n\t\t/*\n\t\t * Helper functions\n\t\t */\n\t\tfunction restrictTargetTemperature(t) {\n\t\t\treturn restrictToRange(roundHalf(t),options.minValue,options.maxValue);\n\t\t}\n\t\t\n\t\tfunction angle(point) {\n\t\t\tvar dx = point[0] - properties.radius;\n\t\t\tvar dy = point[1] - properties.radius;\n\t\t\tvar theta = Math.atan(dx/dy) / (Math.PI/180);\n\t\t\tif (point[0]>=properties.radius && point[1] < properties.radius) {\n\t\t\t\ttheta = 90-theta - 90;\n\t\t\t} else if (point[0]>=properties.radius && point[1] >= properties.radius) {\n\t\t\t\ttheta = 90-theta + 90;\n\t\t\t} else if (point[0]<properties.radius && point[1] >= properties.radius) {\n\t\t\t\ttheta = 90-theta + 90;\n\t\t\t} else if (point[0]<properties.radius && point[1] < properties.radius) {\n\t\t\t\ttheta = 90-theta+270;\n\t\t\t}\n\t\t\treturn theta;\n\t\t};\n\t\t\n\t\tfunction getSizeRatio() {\n\t\t\treturn options.diameter / targetElement.clientWidth;\n\t\t}\n\t\t\n\t};\n})();\n\n/* ==== */\n(function(scope) {\n    \n    var nest = new thermostatDial(document.getElementById('thermostat2'),{\n    \tonSetTargetTemperature: function(v) {\n    \t\tscope.send({topic: \"target_temperature\", payload: v});\n    \t}\n    });\n\n\n    scope.$watch('msg', function(data) {\n        //console.log(data.topic+\"  \"+data.payload);\n            nest.ambient_temperature = data.payload.temperature;\n            nest.target_temperature = data.payload.setpoint;\n            nest.hvac_state = data.payload.state;\n            nest.has_leaf = data.payload.leaf;\n            nest.away = data.payload.away;\n    });\n})(scope);\n\n</script>","storeOutMessages":true,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":550,"y":2600,"wires":[[]]},{"id":"e24fad62.8fe04","type":"ui_template","z":"e2e5a56.78da658","group":"18f2a4b1.a31edb","name":"Alarms","order":6,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: left;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EEEEEE;\"\n            ng-style=\"{background: msg.payload == '1' ? '#E65100' : '#EEEEEE'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":560,"y":2640,"wires":[[]]},{"id":"51a418cf.8b3de8","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nvar temperature;    // 0-100\nvar setpoint;       // 0-100\nvar gwState;        // \"heating\", \"cooling\"\nvar leaf;\nvar away = flow.get(\"enabled2\") || 0;\nvar _output = {};\n\n\n//if(payload.G1.STS.O_PV===1){gwState = \"cooling\";}\nif(payload.G1.STS.O_AC===1){\n    gwState = \"heating\";\n} else {\n    gwState = \"off\";\n}\n\ntemperature = parseInt(payload.G1.T.G);\n\nif (gwState == \"heating\")\n{\n    setpoint = parseInt(payload.G1.SET.S.ACT);\n}\nelse if(gwState == \"cooling\")\n{\n    setpoint = parseInt(payload.G1.SET.S.PVT);\n}\n\nleaf = 0;\n//away = 0;   // holiday mode\n\nvar output\t= [];\n\nvar _output = {\n        \"payload\": {\n\t\t\t\t    \"temperature\":setpoint,\n\t\t\t\t    \"setpoint\":temperature,\n\t\t\t\t    \"state\":gwState,\n\t\t\t\t    \"leaf\":leaf,\n\t\t\t\t    \"away\":away\n        }\n};\noutput = [\n\t\t\t_output\n\t\t];\nnode.status({text:gwState});\nreturn output;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":2600,"wires":[["d485dff4.3d3d6"]]},{"id":"c000dae8.166c78","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nvar alarms;\n\nif(payload.G1.STS.Tr_Th==1 || payload.G1.STS.Tr_Te==1 || payload.G1.STS.Tr_DR==1 || payload.G1.STS.A_Sc==1 || payload.G1.STS.A_An==1 || payload.G1.STS.A_DT==1)\n{\n    if(payload.G1.STS.Tr_Th==1){alarms=\"Over Temperature\"}\n    if(payload.G1.STS.Tr_Te==1){alarms=\"Low Temperature\"}\n    if(payload.G1.STS.Tr_DR==1){alarms=\"Dry Burn Alarm\"}\n//    if(payload.G1.STS.Tr_CS==1){alarms=\"Contactor Fault\"}\n    if(payload.G1.STS.A_Sc==1){alarms=\"Scale Build-up\"}\n    if(payload.G1.STS.A_An==1){alarms=\"Anode Depletion Alarm\"}\n    if(payload.G1.STS.A_DT==1){alarms=\"Driptray Water Alarm\"}\n}\nelse\n{\n    alarms = \"None\";\n}\n\nmsg.text = \"Alarms: <b>\"+alarms+\"</b>\";\nif(alarms != \"None\")\n{\n    msg.payload = \"1\";\n}\nelse\n{\n    msg.payload = \"0\";\n}\nflow.set(\"status\", alarms);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":2640,"wires":[["e24fad62.8fe04"]]},{"id":"e47a64eb.d961d8","type":"mqtt out","z":"e2e5a56.78da658","name":"Reset Alarms","topic":"GWR/gw86840D8E970C2B/1/STS","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":730,"y":2680,"wires":[]},{"id":"2fbfba18.5a6c76","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"A\":{\n    \t\t\t\t    \"Tr_DR\": \"\",\n    \t\t\t\t    \"A_Sc\": \"\",\n    \t\t\t\t    \"A_An\": \"\",\n    \t\t\t\t    \"A_DT\": \"\"\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":410,"y":2680,"wires":[["e47a64eb.d961d8"]]},{"id":"5f20f12a.6b738","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"18f2a4b1.a31edb","order":7,"width":"0","height":"0","passthru":false,"label":"Reset","tooltip":"","color":"","bgcolor":"grey","icon":"","payload":"","payloadType":"str","topic":"","x":270,"y":2680,"wires":[["2fbfba18.5a6c76"]]},{"id":"68ea8ed.1d2867","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.data;\nvar press = parseInt(payload.G1.I.AC);\nmsg.payload = press.toFixed(1);\nmsg.topic = \"Pressure G1\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":2620,"wires":[[]]},{"id":"6bdbec93.c35364","type":"ui_template","z":"e2e5a56.78da658","group":"4114e5fc.68ae5c","name":"Status","order":13,"width":"3","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\n                \"{background: msg.payload == '1' ? 'green' : 'red'}\"\n            ng-bind-html=\n                \"msg.topic\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":550,"y":2700,"wires":[[]]},{"id":"be9e73c6.e6746","type":"function","z":"e2e5a56.78da658","name":"Online","func":"var unit = flow.get(\"unit2\");\nvar payload = global.get(\"_geyserTestData_\"+unit)||0;\nvar date = payload.CS.t.Y + \"/\" + payload.CS.t.M + \"/\" + payload.CS.t.D;\nvar time = payload.CS.t.h + \":\" + payload.CS.t.m + \":\" + payload.CS.t.s;\nmsg.payload = payload.CS.S;\nmsg.topic = unit + \" \" + date + \" \" + time;\nnode.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":2700,"wires":[["6bdbec93.c35364"]]},{"id":"798388df.052a78","type":"comment","z":"e2e5a56.78da658","name":"Settings 2","info":"","x":100,"y":2760,"wires":[]},{"id":"5110fb1.9d78b04","type":"function","z":"e2e5a56.78da658","name":"ACM","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACM\");\nif(n===true)\n{\n    msg.payload = msg.payload.O.ACM;\n    msg.text = \"AC Control\"    ;\n    node.status({text:msg.payload});\n    msg.topic = \"AC\";\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":530,"y":2800,"wires":[["5f13b86b.41ab88","1a229bc6.647674"]]},{"id":"3d4b4284.76abfe","type":"function","z":"e2e5a56.78da658","name":"ACO","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACO\");\nif(n===true)\n{\n    msg.payload = msg.payload.O.ACO;\n    msg.text = \"Boost\"\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":530,"y":2840,"wires":[["907f854.7df9c78","455119ca.41faa8"]]},{"id":"1594025c.87128e","type":"function","z":"e2e5a56.78da658","name":"ACT","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACT\");\nif(n===true)\n{\n    msg.payload = msg.payload.S.ACT;\n    node.status({text:msg.payload});\n    msg.topic = \"setpoint\";\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":530,"y":2880,"wires":[["6b718e5c.6ff11"]]},{"id":"7fd7d0ae.91306","type":"function","z":"e2e5a56.78da658","name":"ACOT","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACOT\");\nif(n===true)\n{\n    msg.payload = msg.payload.S.ACOT;\n    node.status({text:msg.payload});\n    msg.topic = \"setpoint\";\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":530,"y":2920,"wires":[["bbb07728.1cb218"]]},{"id":"5f13b86b.41ab88","type":"ui_template","z":"e2e5a56.78da658","group":"6bd21555.60f0fc","name":"Status","order":2,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'Orange' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":650,"y":2800,"wires":[[]]},{"id":"907f854.7df9c78","type":"ui_template","z":"e2e5a56.78da658","group":"6bd21555.60f0fc","name":"Status","order":3,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: white;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: grey;\"\n            ng-style=\"{background: msg.payload == '1' ? 'Orange' : 'grey'}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":650,"y":2840,"wires":[[]]},{"id":"c00c472c.704be8","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":390,"y":2800,"wires":[["5110fb1.9d78b04","3d4b4284.76abfe","1594025c.87128e","7fd7d0ae.91306","fcc08704.0f81e8","bc65016b.cbe75","fb49b78a.0ccc68"]]},{"id":"6a074d46.af25c4","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Values","topic":"GWR/gw86840D8E970C2B/1/SET","qos":"0","retain":"false","broker":"3affe27c.33f30e","x":1110,"y":2800,"wires":[]},{"id":"2c9b510d.f3819e","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"S\":{\n    \t\t\t\t    \"ACT\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nreturn output;","outputs":1,"noerr":0,"x":940,"y":2880,"wires":[["6a074d46.af25c4"]]},{"id":"6b718e5c.6ff11","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"AC Setpoint","tooltip":"","group":"6bd21555.60f0fc","order":8,"width":"0","height":"0","passthru":false,"mode":"number","delay":"0","topic":"","x":790,"y":2880,"wires":[["2c9b510d.f3819e"]]},{"id":"432ddc0a.4b1384","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"S\":{\n    \t\t\t\t    \"ACOT\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\n\nreturn output;","outputs":1,"noerr":0,"x":940,"y":2920,"wires":[["6a074d46.af25c4"]]},{"id":"bbb07728.1cb218","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Boost Setpoint","tooltip":"","group":"6bd21555.60f0fc","order":9,"width":"0","height":"0","passthru":false,"mode":"number","delay":"0","topic":"","x":780,"y":2920,"wires":[["432ddc0a.4b1384"]]},{"id":"1a229bc6.647674","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"AC Control","tooltip":"","group":"6bd21555.60f0fc","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":790,"y":2800,"wires":[["29528eed.18f402"]]},{"id":"455119ca.41faa8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"AC Override","tooltip":"","group":"6bd21555.60f0fc","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":790,"y":2840,"wires":[["8ba73dcf.bd928"]]},{"id":"29528eed.18f402","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"O\":{\n    \t\t\t\t    \"ACM\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nnode.status({text:msg.payload});\nreturn output;","outputs":1,"noerr":0,"x":940,"y":2800,"wires":[["6a074d46.af25c4"]]},{"id":"8ba73dcf.bd928","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload = msg.payload;\nvar output\t= [];\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"O\":{\n    \t\t\t\t    \"ACO\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nreturn output;","outputs":1,"noerr":0,"x":940,"y":2840,"wires":[["6a074d46.af25c4"]]},{"id":"f561a4af.332bf8","type":"ui_template","z":"e2e5a56.78da658","group":"6bd21555.60f0fc","name":"Title","order":1,"width":"4","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: #273746;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0px;\n                border-radius: 6px;\n                background-color: #EAECEE;\"\n            ng-style=\"{background: #EAECEE}\"\n            ng-bind-html=\"msg.text\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":930,"y":2760,"wires":[[]]},{"id":"fcc08704.0f81e8","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload=1\nmsg.text = \"Geyser 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":2760,"wires":[["f561a4af.332bf8"]]},{"id":"bc65016b.cbe75","type":"function","z":"e2e5a56.78da658","name":"ACCT","func":"var str = JSON.stringify(msg.payload);\nvar n = str.includes(\"ACCT\");\nif(n===true)\n{\n    msg.payload = msg.payload.S.ACCT;\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\n    return null\n}\n","outputs":1,"noerr":0,"x":530,"y":2960,"wires":[["9c4605ba.2b0148"]]},{"id":"9c4605ba.2b0148","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Comfort Setpoint","tooltip":"","group":"6bd21555.60f0fc","order":11,"width":"0","height":"0","passthru":false,"mode":"number","delay":"0","topic":"","x":770,"y":2960,"wires":[["510928e3.036ed8"]]},{"id":"510928e3.036ed8","type":"function","z":"e2e5a56.78da658","name":"","func":"var payload;\nvar unit = flow.get(\"unit\");\nvar output\t= [];\nif(msg.payload > 70)    // limit to 70\n{\n    payload = 70;\n}\nelse\n{\n    payload = msg.payload;\n}\n\nvar setpoint = {\n        \"payload\": {\n\t\t\t\t    \"S\":{\n    \t\t\t\t    \"ACCT\": payload\n    \t\t\t\t}\n        }\n};\n\t\t//-----------------------------------------------------------------------------------------\n\noutput\t=\t[\n\t\t\t\tsetpoint\n\t\t\t];\nreturn output;","outputs":1,"noerr":0,"x":940,"y":2960,"wires":[["6a074d46.af25c4"]]},{"id":"6f448b44.a83cc4","type":"mqtt in","z":"e2e5a56.78da658","name":"Set 1","topic":"GW/gw86840D8E970C2B/1/SET","qos":"0","datatype":"auto","broker":"3affe27c.33f30e","x":90,"y":2800,"wires":[["87d57628.282c28"]]},{"id":"fb49b78a.0ccc68","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":540,"y":2760,"wires":[]},{"id":"87d57628.282c28","type":"deduplicate","z":"e2e5a56.78da658","name":"","registryclass":"","noderole":"standalone","expiry":5,"x":250,"y":2800,"wires":[["c00c472c.704be8"],[]]},{"id":"e9899fc4.ed2df","type":"inject","z":"e2e5a56.78da658","name":"Clear","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[]","payloadType":"json","x":1070,"y":80,"wires":[["3af9b979.33cfb6"]]},{"id":"3af9b979.33cfb6","type":"function","z":"e2e5a56.78da658","name":"Global Var","func":"global.set(\"_geyserTestData_gw6A68C63ADAD23A\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":80,"wires":[["3c6705de.f22e9a"]]},{"id":"3c6705de.f22e9a","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1370,"y":80,"wires":[]},{"id":"5fa488b3.14ca18","type":"inject","z":"e2e5a56.78da658","name":"Set Default","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"SN\":\"gw6A68C63ADAD23A\",\"CS\":{\"S\":1,\"I\":1,\"t\":{\"Y\":\"2019\",\"M\":\"08\",\"D\":\"19\",\"h\":\"12\",\"m\":\"42\",\"s\":\"17\"}},\"A\":false,\"AVG\":false,\"G1\":{\"T\":{\"PCB\":0,\"G\":0},\"I\":{\"AC\":0,\"PV\":0},\"V\":{\"AC\":0,\"PV\":0},\"Pt\":{\"Raw\":{\"I2AC\":0,\"I2PV\":0},\"kWh\":{\"AC\":0,\"PV\":0}},\"STS\":{\"Tr_Th\":0,\"Tr_Te\":0,\"Tr_DR\":0,\"Tr_CS\":0,\"Tr_PCB\":0,\"A_Sc\":0,\"A_An\":0,\"A_DT\":0,\"O_AC\":0,\"O_PV\":0,\"T\":0,\"H\":0},\"SET\":{\"O\":{\"ACM\":0,\"ACO\":0,\"PVM\":0},\"S\":{\"ACT\":0,\"ACOT\":0,\"PVT\":0,\"ACCT\":0},\"A\":{\"DRT\":10,\"SCB\":0}}},\"G2\":{\"T\":{\"PCB\":0,\"G\":0},\"I\":{\"AC\":0,\"PV\":0},\"V\":{\"AC\":0,\"PV\":0},\"Pt\":{\"Raw\":{\"I2AC\":0,\"I2PV\":0},\"kWh\":{\"AC\":0,\"PV\":0}},\"STS\":{\"Tr_Th\":0,\"Tr_Te\":0,\"Tr_DR\":0,\"Tr_CS\":0,\"Tr_PCB\":0,\"A_Sc\":0,\"A_An\":0,\"A_DT\":0,\"O_AC\":0,\"O_PV\":0,\"T\":0,\"H\":0},\"SET\":{\"O\":{\"ACM\":0,\"ACO\":0,\"PVM\":0},\"S\":{\"ACT\":0,\"ACOT\":0,\"PVT\":0,\"ACCT\":0},\"A\":{\"DRT\":0,\"SCB\":0}}}}","payloadType":"json","x":1060,"y":120,"wires":[["3af9b979.33cfb6"]]},{"id":"814e5069.3d8fb","type":"inject","z":"e2e5a56.78da658","name":"Clear","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[]","payloadType":"json","x":1550,"y":80,"wires":[["65556794.41ea78"]]},{"id":"65556794.41ea78","type":"function","z":"e2e5a56.78da658","name":"Global Var","func":"global.set(\"_geyserTestData_gw86840D8E970C2B\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":80,"wires":[["ee97e215.2ab81"]]},{"id":"ee97e215.2ab81","type":"debug","z":"e2e5a56.78da658","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1850,"y":80,"wires":[]},{"id":"feb5309.433b4d","type":"inject","z":"e2e5a56.78da658","name":"Set Default","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"SN\":\"gw86840D8E970C2B\",\"CS\":{\"S\":1,\"I\":1,\"t\":{\"Y\":\"2019\",\"M\":\"08\",\"D\":\"19\",\"h\":\"12\",\"m\":\"42\",\"s\":\"17\"}},\"A\":false,\"AVG\":false,\"G1\":{\"T\":{\"PCB\":0,\"G\":0},\"I\":{\"AC\":0,\"PV\":0},\"V\":{\"AC\":0,\"PV\":0},\"Pt\":{\"Raw\":{\"I2AC\":0,\"I2PV\":0},\"kWh\":{\"AC\":0,\"PV\":0}},\"STS\":{\"Tr_Th\":0,\"Tr_Te\":0,\"Tr_DR\":0,\"Tr_CS\":0,\"Tr_PCB\":0,\"A_Sc\":0,\"A_An\":0,\"A_DT\":0,\"O_AC\":0,\"O_PV\":0,\"T\":0,\"H\":0},\"SET\":{\"O\":{\"ACM\":0,\"ACO\":0,\"PVM\":0},\"S\":{\"ACT\":0,\"ACOT\":0,\"PVT\":0,\"ACCT\":0},\"A\":{\"DRT\":10,\"SCB\":0}}},\"G2\":{\"T\":{\"PCB\":0,\"G\":0},\"I\":{\"AC\":0,\"PV\":0},\"V\":{\"AC\":0,\"PV\":0},\"Pt\":{\"Raw\":{\"I2AC\":0,\"I2PV\":0},\"kWh\":{\"AC\":0,\"PV\":0}},\"STS\":{\"Tr_Th\":0,\"Tr_Te\":0,\"Tr_DR\":0,\"Tr_CS\":0,\"Tr_PCB\":0,\"A_Sc\":0,\"A_An\":0,\"A_DT\":0,\"O_AC\":0,\"O_PV\":0,\"T\":0,\"H\":0},\"SET\":{\"O\":{\"ACM\":0,\"ACO\":0,\"PVM\":0},\"S\":{\"ACT\":0,\"ACOT\":0,\"PVT\":0,\"ACCT\":0},\"A\":{\"DRT\":0,\"SCB\":0}}}}","payloadType":"json","x":1540,"y":120,"wires":[["65556794.41ea78"]]},{"id":"9b53059c.937d18","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Enable","tooltip":"","group":"ed002fb6.acad4","order":2,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"T1Enable","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":300,"y":1660,"wires":[["9dbbde2f.35c01"]]},{"id":"acd62a6e.fe0368","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Mo","tooltip":"","group":"ed002fb6.acad4","order":7,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Mon","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1680,"wires":[["9dbbde2f.35c01"]]},{"id":"974e7341.ff404","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Tu","tooltip":"","group":"ed002fb6.acad4","order":8,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Tue","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1700,"wires":[["9dbbde2f.35c01"]]},{"id":"7d14508d.9b144","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"We","tooltip":"","group":"ed002fb6.acad4","order":9,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Wed","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1720,"wires":[["9dbbde2f.35c01"]]},{"id":"c9567046.4ef7","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Th","tooltip":"","group":"ed002fb6.acad4","order":10,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Thu","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1740,"wires":[["9dbbde2f.35c01"]]},{"id":"a893b039.fb021","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Fr","tooltip":"","group":"ed002fb6.acad4","order":11,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Fri","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1760,"wires":[["9dbbde2f.35c01"]]},{"id":"f9984730.c1d6b8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Sa","tooltip":"","group":"ed002fb6.acad4","order":12,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sat","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1780,"wires":[["9dbbde2f.35c01"]]},{"id":"1a650697.c34d39","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Su","tooltip":"","group":"ed002fb6.acad4","order":13,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sun","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":1800,"wires":[["9dbbde2f.35c01"]]},{"id":"389d29b7.8796a6","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"On","tooltip":"","group":"ed002fb6.acad4","order":3,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OnTime","x":290,"y":1820,"wires":[["9dbbde2f.35c01"]]},{"id":"b24f0f21.bc13d","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Off","tooltip":"","group":"ed002fb6.acad4","order":5,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OffTime","x":290,"y":1840,"wires":[["9dbbde2f.35c01"]]},{"id":"9dbbde2f.35c01","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nif(msg.topic == \"T1Enable\"){data.suspended = msg.payload;}\nvar hour, minute, Offhour, Offminute;\n\nif(msg.topic == \"T1Mon\"){data.mon = msg.payload;}\nif(msg.topic == \"T1Tue\"){data.tue = msg.payload;}\nif(msg.topic == \"T1Wed\"){data.wed = msg.payload;}\nif(msg.topic == \"T1Thu\"){data.thu = msg.payload;}\nif(msg.topic == \"T1Fri\"){data.fri = msg.payload;}\nif(msg.topic == \"T1Sat\"){data.sat = msg.payload;}\nif(msg.topic == \"T1Sun\"){data.sun = msg.payload;}\n\nif(msg.topic == \"T1OnTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        data.ontime = hour+':'+minute;\n    }else{\n        now     = new Date(msg.payload);\n        hour        = now.getHours()-2;\n        minute      = now.getMinutes();\n    \n        if(hour.toString().length == 1) {hour = '0'+hour;}\n        if(minute.toString().length == 1) {minute = '0'+minute;}\n    \n        data.ontime = hour+':'+minute;\n    }\n}\nif(msg.topic == \"T1OffTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        \n        data.ontime = hour+':'+minute;\n    }else{\n    var Offnow  = new Date(msg.payload);\n    Offhour     = Offnow.getHours()-2;\n    Offminute   = Offnow.getMinutes();\n\n    if(Offhour.toString().length == 1) {Offhour = '0'+Offhour;}\n    if(Offminute.toString().length == 1) {Offminute = '0'+Offminute;}\n\n    data.offtime = Offhour+':'+Offminute;\n    }\n}\nflow.set(\"G1Timer1\", data);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\nmsg.topic = \"GWR/\"+flow.get(\"unit\")+\"/1/Time/1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1660,"wires":[[]]},{"id":"b59b0535.29ecb8","type":"mqtt in","z":"e2e5a56.78da658","name":"","topic":"GW/gw6A68C63ADAD23A/1/Time/1","qos":"0","datatype":"auto","broker":"4c7fd38d.23f35c","x":180,"y":1600,"wires":[["4061859.49a8d7c"]]},{"id":"4061859.49a8d7c","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":410,"y":1600,"wires":[["da769139.b8fd9"]]},{"id":"cf397afd.794538","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nvar payload = msg.payload;\nvar startHour, startMin, endHour, endMin;\nvar onTime;\nvar offTime;\n\nif ('C' in payload){data.suspended = payload.C}\n\nif ('S' in payload){\n    if ('h' in msg.payload.S){\n        startHour = payload.S.h;\n        if(startHour.toString().length == 1) {startHour = '0'+startHour;}\n    }\n    if ('m' in msg.payload.S){\n        startMin = msg.payload.S.m;\n        if(startMin.toString().length == 1) {startMin = '0'+startMin;}\n    }\n    data.ontime = startHour+\":\"+startMin;\n}\n\nif ('E' in msg.payload){\n    if ('h' in msg.payload.E){\n        endHour = msg.payload.E.h;\n        if(endHour.toString().length == 1) {endHour = '0'+endHour;}\n    }\n    if ('m' in msg.payload.E){\n        endMin = msg.payload.E.m;\n        if(endMin.toString().length == 1) {endMin = '0'+endMin;}\n    }\n    data.offtime = endHour+\":\"+endMin;\n}\n\nif ('W' in msg.payload){\n    data.mon = msg.payload.W.Mo;\n    data.tue = msg.payload.W.Tu;\n    data.wed = msg.payload.W.We;\n    data.thu = msg.payload.W.Th;\n    data.fri = msg.payload.W.Fr;\n    data.sat = msg.payload.W.Sa;\n    data.sun = msg.payload.W.Su;\n}\nmsg.payload = data;\nflow.set(\"G1Timer1\",data);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1600,"wires":[["9154a8fd.4c7048"]]},{"id":"d9d24226.00b81","type":"mqtt out","z":"e2e5a56.78da658","name":"GET Timer 1","topic":"GWA/gw2E2C3AE83E8539/1/Time/1","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":650,"y":1840,"wires":[]},{"id":"af89a773.15a028","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Timer 1","topic":"","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":650,"y":1800,"wires":[]},{"id":"e936af3e.f1ac2","type":"inject","z":"e2e5a56.78da658","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":450,"y":1840,"wires":[["d9d24226.00b81","267f23e9.d4e90c","e22c73bb.b3d12"]]},{"id":"da769139.b8fd9","type":"deduplicate","z":"e2e5a56.78da658","name":"","keyproperty":"","expiry":"2","x":550,"y":1600,"wires":[["cf397afd.794538","ea79b60f.866ef8"],[]]},{"id":"6f0bdab9.28ee74","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Enable","tooltip":"","group":"d25fc923.9b55b8","order":2,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"T1Enable","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1100,"y":1660,"wires":[["abf11aab.01c488"]]},{"id":"998c245a.48dec8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Mo","tooltip":"","group":"d25fc923.9b55b8","order":7,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Mon","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1680,"wires":[["abf11aab.01c488"]]},{"id":"c32d93f7.86132","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Tu","tooltip":"","group":"d25fc923.9b55b8","order":8,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Tue","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1700,"wires":[["abf11aab.01c488"]]},{"id":"2c4ce939.ea3446","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"We","tooltip":"","group":"d25fc923.9b55b8","order":9,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Wed","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1720,"wires":[["abf11aab.01c488"]]},{"id":"1e992de4.d1a7f2","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Th","tooltip":"","group":"d25fc923.9b55b8","order":10,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Thu","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1740,"wires":[["abf11aab.01c488"]]},{"id":"c68435e8.dd4c78","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Fr","tooltip":"","group":"d25fc923.9b55b8","order":11,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Fri","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1760,"wires":[["abf11aab.01c488"]]},{"id":"71383752.d94e88","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Sa","tooltip":"","group":"d25fc923.9b55b8","order":12,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sat","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1780,"wires":[["abf11aab.01c488"]]},{"id":"f3262a89.41c1b8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Su","tooltip":"","group":"d25fc923.9b55b8","order":13,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sun","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":1800,"wires":[["abf11aab.01c488"]]},{"id":"62c9309.5f732d","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"On","tooltip":"","group":"d25fc923.9b55b8","order":3,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OnTime","x":1090,"y":1820,"wires":[["abf11aab.01c488"]]},{"id":"f88b2c1b.0b53","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Off","tooltip":"","group":"d25fc923.9b55b8","order":5,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OffTime","x":1090,"y":1840,"wires":[["abf11aab.01c488"]]},{"id":"abf11aab.01c488","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nif(msg.topic == \"T1Enable\"){data.suspended = msg.payload;}\nvar hour, minute, Offhour, Offminute;\n\nif(msg.topic == \"T1Mon\"){data.mon = msg.payload;}\nif(msg.topic == \"T1Tue\"){data.tue = msg.payload;}\nif(msg.topic == \"T1Wed\"){data.wed = msg.payload;}\nif(msg.topic == \"T1Thu\"){data.thu = msg.payload;}\nif(msg.topic == \"T1Fri\"){data.fri = msg.payload;}\nif(msg.topic == \"T1Sat\"){data.sat = msg.payload;}\nif(msg.topic == \"T1Sun\"){data.sun = msg.payload;}\n\nif(msg.topic == \"T1OnTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        data.ontime = hour+':'+minute;\n    }else{\n        now     = new Date(msg.payload);\n        hour        = now.getHours()-2;\n        minute      = now.getMinutes();\n    \n        if(hour.toString().length == 1) {hour = '0'+hour;}\n        if(minute.toString().length == 1) {minute = '0'+minute;}\n    \n        data.ontime = hour+':'+minute;\n    }\n}\nif(msg.topic == \"T1OffTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        \n        data.ontime = hour+':'+minute;\n    }else{\n    var Offnow  = new Date(msg.payload);\n    Offhour     = Offnow.getHours()-2;\n    Offminute   = Offnow.getMinutes();\n\n    if(Offhour.toString().length == 1) {Offhour = '0'+Offhour;}\n    if(Offminute.toString().length == 1) {Offminute = '0'+Offminute;}\n\n    data.offtime = Offhour+':'+Offminute;\n    }\n}\nflow.set(\"G1Timer2\", data);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\nmsg.topic = \"GWR/\"+flow.get(\"unit\")+\"/1/Time/2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":1660,"wires":[[]]},{"id":"4411402f.92acd","type":"mqtt in","z":"e2e5a56.78da658","name":"","topic":"GW/gw6A68C63ADAD23A/1/Time/2","qos":"0","datatype":"auto","broker":"4c7fd38d.23f35c","x":980,"y":1600,"wires":[["1cc599e7.2ea366"]]},{"id":"1cc599e7.2ea366","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":1210,"y":1600,"wires":[["fcd971af.865b3"]]},{"id":"6b43c467.c31fbc","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nvar payload = msg.payload;\nvar startHour, startMin, endHour, endMin;\nvar onTime;\nvar offTime;\n\nif ('C' in payload){data.suspended = payload.C}\n\nif ('S' in payload){\n    if ('h' in msg.payload.S){\n        startHour = payload.S.h;\n        if(startHour.toString().length == 1) {startHour = '0'+startHour;}\n    }\n    if ('m' in msg.payload.S){\n        startMin = msg.payload.S.m;\n        if(startMin.toString().length == 1) {startMin = '0'+startMin;}\n    }\n    data.ontime = startHour+\":\"+startMin;\n}\n\nif ('E' in msg.payload){\n    if ('h' in msg.payload.E){\n        endHour = msg.payload.E.h;\n        if(endHour.toString().length == 1) {endHour = '0'+endHour;}\n    }\n    if ('m' in msg.payload.E){\n        endMin = msg.payload.E.m;\n        if(endMin.toString().length == 1) {endMin = '0'+endMin;}\n    }\n    data.offtime = endHour+\":\"+endMin;\n}\n\nif ('W' in msg.payload){\n    data.mon = msg.payload.W.Mo;\n    data.tue = msg.payload.W.Tu;\n    data.wed = msg.payload.W.We;\n    data.thu = msg.payload.W.Th;\n    data.fri = msg.payload.W.Fr;\n    data.sat = msg.payload.W.Sa;\n    data.sun = msg.payload.W.Su;\n}\nmsg.payload = data;\nflow.set(\"G1Timer2\",data);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":1600,"wires":[["71cb7148.07d61"]]},{"id":"ad804db4.5ed78","type":"mqtt out","z":"e2e5a56.78da658","name":"GET Timer 2","topic":"GWA/gw2E2C3AE83E8539/1/Time/2","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":1450,"y":1840,"wires":[]},{"id":"708c9f6d.2e5f4","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Timer 2","topic":"","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":1450,"y":1800,"wires":[]},{"id":"5b94610d.d6263","type":"inject","z":"e2e5a56.78da658","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1270,"y":1840,"wires":[["ad804db4.5ed78"]]},{"id":"fcd971af.865b3","type":"deduplicate","z":"e2e5a56.78da658","name":"","keyproperty":"","expiry":"2","x":1350,"y":1600,"wires":[["6b43c467.c31fbc"],[]]},{"id":"c93f64dd.1b1058","type":"inject","z":"e2e5a56.78da658","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"suspended\":1,\"mon\":1,\"tue\":1,\"wed\":1,\"thu\":1,\"fri\":1,\"sat\":1,\"sun\":1,\"ontime\":\"06:00\",\"offtime\":\"07:00\",\"status\":0}","payloadType":"json","x":110,"y":1500,"wires":[["3d6e7211.d38cce","c118026a.d1c5","6b07412f.77977","586e0be5.89cd54"]]},{"id":"3d6e7211.d38cce","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G1Timer2\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1520,"wires":[[]]},{"id":"c118026a.d1c5","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G1Timer3\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1540,"wires":[[]]},{"id":"6b07412f.77977","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G1Timer4\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1560,"wires":[[]]},{"id":"586e0be5.89cd54","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G1Timer1\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1500,"wires":[[]]},{"id":"5ad0dad4.184294","type":"inject","z":"e2e5a56.78da658","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"suspended\":1,\"mon\":1,\"tue\":1,\"wed\":1,\"thu\":1,\"fri\":1,\"sat\":1,\"sun\":1,\"ontime\":\"06:00\",\"offtime\":\"07:00\",\"status\":0}","payloadType":"json","x":570,"y":1500,"wires":[["5e07c0ba.1419c","7ba03cff.72a994","e8823f9a.631fe","5438b2d.be4034c"]]},{"id":"5e07c0ba.1419c","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G2Timer2\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1520,"wires":[[]]},{"id":"7ba03cff.72a994","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G2Timer3\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1540,"wires":[[]]},{"id":"e8823f9a.631fe","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G2Timer4\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1560,"wires":[[]]},{"id":"5438b2d.be4034c","type":"function","z":"e2e5a56.78da658","name":"","func":"flow.set(\"G2Timer1\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1500,"wires":[[]]},{"id":"ea79b60f.866ef8","type":"debug","z":"e2e5a56.78da658","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":550,"y":1580,"wires":[]},{"id":"9154a8fd.4c7048","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.data = msg.payload;\nmsg.payload = msg.data.suspended;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1660,"wires":[["692eb024.9df81","9b53059c.937d18"]]},{"id":"692eb024.9df81","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.mon;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1680,"wires":[["ff503c0e.5561a","acd62a6e.fe0368"]]},{"id":"ff503c0e.5561a","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.tue;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1700,"wires":[["348b4f3e.cac3e","974e7341.ff404"]]},{"id":"55248187.5f68d","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.thu;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1740,"wires":[["b466ed6.c7daf1","c9567046.4ef7"]]},{"id":"348b4f3e.cac3e","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.wed;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1720,"wires":[["55248187.5f68d","7d14508d.9b144"]]},{"id":"b466ed6.c7daf1","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.fri;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1760,"wires":[["cfcc87e0.33a748","a893b039.fb021"]]},{"id":"cfcc87e0.33a748","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sat;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1780,"wires":[["dbf1e23f.1ae11","f9984730.c1d6b8"]]},{"id":"dbf1e23f.1ae11","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sun;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1800,"wires":[["53b1be8f.c5f13","1a650697.c34d39"]]},{"id":"53b1be8f.c5f13","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1820,"wires":[["81c67613.8b16a8","389d29b7.8796a6"]]},{"id":"81c67613.8b16a8","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":1840,"wires":[["b24f0f21.bc13d"]]},{"id":"71cb7148.07d61","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.data = msg.payload;\nmsg.payload = msg.data.suspended;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1660,"wires":[["bf413c9e.d9466","6f0bdab9.28ee74"]]},{"id":"bf413c9e.d9466","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.mon;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1680,"wires":[["b20132f9.642f6","998c245a.48dec8"]]},{"id":"b20132f9.642f6","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.tue;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1700,"wires":[["77cdfc7e.08fda4","c32d93f7.86132"]]},{"id":"fb0c8fec.9e017","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.thu;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1740,"wires":[["58e153a8.e7eb2c","1e992de4.d1a7f2"]]},{"id":"77cdfc7e.08fda4","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.wed;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1720,"wires":[["fb0c8fec.9e017","2c4ce939.ea3446"]]},{"id":"58e153a8.e7eb2c","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.fri;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1760,"wires":[["41edc4de.410b4c","c68435e8.dd4c78"]]},{"id":"41edc4de.410b4c","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sat;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1780,"wires":[["bdb34149.c2021","71383752.d94e88"]]},{"id":"bdb34149.c2021","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sun;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1800,"wires":[["ae6310a4.cd735","f3262a89.41c1b8"]]},{"id":"ae6310a4.cd735","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1820,"wires":[["15d7c00c.f9588","62c9309.5f732d"]]},{"id":"15d7c00c.f9588","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1840,"wires":[["f88b2c1b.0b53"]]},{"id":"61361bb5.a3f764","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"ed002fb6.acad4","order":16,"width":"2","height":"1","passthru":false,"label":"Save","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":470,"y":1760,"wires":[["61fad82a.d47918"]]},{"id":"61fad82a.d47918","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nvar hour, minute, Offhour, Offminute;\n    hour        = data.ontime.substring(0, 2);\n    minute      = data.ontime.substring(3, 5);\n    Offhour     = data.offtime.substring(0, 2);\n    Offminute   = data.offtime.substring(3, 5);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\n// GWR/gw2E2C3AE83E8341/1/Time/1\nmsg.topic = \"GWR/\"+flow.get(\"unit\")+\"/1/Time/1\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1760,"wires":[["af89a773.15a028"]]},{"id":"cb9b4f96.e37d9","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"d25fc923.9b55b8","order":15,"width":"2","height":"1","passthru":false,"label":"Save","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":1270,"y":1760,"wires":[["1999b168.d74dff"]]},{"id":"1999b168.d74dff","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nvar hour, minute, Offhour, Offminute;\n    hour        = data.ontime.substring(0, 2);\n    minute      = data.ontime.substring(3, 5);\n    Offhour     = data.offtime.substring(0, 2);\n    Offminute   = data.offtime.substring(3, 5);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\n// GWR/gw2E2C3AE83E8341/1/Time/1\nmsg.topic = \"GWR/\"+flow.get(\"unit\")+\"/1/Time/2\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1440,"y":1760,"wires":[["708c9f6d.2e5f4"]]},{"id":"267f23e9.d4e90c","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nmsg.payload = data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":1720,"wires":[["798d28c5.955448"]]},{"id":"e22c73bb.b3d12","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nmsg.payload = data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":1700,"wires":[["f926267a.f10248"]]},{"id":"f926267a.f10248","type":"ui_template","z":"e2e5a56.78da658","group":"ed002fb6.acad4","name":"On","order":4,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":670,"y":1700,"wires":[[]]},{"id":"798d28c5.955448","type":"ui_template","z":"e2e5a56.78da658","group":"ed002fb6.acad4","name":"Off","order":6,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":670,"y":1720,"wires":[[]]},{"id":"b135f263.8c433","type":"ui_button","z":"e2e5a56.78da658","name":"Refresh","group":"ed002fb6.acad4","order":14,"width":"1","height":"1","passthru":false,"label":"","tooltip":"Refresh","color":"","bgcolor":"","icon":"fa-refresh","payload":"","payloadType":"str","topic":"","x":460,"y":1800,"wires":[["267f23e9.d4e90c","e22c73bb.b3d12"]]},{"id":"55aef93a.d6e0d8","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nmsg.payload = data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":1700,"wires":[["db95c1f9.85d7"]]},{"id":"728b9d2c.af3cb4","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nmsg.payload = data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":1720,"wires":[["32adb938.34b4f6"]]},{"id":"db95c1f9.85d7","type":"ui_template","z":"e2e5a56.78da658","group":"d25fc923.9b55b8","name":"On","order":4,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1470,"y":1700,"wires":[[]]},{"id":"32adb938.34b4f6","type":"ui_template","z":"e2e5a56.78da658","group":"d25fc923.9b55b8","name":"Off","order":6,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1470,"y":1720,"wires":[[]]},{"id":"1d2bebe9.0aa374","type":"ui_button","z":"e2e5a56.78da658","name":"Refresh","group":"d25fc923.9b55b8","order":14,"width":"1","height":"1","passthru":false,"label":"","tooltip":"Refresh","color":"","bgcolor":"","icon":"fa-refresh","payload":"","payloadType":"str","topic":"","x":1260,"y":1800,"wires":[["728b9d2c.af3cb4","55aef93a.d6e0d8"]]},{"id":"9b7a8a67.fe4368","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Enable","tooltip":"","group":"df7db292.36094","order":2,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"T1Enable","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":300,"y":3680,"wires":[["dbf300e7.95d28"]]},{"id":"b7edbc8d.9f99d","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Mo","tooltip":"","group":"df7db292.36094","order":7,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Mon","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3700,"wires":[["dbf300e7.95d28"]]},{"id":"ad742904.189ee8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Tu","tooltip":"","group":"df7db292.36094","order":8,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Tue","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3720,"wires":[["dbf300e7.95d28"]]},{"id":"fd31edcf.53b85","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"We","tooltip":"","group":"df7db292.36094","order":9,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Wed","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3740,"wires":[["dbf300e7.95d28"]]},{"id":"9522598b.3a4858","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Th","tooltip":"","group":"df7db292.36094","order":10,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Thu","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3760,"wires":[["dbf300e7.95d28"]]},{"id":"d8095160.5d98c","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Fr","tooltip":"","group":"df7db292.36094","order":11,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Fri","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3780,"wires":[["dbf300e7.95d28"]]},{"id":"7b08326c.cb300c","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Sa","tooltip":"","group":"df7db292.36094","order":12,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sat","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3800,"wires":[["dbf300e7.95d28"]]},{"id":"1fcf5d7a.7d1073","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Su","tooltip":"","group":"df7db292.36094","order":13,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sun","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":290,"y":3820,"wires":[["dbf300e7.95d28"]]},{"id":"dc229971.ef6568","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"On","tooltip":"","group":"df7db292.36094","order":3,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OnTime","x":290,"y":3840,"wires":[["dbf300e7.95d28"]]},{"id":"74692f6f.94ac1","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Off","tooltip":"","group":"df7db292.36094","order":5,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OffTime","x":290,"y":3860,"wires":[["dbf300e7.95d28"]]},{"id":"dbf300e7.95d28","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nif(msg.topic == \"T1Enable\"){data.suspended = msg.payload;}\nvar hour, minute, Offhour, Offminute;\n\nif(msg.topic == \"T1Mon\"){data.mon = msg.payload;}\nif(msg.topic == \"T1Tue\"){data.tue = msg.payload;}\nif(msg.topic == \"T1Wed\"){data.wed = msg.payload;}\nif(msg.topic == \"T1Thu\"){data.thu = msg.payload;}\nif(msg.topic == \"T1Fri\"){data.fri = msg.payload;}\nif(msg.topic == \"T1Sat\"){data.sat = msg.payload;}\nif(msg.topic == \"T1Sun\"){data.sun = msg.payload;}\n\nif(msg.topic == \"T1OnTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        data.ontime = hour+':'+minute;\n    }else{\n        now     = new Date(msg.payload);\n        hour        = now.getHours()-2;\n        minute      = now.getMinutes();\n    \n        if(hour.toString().length == 1) {hour = '0'+hour;}\n        if(minute.toString().length == 1) {minute = '0'+minute;}\n    \n        data.ontime = hour+':'+minute;\n    }\n}\nif(msg.topic == \"T1OffTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        \n        data.ontime = hour+':'+minute;\n    }else{\n    var Offnow  = new Date(msg.payload);\n    Offhour     = Offnow.getHours()-2;\n    Offminute   = Offnow.getMinutes();\n\n    if(Offhour.toString().length == 1) {Offhour = '0'+Offhour;}\n    if(Offminute.toString().length == 1) {Offminute = '0'+Offminute;}\n\n    data.offtime = Offhour+':'+Offminute;\n    }\n}\nflow.set(\"G1Timer1\", data);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\nmsg.topic = \"GWR/\"+flow.get(\"unit2\")+\"/1/Time/1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":3680,"wires":[[]]},{"id":"dcda6ce6.a34eb","type":"mqtt in","z":"e2e5a56.78da658","name":"","topic":"GW/gw86840D8E970C2B/1/Time/1","qos":"0","datatype":"auto","broker":"4c7fd38d.23f35c","x":180,"y":3620,"wires":[["7c5dfcf7.6cc8a4"]]},{"id":"7c5dfcf7.6cc8a4","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":410,"y":3620,"wires":[["802085e8.e12258"]]},{"id":"3abc6b35.3c9a84","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nvar payload = msg.payload;\nvar startHour, startMin, endHour, endMin;\nvar onTime;\nvar offTime;\n\nif ('C' in payload){data.suspended = payload.C}\n\nif ('S' in payload){\n    if ('h' in msg.payload.S){\n        startHour = payload.S.h;\n        if(startHour.toString().length == 1) {startHour = '0'+startHour;}\n    }\n    if ('m' in msg.payload.S){\n        startMin = msg.payload.S.m;\n        if(startMin.toString().length == 1) {startMin = '0'+startMin;}\n    }\n    data.ontime = startHour+\":\"+startMin;\n}\n\nif ('E' in msg.payload){\n    if ('h' in msg.payload.E){\n        endHour = msg.payload.E.h;\n        if(endHour.toString().length == 1) {endHour = '0'+endHour;}\n    }\n    if ('m' in msg.payload.E){\n        endMin = msg.payload.E.m;\n        if(endMin.toString().length == 1) {endMin = '0'+endMin;}\n    }\n    data.offtime = endHour+\":\"+endMin;\n}\n\nif ('W' in msg.payload){\n    data.mon = msg.payload.W.Mo;\n    data.tue = msg.payload.W.Tu;\n    data.wed = msg.payload.W.We;\n    data.thu = msg.payload.W.Th;\n    data.fri = msg.payload.W.Fr;\n    data.sat = msg.payload.W.Sa;\n    data.sun = msg.payload.W.Su;\n}\nmsg.payload = data;\nflow.set(\"G1Timer1\",data);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":3620,"wires":[["d5113155.cd78c"]]},{"id":"208daecd.b7a732","type":"mqtt out","z":"e2e5a56.78da658","name":"GET Timer 1","topic":"GWA/gw2E2C3AE83E8539/1/Time/1","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":650,"y":3860,"wires":[]},{"id":"baaf624.2ad29a","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Timer 1","topic":"","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":650,"y":3820,"wires":[]},{"id":"7fbae8a9.bb90b8","type":"inject","z":"e2e5a56.78da658","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":450,"y":3860,"wires":[["208daecd.b7a732","bb937045.26225","7b931662.5c7b08"]]},{"id":"802085e8.e12258","type":"deduplicate","z":"e2e5a56.78da658","name":"","keyproperty":"","expiry":"2","x":550,"y":3620,"wires":[["3abc6b35.3c9a84","b11a27d2.a67e28"],[]]},{"id":"2d5aada6.542362","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Enable","tooltip":"","group":"1307a7ee.564f58","order":2,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"T1Enable","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1100,"y":3680,"wires":[["be624a80.57e698"]]},{"id":"45fe8bd1.c3ebc4","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Mo","tooltip":"","group":"1307a7ee.564f58","order":7,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Mon","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3700,"wires":[["be624a80.57e698"]]},{"id":"20230491.ee0a3c","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Tu","tooltip":"","group":"1307a7ee.564f58","order":8,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Tue","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3720,"wires":[["be624a80.57e698"]]},{"id":"e3a7170d.11ae38","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"We","tooltip":"","group":"1307a7ee.564f58","order":9,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Wed","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3740,"wires":[["be624a80.57e698"]]},{"id":"63c57541.1e48cc","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Th","tooltip":"","group":"1307a7ee.564f58","order":10,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Thu","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3760,"wires":[["be624a80.57e698"]]},{"id":"9281b826.34b2c8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Fr","tooltip":"","group":"1307a7ee.564f58","order":11,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Fri","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3780,"wires":[["be624a80.57e698"]]},{"id":"46cf676f.d0d5a8","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Sa","tooltip":"","group":"1307a7ee.564f58","order":12,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sat","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3800,"wires":[["be624a80.57e698"]]},{"id":"fde1ce53.61148","type":"ui_switch","z":"e2e5a56.78da658","name":"","label":"Su","tooltip":"","group":"1307a7ee.564f58","order":13,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"T1Sun","style":"","onvalue":"1","onvalueType":"num","onicon":"fa-check-square-o","oncolor":"--nr-dashboard-widgetTextColor","offvalue":"0","offvalueType":"num","officon":"fa-square-o","offcolor":"--nr-dashboard-widgetTextColor","x":1090,"y":3820,"wires":[["be624a80.57e698"]]},{"id":"4cb441ef.e8b6b","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"On","tooltip":"","group":"1307a7ee.564f58","order":3,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OnTime","x":1090,"y":3840,"wires":[["be624a80.57e698"]]},{"id":"b2dd5007.5e30b","type":"ui_text_input","z":"e2e5a56.78da658","name":"","label":"Off","tooltip":"","group":"1307a7ee.564f58","order":5,"width":"3","height":"1","passthru":true,"mode":"time","delay":"0","topic":"T1OffTime","x":1090,"y":3860,"wires":[["be624a80.57e698"]]},{"id":"be624a80.57e698","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nif(msg.topic == \"T1Enable\"){data.suspended = msg.payload;}\nvar hour, minute, Offhour, Offminute;\n\nif(msg.topic == \"T1Mon\"){data.mon = msg.payload;}\nif(msg.topic == \"T1Tue\"){data.tue = msg.payload;}\nif(msg.topic == \"T1Wed\"){data.wed = msg.payload;}\nif(msg.topic == \"T1Thu\"){data.thu = msg.payload;}\nif(msg.topic == \"T1Fri\"){data.fri = msg.payload;}\nif(msg.topic == \"T1Sat\"){data.sat = msg.payload;}\nif(msg.topic == \"T1Sun\"){data.sun = msg.payload;}\n\nif(msg.topic == \"T1OnTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        data.ontime = hour+':'+minute;\n    }else{\n        now     = new Date(msg.payload);\n        hour        = now.getHours()-2;\n        minute      = now.getMinutes();\n    \n        if(hour.toString().length == 1) {hour = '0'+hour;}\n        if(minute.toString().length == 1) {minute = '0'+minute;}\n    \n        data.ontime = hour+':'+minute;\n    }\n}\nif(msg.topic == \"T1OffTime\"){\n    if((msg.payload == isNaN) || (msg.payload === null) || (msg.payload === \"\"))\n    {\n        hour        = data.ontime.substring(0, 2);\n        minute      = data.ontime.substring(3, 5);\n        \n        data.ontime = hour+':'+minute;\n    }else{\n    var Offnow  = new Date(msg.payload);\n    Offhour     = Offnow.getHours()-2;\n    Offminute   = Offnow.getMinutes();\n\n    if(Offhour.toString().length == 1) {Offhour = '0'+Offhour;}\n    if(Offminute.toString().length == 1) {Offminute = '0'+Offminute;}\n\n    data.offtime = Offhour+':'+Offminute;\n    }\n}\nflow.set(\"G1Timer2\", data);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\nmsg.topic = \"GWR/\"+flow.get(\"unit2\")+\"/1/Time/2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":3680,"wires":[[]]},{"id":"84444b12.726b78","type":"mqtt in","z":"e2e5a56.78da658","name":"","topic":"GW/gw86840D8E970C2B/1/Time/2","qos":"0","datatype":"auto","broker":"4c7fd38d.23f35c","x":980,"y":3620,"wires":[["6e588ea9.8ecb8"]]},{"id":"6e588ea9.8ecb8","type":"json","z":"e2e5a56.78da658","name":"","property":"payload","action":"","pretty":false,"x":1210,"y":3620,"wires":[["ceda6db3.15f3c"]]},{"id":"38bc8fa6.07c18","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nvar payload = msg.payload;\nvar startHour, startMin, endHour, endMin;\nvar onTime;\nvar offTime;\n\nif ('C' in payload){data.suspended = payload.C}\n\nif ('S' in payload){\n    if ('h' in msg.payload.S){\n        startHour = payload.S.h;\n        if(startHour.toString().length == 1) {startHour = '0'+startHour;}\n    }\n    if ('m' in msg.payload.S){\n        startMin = msg.payload.S.m;\n        if(startMin.toString().length == 1) {startMin = '0'+startMin;}\n    }\n    data.ontime = startHour+\":\"+startMin;\n}\n\nif ('E' in msg.payload){\n    if ('h' in msg.payload.E){\n        endHour = msg.payload.E.h;\n        if(endHour.toString().length == 1) {endHour = '0'+endHour;}\n    }\n    if ('m' in msg.payload.E){\n        endMin = msg.payload.E.m;\n        if(endMin.toString().length == 1) {endMin = '0'+endMin;}\n    }\n    data.offtime = endHour+\":\"+endMin;\n}\n\nif ('W' in msg.payload){\n    data.mon = msg.payload.W.Mo;\n    data.tue = msg.payload.W.Tu;\n    data.wed = msg.payload.W.We;\n    data.thu = msg.payload.W.Th;\n    data.fri = msg.payload.W.Fr;\n    data.sat = msg.payload.W.Sa;\n    data.sun = msg.payload.W.Su;\n}\nmsg.payload = data;\nflow.set(\"G1Timer2\",data);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":3620,"wires":[["dd8af529.50c958"]]},{"id":"25d80ae7.526916","type":"mqtt out","z":"e2e5a56.78da658","name":"GET Timer 2","topic":"GWA/gw2E2C3AE83E8539/1/Time/2","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":1450,"y":3860,"wires":[]},{"id":"8143ab38.ccfdd8","type":"mqtt out","z":"e2e5a56.78da658","name":"Set Timer 2","topic":"","qos":"0","retain":"false","broker":"4c7fd38d.23f35c","x":1450,"y":3820,"wires":[]},{"id":"96ebaa65.49c7f8","type":"inject","z":"e2e5a56.78da658","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1270,"y":3860,"wires":[["25d80ae7.526916"]]},{"id":"ceda6db3.15f3c","type":"deduplicate","z":"e2e5a56.78da658","name":"","keyproperty":"","expiry":"2","x":1350,"y":3620,"wires":[["38bc8fa6.07c18"],[]]},{"id":"b11a27d2.a67e28","type":"debug","z":"e2e5a56.78da658","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":550,"y":3600,"wires":[]},{"id":"d5113155.cd78c","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.data = msg.payload;\nmsg.payload = msg.data.suspended;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3680,"wires":[["a59ee783.85e778","9b7a8a67.fe4368"]]},{"id":"a59ee783.85e778","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.mon;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3700,"wires":[["b13e5b83.b22c18","b7edbc8d.9f99d"]]},{"id":"b13e5b83.b22c18","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.tue;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3720,"wires":[["10e3f5e.713fe0a","ad742904.189ee8"]]},{"id":"1e891415.34bbbc","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.thu;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3760,"wires":[["4e01c4a3.bfbe8c","9522598b.3a4858"]]},{"id":"10e3f5e.713fe0a","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.wed;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3740,"wires":[["1e891415.34bbbc","fd31edcf.53b85"]]},{"id":"4e01c4a3.bfbe8c","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.fri;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3780,"wires":[["edc63945.a60418","d8095160.5d98c"]]},{"id":"edc63945.a60418","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sat;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3800,"wires":[["6c8ea19f.258ca","7b08326c.cb300c"]]},{"id":"6c8ea19f.258ca","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sun;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3820,"wires":[["64db7dcb.c26fd4","1fcf5d7a.7d1073"]]},{"id":"64db7dcb.c26fd4","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3840,"wires":[["2dc6864b.f8f5ca","dc229971.ef6568"]]},{"id":"2dc6864b.f8f5ca","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":120,"y":3860,"wires":[["74692f6f.94ac1"]]},{"id":"dd8af529.50c958","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.data = msg.payload;\nmsg.payload = msg.data.suspended;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3680,"wires":[["7668fd0c.d383f4","2d5aada6.542362"]]},{"id":"7668fd0c.d383f4","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.mon;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3700,"wires":[["8c68ec4f.88fa1","45fe8bd1.c3ebc4"]]},{"id":"8c68ec4f.88fa1","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.tue;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3720,"wires":[["d1b82344.207a1","20230491.ee0a3c"]]},{"id":"fc29ee0c.56dae","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.thu;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3760,"wires":[["4926c531.20dc7c","63c57541.1e48cc"]]},{"id":"d1b82344.207a1","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.wed;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3740,"wires":[["fc29ee0c.56dae","e3a7170d.11ae38"]]},{"id":"4926c531.20dc7c","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.fri;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3780,"wires":[["7f327912.791da8","9281b826.34b2c8"]]},{"id":"7f327912.791da8","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sat;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3800,"wires":[["66098ca0.d44d94","46cf676f.d0d5a8"]]},{"id":"66098ca0.d44d94","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.sun;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3820,"wires":[["3d3c0648.d2c2ea","fde1ce53.61148"]]},{"id":"3d3c0648.d2c2ea","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3840,"wires":[["40812c38.289564","4cb441ef.e8b6b"]]},{"id":"40812c38.289564","type":"function","z":"e2e5a56.78da658","name":"","func":"msg.payload = msg.data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":3860,"wires":[["b2dd5007.5e30b"]]},{"id":"c40b2973.a87058","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"df7db292.36094","order":16,"width":"2","height":"1","passthru":false,"label":"Save","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":470,"y":3780,"wires":[["cb19189f.5ba638"]]},{"id":"cb19189f.5ba638","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nvar hour, minute, Offhour, Offminute;\n    hour        = data.ontime.substring(0, 2);\n    minute      = data.ontime.substring(3, 5);\n    Offhour     = data.offtime.substring(0, 2);\n    Offminute   = data.offtime.substring(3, 5);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\n// GWR/gw2E2C3AE83E8341/1/Time/1\nmsg.topic = \"GWR/\"+flow.get(\"unit2\")+\"/1/Time/1\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":3780,"wires":[["baaf624.2ad29a"]]},{"id":"690fa2cc.d2198c","type":"ui_button","z":"e2e5a56.78da658","name":"","group":"1307a7ee.564f58","order":15,"width":"2","height":"1","passthru":false,"label":"Save","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":1270,"y":3780,"wires":[["f0ec44a6.047378"]]},{"id":"f0ec44a6.047378","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nvar hour, minute, Offhour, Offminute;\n    hour        = data.ontime.substring(0, 2);\n    minute      = data.ontime.substring(3, 5);\n    Offhour     = data.offtime.substring(0, 2);\n    Offminute   = data.offtime.substring(3, 5);\n\nmsg.payload = {\n    \"C\":data.suspended,\n    \"S\": {\n        \"h\": parseInt(hour),\n        \"m\": parseInt(minute)\n    },\n    \"E\": {\n        \"h\": parseInt(Offhour),\n        \"m\": parseInt(Offminute)\n    },\n    \"W\": {\n        \"Mo\": data.mon,\n        \"Tu\": data.tue,\n        \"We\": data.wed,\n        \"Th\": data.thu,\n        \"Fr\": data.fri,\n        \"Sa\": data.sat,\n        \"Su\": data.sun,\n    }\n};\n// GWR/gw2E2C3AE83E8341/1/Time/1\nmsg.topic = \"GWR/\"+flow.get(\"unit2\")+\"/1/Time/2\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1440,"y":3780,"wires":[["8143ab38.ccfdd8"]]},{"id":"bb937045.26225","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nmsg.payload = data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":3740,"wires":[["51713c25.878724"]]},{"id":"7b931662.5c7b08","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer1\");\nmsg.payload = data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":3720,"wires":[["388e77f1.e45518"]]},{"id":"388e77f1.e45518","type":"ui_template","z":"e2e5a56.78da658","group":"df7db292.36094","name":"On","order":4,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":670,"y":3720,"wires":[[]]},{"id":"51713c25.878724","type":"ui_template","z":"e2e5a56.78da658","group":"df7db292.36094","name":"Off","order":6,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":670,"y":3740,"wires":[[]]},{"id":"f76dace.03d505","type":"ui_button","z":"e2e5a56.78da658","name":"Refresh","group":"df7db292.36094","order":14,"width":"1","height":"1","passthru":false,"label":"","tooltip":"Refresh","color":"","bgcolor":"","icon":"fa-refresh","payload":"","payloadType":"str","topic":"","x":460,"y":3820,"wires":[["bb937045.26225","7b931662.5c7b08"]]},{"id":"dba4310b.6c4d9","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nmsg.payload = data.ontime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":3720,"wires":[["f3d2b32f.0ec73"]]},{"id":"bff7fcd6.8b029","type":"function","z":"e2e5a56.78da658","name":"","func":"var data = flow.get(\"G1Timer2\");\nmsg.payload = data.offtime;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":3740,"wires":[["a988fbcb.b19b38"]]},{"id":"f3d2b32f.0ec73","type":"ui_template","z":"e2e5a56.78da658","group":"1307a7ee.564f58","name":"On","order":4,"width":"1","height":"1","format":"<!DOCTYPE html>\n<html>\n    <body>\n        <div \n            style=\n                \"border: none;\n                color: black;\n                padding: 5px 5px;\n                text-align: center;\n                text-decoration: none;\n                display: inline-block;\n                font-size: 12px;\n                font-weight: bold;\n                margin: 1px;\n                border-radius: 6px;\n                background-color: Gainsboro;\"\n                ng-bind-html= \"msg.payload\"\n        >\n        </div>\n    </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1470,"y":3720,"wires":[[]]},{"id":"26a5cb1.5e08434","type":"ui_button","z":"e2e5a56.78da658","name":"Refresh","group":"1307a7ee.564f58","order":14,"width":"1","height":"1","passthru":false,"label":"","tooltip":"Refresh","color":"","bgcolor":"","icon":"fa-refresh","payload":"","payloadType":"str","topic":"","x":1260,"y":3820,"wires":[["bff7fcd6.8b029","dba4310b.6c4d9"]]},{"id":"1307a7ee.564f58","type":"ui_group","z":"","name":"G2Timer2","tab":"566e83b9.3adfdc","order":12,"disp":false,"width":"10","collapse":false},{"id":"3affe27c.33f30e","type":"mqtt-broker","z":"","name":"SAMWorx","broker":"samworx.dedicated.co.za","port":"1883","clientid":"SAM-R2D2","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"Server/R2D2/CS","birthQos":"0","birthRetain":"true","birthPayload":"Online","willTopic":"Server/R2D2/CS","willQos":"0","willRetain":"true","willPayload":"Offline"},{"id":"2a63097e.6e4f16","type":"ui_group","z":"","name":"Dashboard","tab":"566e83b9.3adfdc","order":1,"disp":false,"width":"4","collapse":false},{"id":"e29d4c40.387d8","type":"ui_group","z":"","name":"Settings","tab":"566e83b9.3adfdc","order":5,"disp":false,"width":"4","collapse":false},{"id":"feb71708.d69ec8","type":"MSSQL-UCGv2-CN","z":"","name":"GeyserWorx","server":"SAM-R2D2","port":"1433","encyption":false,"database":"GeyserWorx","pool":"32","connectionTimeout":"16000","requestTimeout":"15000"},{"id":"d1c22f75.8ed66","type":"ui_group","z":"","name":"Charts","tab":"566e83b9.3adfdc","order":3,"disp":false,"width":"10","collapse":false},{"id":"df33db3c.b48308","type":"ui_group","z":"","name":"Timer1","tab":"566e83b9.3adfdc","order":7,"disp":false,"width":"6","collapse":false},{"id":"4114e5fc.68ae5c","type":"ui_group","z":"","name":"Online / Offline Status","tab":"9471a581.4cc648","order":6,"disp":false,"width":"9","collapse":false},{"id":"9a5b4611.5b4408","type":"ui_group","z":"","name":"Charts2","tab":"566e83b9.3adfdc","order":4,"disp":false,"width":"10","collapse":false},{"id":"9e37422.d97c7c","type":"ui_group","z":"","name":"Timer2-1","tab":"566e83b9.3adfdc","order":8,"disp":false,"width":"6","collapse":false},{"id":"18f2a4b1.a31edb","type":"ui_group","z":"","name":"Dashboard2","tab":"566e83b9.3adfdc","order":2,"disp":false,"width":"4","collapse":false},{"id":"6bd21555.60f0fc","type":"ui_group","z":"","name":"Settings2","tab":"566e83b9.3adfdc","order":6,"disp":false,"width":"4","collapse":false},{"id":"ed002fb6.acad4","type":"ui_group","z":"","name":"G1Timer1","tab":"566e83b9.3adfdc","order":9,"disp":false,"width":"10","collapse":false},{"id":"4c7fd38d.23f35c","type":"mqtt-broker","z":"","name":"SAMWORX","broker":"samworx.dedicated.co.za","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"true","birthPayload":"","willTopic":"","willQos":"0","willRetain":"true","willPayload":""},{"id":"d25fc923.9b55b8","type":"ui_group","z":"","name":"G1Timer2","tab":"566e83b9.3adfdc","order":10,"disp":false,"width":"10","collapse":false},{"id":"df7db292.36094","type":"ui_group","z":"","name":"G2Timer1","tab":"566e83b9.3adfdc","order":11,"disp":false,"width":"10","collapse":false},{"id":"566e83b9.3adfdc","type":"ui_tab","z":"","name":"GeyserTimer","icon":"fa-clock-o","disabled":false,"hidden":false},{"id":"9471a581.4cc648","type":"ui_tab","z":"","name":"System","icon":"fa-tachometer","order":3}]
